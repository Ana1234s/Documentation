<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>PocketMine-MP: Server.php Source File</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="../../PocketMine-h-64.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">PocketMine-MP
   &#160;<span id="projectnumber">Alpha_1.4dev - API 1.0.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Packages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d5/dec/_server_8php.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Server.php</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  ____            _        _   __  __ _                  __  __ ____</span>
<a name="l00006"></a>00006 <span class="comment"> * |  _ \ ___   ___| | _____| |_|  \/  (_)_ __   ___      |  \/  |  _ \</span>
<a name="l00007"></a>00007 <span class="comment"> * | |_) / _ \ / __| |/ / _ \ __| |\/| | | &#39;_ \ / _ \_____| |\/| | |_) |</span>
<a name="l00008"></a>00008 <span class="comment"> * |  __/ (_) | (__|   &lt;  __/ |_| |  | | | | | |  __/_____| |  | |  __/</span>
<a name="l00009"></a>00009 <span class="comment"> * |_|   \___/ \___|_|\_\___|\__|_|  |_|_|_| |_|\___|     |_|  |_|_|</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * This program is free software: you can redistribute it and/or modify</span>
<a name="l00012"></a>00012 <span class="comment"> * it under the terms of the GNU Lesser General Public License as published by</span>
<a name="l00013"></a>00013 <span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00014"></a>00014 <span class="comment"> * (at your option) any later version.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * @author PocketMine Team</span>
<a name="l00017"></a>00017 <span class="comment"> * @link http://www.pocketmine.net/</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment">*/</span>
<a name="l00021"></a>00021 
<a name="l00026"></a>00026 <span class="keyword">namespace </span>pocketmine;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 use pocketmine\block\Block;
<a name="l00029"></a>00029 use pocketmine\command\CommandReader;
<a name="l00030"></a>00030 use pocketmine\command\CommandSender;
<a name="l00031"></a>00031 use pocketmine\command\ConsoleCommandSender;
<a name="l00032"></a>00032 use pocketmine\command\PluginIdentifiableCommand;
<a name="l00033"></a>00033 use pocketmine\command\SimpleCommandMap;
<a name="l00034"></a>00034 use pocketmine\entity\Entity;
<a name="l00035"></a>00035 use pocketmine\event\HandlerList;
<a name="l00036"></a>00036 use pocketmine\event\server\ServerCommandEvent;
<a name="l00037"></a>00037 use pocketmine\inventory\CraftingManager;
<a name="l00038"></a>00038 use pocketmine\inventory\InventoryType;
<a name="l00039"></a>00039 use pocketmine\inventory\Recipe;
<a name="l00040"></a>00040 use pocketmine\item\Item;
<a name="l00041"></a>00041 use pocketmine\level\format\LevelProviderManager;
<a name="l00042"></a>00042 use pocketmine\level\generator\GenerationRequestManager;
<a name="l00043"></a>00043 use pocketmine\level\generator\Generator;
<a name="l00044"></a>00044 use pocketmine\level\Level;
<a name="l00045"></a>00045 use pocketmine\metadata\EntityMetadataStore;
<a name="l00046"></a>00046 use pocketmine\metadata\LevelMetadataStore;
<a name="l00047"></a>00047 use pocketmine\metadata\PlayerMetadataStore;
<a name="l00048"></a>00048 use pocketmine\nbt\NBT;
<a name="l00049"></a>00049 use pocketmine\nbt\tag\Byte;
<a name="l00050"></a>00050 use pocketmine\nbt\tag\Compound;
<a name="l00051"></a>00051 use pocketmine\nbt\tag\Double;
<a name="l00052"></a>00052 use pocketmine\nbt\tag\Enum;
<a name="l00053"></a>00053 use pocketmine\nbt\tag\Float;
<a name="l00054"></a>00054 use pocketmine\nbt\tag\Int;
<a name="l00055"></a>00055 use pocketmine\nbt\tag\Long;
<a name="l00056"></a>00056 use pocketmine\nbt\tag\Short;
<a name="l00057"></a>00057 use pocketmine\nbt\tag\String;
<a name="l00058"></a>00058 use pocketmine\network\protocol\DataPacket;
<a name="l00059"></a>00059 use pocketmine\network\protocol\Info;
<a name="l00060"></a>00060 use pocketmine\network\query\QueryHandler;
<a name="l00061"></a>00061 use pocketmine\network\RakLibInterface;
<a name="l00062"></a>00062 use pocketmine\network\rcon\RCON;
<a name="l00063"></a>00063 use pocketmine\network\SourceInterface;
<a name="l00064"></a>00064 use pocketmine\network\upnp\UPnP;
<a name="l00065"></a>00065 use pocketmine\permission\BanList;
<a name="l00066"></a>00066 use pocketmine\permission\DefaultPermissions;
<a name="l00067"></a>00067 use pocketmine\plugin\Plugin;
<a name="l00068"></a>00068 use pocketmine\plugin\PluginLoadOrder;
<a name="l00069"></a>00069 use pocketmine\plugin\PluginManager;
<a name="l00070"></a>00070 use pocketmine\scheduler\CallbackTask;
<a name="l00071"></a>00071 use pocketmine\scheduler\SendUsageTask;
<a name="l00072"></a>00072 use pocketmine\scheduler\ServerScheduler;
<a name="l00073"></a>00073 use pocketmine\tile\Tile;
<a name="l00074"></a>00074 use pocketmine\updater\AutoUpdater;
<a name="l00075"></a>00075 use pocketmine\utils\Binary;
<a name="l00076"></a>00076 use pocketmine\utils\Config;
<a name="l00077"></a>00077 use pocketmine\utils\MainLogger;
<a name="l00078"></a>00078 use pocketmine\utils\TextFormat;
<a name="l00079"></a>00079 use pocketmine\utils\Utils;
<a name="l00080"></a>00080 use pocketmine\utils\VersionString;
<a name="l00081"></a>00081 
<a name="l00085"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html">00085</a> <span class="keyword">class </span><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html">Server</a>{
<a name="l00086"></a>00086     <span class="keyword">const</span> BROADCAST_CHANNEL_ADMINISTRATIVE = <span class="stringliteral">&quot;pocketmine.broadcast.admin&quot;</span>;
<a name="l00087"></a>00087     <span class="keyword">const</span> BROADCAST_CHANNEL_USERS = <span class="stringliteral">&quot;pocketmine.broadcast.user&quot;</span>;
<a name="l00088"></a>00088 
<a name="l00090"></a>00090     <span class="keyword">private</span> <span class="keyword">static</span> $instance = null;
<a name="l00091"></a>00091 
<a name="l00093"></a>00093     <span class="keyword">private</span> $banByName = null;
<a name="l00094"></a>00094 
<a name="l00096"></a>00096     <span class="keyword">private</span> $banByIP = null;
<a name="l00097"></a>00097 
<a name="l00099"></a>00099     <span class="keyword">private</span> $operators = null;
<a name="l00100"></a>00100 
<a name="l00102"></a>00102     <span class="keyword">private</span> $whitelist = null;
<a name="l00103"></a>00103 
<a name="l00105"></a>00105     <span class="keyword">private</span> $isRunning = <span class="keyword">true</span>;
<a name="l00106"></a>00106 
<a name="l00108"></a>00108     <span class="keyword">private</span> $pluginManager = null;
<a name="l00109"></a>00109 
<a name="l00111"></a>00111     <span class="keyword">private</span> $updater = null;
<a name="l00112"></a>00112 
<a name="l00114"></a>00114     <span class="keyword">private</span> $scheduler = null;
<a name="l00115"></a>00115 
<a name="l00117"></a>00117     <span class="keyword">private</span> $generationManager = null;
<a name="l00118"></a>00118 
<a name="l00124"></a>00124     <span class="keyword">private</span> $tickCounter;
<a name="l00125"></a>00125     <span class="keyword">private</span> $nextTick = 0;
<a name="l00126"></a>00126     <span class="keyword">private</span> $tickMeasure = 20;
<a name="l00127"></a>00127     <span class="keyword">private</span> $tickTime = 0;
<a name="l00128"></a>00128     <span class="keyword">private</span> $inTick = <span class="keyword">false</span>;
<a name="l00129"></a>00129 
<a name="l00131"></a>00131     <span class="keyword">private</span> $logger;
<a name="l00132"></a>00132 
<a name="l00134"></a>00134     <span class="keyword">private</span> $console = null;
<a name="l00135"></a>00135 
<a name="l00137"></a>00137     <span class="keyword">private</span> $commandMap = null;
<a name="l00138"></a>00138 
<a name="l00140"></a>00140     <span class="keyword">private</span> $craftingManager;
<a name="l00141"></a>00141 
<a name="l00143"></a>00143     <span class="keyword">private</span> $consoleSender;
<a name="l00144"></a>00144 
<a name="l00146"></a>00146     <span class="keyword">private</span> $maxPlayers;
<a name="l00147"></a>00147 
<a name="l00149"></a>00149     <span class="keyword">private</span> $rcon;
<a name="l00150"></a>00150 
<a name="l00152"></a>00152     <span class="keyword">private</span> $entityMetadata;
<a name="l00153"></a>00153 
<a name="l00155"></a>00155     <span class="keyword">private</span> $playerMetadata;
<a name="l00156"></a>00156 
<a name="l00158"></a>00158     <span class="keyword">private</span> $levelMetadata;
<a name="l00159"></a>00159 
<a name="l00161"></a>00161     <span class="keyword">private</span> $interfaces = [];
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="keyword">private</span> $serverID;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keyword">private</span> $autoloader;
<a name="l00166"></a>00166     <span class="keyword">private</span> $filePath;
<a name="l00167"></a>00167     <span class="keyword">private</span> $dataPath;
<a name="l00168"></a>00168     <span class="keyword">private</span> $pluginPath;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keyword">private</span> $lastSendUsage = null;
<a name="l00171"></a>00171 
<a name="l00173"></a>00173     <span class="keyword">private</span> $queryHandler;
<a name="l00174"></a>00174 
<a name="l00176"></a>00176     <span class="keyword">private</span> $properties;
<a name="l00177"></a>00177 
<a name="l00179"></a>00179     <span class="keyword">private</span> $config;
<a name="l00180"></a>00180 
<a name="l00182"></a>00182     <span class="keyword">private</span> $players = [];
<a name="l00183"></a>00183 
<a name="l00185"></a>00185     <span class="keyword">private</span> $levels = [];
<a name="l00186"></a>00186 
<a name="l00188"></a>00188     <span class="keyword">private</span> $levelDefault = null;
<a name="l00189"></a>00189 
<a name="l00193"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ace3e6dc06f0fb014b041c6e69a460edb">00193</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ace3e6dc06f0fb014b041c6e69a460edb">getName</a>(){
<a name="l00194"></a>00194         <span class="keywordflow">return</span> <span class="stringliteral">&quot;PocketMine-MP&quot;</span>;
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196 
<a name="l00200"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8b8f89c289651349591981da5938e2c2">00200</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8b8f89c289651349591981da5938e2c2">isRunning</a>(){
<a name="l00201"></a>00201         <span class="keywordflow">return</span> $this-&gt;isRunning === <span class="keyword">true</span>;
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 
<a name="l00207"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af9924a23f41a59324dca1ce385732af9">00207</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af9924a23f41a59324dca1ce385732af9">getPocketMineVersion</a>(){
<a name="l00208"></a>00208         return \pocketmine\VERSION;
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210 
<a name="l00214"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a76bb64798b2e5858dabf534de3379020">00214</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a76bb64798b2e5858dabf534de3379020">getCodename</a>(){
<a name="l00215"></a>00215         return \pocketmine\CODENAME;
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217 
<a name="l00221"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8b29f0a0f19898129c6075be08a9a91a">00221</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8b29f0a0f19898129c6075be08a9a91a">getVersion</a>(){
<a name="l00222"></a>00222         return \pocketmine\MINECRAFT_VERSION;
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224 
<a name="l00228"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ae0f9ce5a194df30a970535b18c55c095">00228</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ae0f9ce5a194df30a970535b18c55c095">getApiVersion</a>(){
<a name="l00229"></a>00229         return \pocketmine\API_VERSION;
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231 
<a name="l00235"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a95f4304c8761313669609b9ec2055cc0">00235</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a95f4304c8761313669609b9ec2055cc0">getFilePath</a>(){
<a name="l00236"></a>00236         <span class="keywordflow">return</span> $this-&gt;filePath;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 
<a name="l00242"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a351940576579e51ede22778e8de54a67">00242</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a351940576579e51ede22778e8de54a67">getDataPath</a>(){
<a name="l00243"></a>00243         <span class="keywordflow">return</span> $this-&gt;dataPath;
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 
<a name="l00249"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2db11732779c7975c535b9d4858c81e1">00249</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2db11732779c7975c535b9d4858c81e1">getPluginPath</a>(){
<a name="l00250"></a>00250         <span class="keywordflow">return</span> $this-&gt;pluginPath;
<a name="l00251"></a>00251     }
<a name="l00252"></a>00252 
<a name="l00256"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a34fc53d1942c7c1cf7c57f4f6924f2fe">00256</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a34fc53d1942c7c1cf7c57f4f6924f2fe">getMaxPlayers</a>(){
<a name="l00257"></a>00257         <span class="keywordflow">return</span> $this-&gt;maxPlayers;
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259 
<a name="l00263"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3edbf7b2a001dc85c1d745475765983e">00263</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3edbf7b2a001dc85c1d745475765983e">getPort</a>(){
<a name="l00264"></a>00264         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;server-port&quot;</span>, 19132);
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266 
<a name="l00270"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6a849ef529ae9c09a58ca2c401a52b74">00270</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6a849ef529ae9c09a58ca2c401a52b74">getViewDistance</a>(){
<a name="l00271"></a>00271         <span class="keywordflow">return</span> min(11, max($this-&gt;getConfigInt(<span class="stringliteral">&quot;view-distance&quot;</span>, 7), 4));
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273 
<a name="l00277"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0181decc07fcfcfee74ca8e05da066ac">00277</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0181decc07fcfcfee74ca8e05da066ac">getIp</a>(){
<a name="l00278"></a>00278         <span class="keywordflow">return</span> $this-&gt;getConfigString(<span class="stringliteral">&quot;server-ip&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280 
<a name="l00284"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a46d68467c41a3650bf14a1957faa0cbc">00284</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a46d68467c41a3650bf14a1957faa0cbc">getServerName</a>(){
<a name="l00285"></a>00285         <span class="keywordflow">return</span> $this-&gt;getConfigString(<span class="stringliteral">&quot;server-name&quot;</span>, <span class="stringliteral">&quot;Unknown server&quot;</span>);
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287 
<a name="l00291"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a4626a034d3a4486f5abb31306beada26">00291</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a4626a034d3a4486f5abb31306beada26">getLevelType</a>(){
<a name="l00292"></a>00292         <span class="keywordflow">return</span> $this-&gt;getConfigString(<span class="stringliteral">&quot;level-type&quot;</span>, <span class="stringliteral">&quot;DEFAULT&quot;</span>);
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294 
<a name="l00298"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa121c3ec5cfb590c424045977ae246d9">00298</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa121c3ec5cfb590c424045977ae246d9">getGenerateStructures</a>(){
<a name="l00299"></a>00299         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;generate-structures&quot;</span>, <span class="keyword">true</span>);
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301 
<a name="l00305"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1ed187d1b4b3754d76dbfd774bccc505">00305</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1ed187d1b4b3754d76dbfd774bccc505">getGamemode</a>(){
<a name="l00306"></a>00306         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;gamemode&quot;</span>, 0) &amp; 0b11;
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 
<a name="l00312"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a33676b0f56790f5b24b5d868450abfb7">00312</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a33676b0f56790f5b24b5d868450abfb7">getForceGamemode</a>(){
<a name="l00313"></a>00313         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;force-gamemode&quot;</span>, <span class="keyword">false</span>);
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315 
<a name="l00323"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa633a31f5c0009a597dd6e8acbe595d8">00323</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa633a31f5c0009a597dd6e8acbe595d8">getGamemodeString</a>($mode){
<a name="l00324"></a>00324         <span class="keywordflow">switch</span>((<span class="keywordtype">int</span>) $mode){
<a name="l00325"></a>00325             <span class="keywordflow">case</span> Player::SURVIVAL:
<a name="l00326"></a>00326                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;SURVIVAL&quot;</span>;
<a name="l00327"></a>00327             <span class="keywordflow">case</span> Player::CREATIVE:
<a name="l00328"></a>00328                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;CREATIVE&quot;</span>;
<a name="l00329"></a>00329             <span class="keywordflow">case</span> Player::ADVENTURE:
<a name="l00330"></a>00330                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;ADVENTURE&quot;</span>;
<a name="l00331"></a>00331             <span class="keywordflow">case</span> Player::SPECTATOR:
<a name="l00332"></a>00332                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;SPECTATOR&quot;</span>;
<a name="l00333"></a>00333         }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNKNOWN&quot;</span>;
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337 
<a name="l00345"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#addd964a3db05684e48bf62080fabcb2c">00345</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#addd964a3db05684e48bf62080fabcb2c">getGamemodeFromString</a>($str){
<a name="l00346"></a>00346         <span class="keywordflow">switch</span>(strtolower(trim($str))){
<a name="l00347"></a>00347             <span class="keywordflow">case</span> (<span class="keywordtype">string</span>) Player::SURVIVAL:
<a name="l00348"></a>00348             <span class="keywordflow">case</span> <span class="stringliteral">&quot;survival&quot;</span>:
<a name="l00349"></a>00349             <span class="keywordflow">case</span> <span class="stringliteral">&quot;s&quot;</span>:
<a name="l00350"></a>00350                 <span class="keywordflow">return</span> Player::SURVIVAL;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352             <span class="keywordflow">case</span> (<span class="keywordtype">string</span>) Player::CREATIVE:
<a name="l00353"></a>00353             <span class="keywordflow">case</span> <span class="stringliteral">&quot;creative&quot;</span>:
<a name="l00354"></a>00354             <span class="keywordflow">case</span> <span class="stringliteral">&quot;c&quot;</span>:
<a name="l00355"></a>00355                 <span class="keywordflow">return</span> Player::CREATIVE;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357             <span class="keywordflow">case</span> (<span class="keywordtype">string</span>) Player::ADVENTURE:
<a name="l00358"></a>00358             <span class="keywordflow">case</span> <span class="stringliteral">&quot;adventure&quot;</span>:
<a name="l00359"></a>00359             <span class="keywordflow">case</span> <span class="stringliteral">&quot;a&quot;</span>:
<a name="l00360"></a>00360                 <span class="keywordflow">return</span> Player::ADVENTURE;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362             <span class="keywordflow">case</span> (<span class="keywordtype">string</span>) Player::SPECTATOR:
<a name="l00363"></a>00363             <span class="keywordflow">case</span> <span class="stringliteral">&quot;spectator&quot;</span>:
<a name="l00364"></a>00364             <span class="keywordflow">case</span> <span class="stringliteral">&quot;view&quot;</span>:
<a name="l00365"></a>00365             <span class="keywordflow">case</span> <span class="stringliteral">&quot;v&quot;</span>:
<a name="l00366"></a>00366                 <span class="keywordflow">return</span> Player::SPECTATOR;
<a name="l00367"></a>00367         }
<a name="l00368"></a>00368         <span class="keywordflow">return</span> -1;
<a name="l00369"></a>00369     }
<a name="l00370"></a>00370 
<a name="l00376"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3839746528326c085edb1f04498f473a">00376</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3839746528326c085edb1f04498f473a">getDifficultyFromString</a>($str){
<a name="l00377"></a>00377         <span class="keywordflow">switch</span>(strtolower(trim($str))){
<a name="l00378"></a>00378             <span class="keywordflow">case</span> <span class="stringliteral">&quot;0&quot;</span>:
<a name="l00379"></a>00379             <span class="keywordflow">case</span> <span class="stringliteral">&quot;peaceful&quot;</span>:
<a name="l00380"></a>00380             <span class="keywordflow">case</span> <span class="stringliteral">&quot;p&quot;</span>:
<a name="l00381"></a>00381                 <span class="keywordflow">return</span> 0;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383             <span class="keywordflow">case</span> <span class="stringliteral">&quot;1&quot;</span>:
<a name="l00384"></a>00384             <span class="keywordflow">case</span> <span class="stringliteral">&quot;easy&quot;</span>:
<a name="l00385"></a>00385             <span class="keywordflow">case</span> <span class="stringliteral">&quot;e&quot;</span>:
<a name="l00386"></a>00386                 <span class="keywordflow">return</span> 1;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388             <span class="keywordflow">case</span> <span class="stringliteral">&quot;2&quot;</span>:
<a name="l00389"></a>00389             <span class="keywordflow">case</span> <span class="stringliteral">&quot;normal&quot;</span>:
<a name="l00390"></a>00390             <span class="keywordflow">case</span> <span class="stringliteral">&quot;n&quot;</span>:
<a name="l00391"></a>00391                 <span class="keywordflow">return</span> 2;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393             <span class="keywordflow">case</span> <span class="stringliteral">&quot;3&quot;</span>:
<a name="l00394"></a>00394             <span class="keywordflow">case</span> <span class="stringliteral">&quot;hard&quot;</span>:
<a name="l00395"></a>00395             <span class="keywordflow">case</span> <span class="stringliteral">&quot;h&quot;</span>:
<a name="l00396"></a>00396                 <span class="keywordflow">return</span> 3;
<a name="l00397"></a>00397         }
<a name="l00398"></a>00398         <span class="keywordflow">return</span> -1;
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400 
<a name="l00404"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac5467ae1322f4e9a0add3dd47dad63fc">00404</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac5467ae1322f4e9a0add3dd47dad63fc">getDifficulty</a>(){
<a name="l00405"></a>00405         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;difficulty&quot;</span>, 1);
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00411"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a64c6e1b40600af48d8e00422251ee8a0">00411</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a64c6e1b40600af48d8e00422251ee8a0">hasWhitelist</a>(){
<a name="l00412"></a>00412         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;white-list&quot;</span>, <span class="keyword">false</span>);
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414 
<a name="l00418"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a7bf8fb080c6890b0ea196d333d453224">00418</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a7bf8fb080c6890b0ea196d333d453224">getSpawnRadius</a>(){
<a name="l00419"></a>00419         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;spawn-protection&quot;</span>, 16);
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421 
<a name="l00425"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ad856f5f0435681a95f8d0594e1fdcd93">00425</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ad856f5f0435681a95f8d0594e1fdcd93">getAllowFlight</a>(){
<a name="l00426"></a>00426         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;allow-flight&quot;</span>, <span class="keyword">false</span>);
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428 
<a name="l00432"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a57b342fd413e8d0984fd5e4deaff6236">00432</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a57b342fd413e8d0984fd5e4deaff6236">isHardcore</a>(){
<a name="l00433"></a>00433         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;hardcore&quot;</span>, <span class="keyword">false</span>);
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 
<a name="l00439"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af1d998f0c790cac843e833a3fbfb478f">00439</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af1d998f0c790cac843e833a3fbfb478f">getDefaultGamemode</a>(){
<a name="l00440"></a>00440         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;gamemode&quot;</span>, 0) &amp; 0b11;
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442 
<a name="l00446"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1e7807b4cce45cbb94b1d4896698617b">00446</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1e7807b4cce45cbb94b1d4896698617b">getMotd</a>(){
<a name="l00447"></a>00447         <span class="keywordflow">return</span> $this-&gt;getConfigString(<span class="stringliteral">&quot;motd&quot;</span>, <span class="stringliteral">&quot;Minecraft: PE Server&quot;</span>);
<a name="l00448"></a>00448     }
<a name="l00449"></a>00449 
<a name="l00453"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af9c4f86ccd5d076e961e423be2fcdd9a">00453</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af9c4f86ccd5d076e961e423be2fcdd9a">getLoader</a>(){
<a name="l00454"></a>00454         <span class="keywordflow">return</span> $this-&gt;autoloader;
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456 
<a name="l00460"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5b32c69f8f444fc6b2768a5afc0af656">00460</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5b32c69f8f444fc6b2768a5afc0af656">getLogger</a>(){
<a name="l00461"></a>00461         <span class="keywordflow">return</span> $this-&gt;logger;
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463 
<a name="l00467"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2efb189e19a74df07c9f106b1c6aa71c">00467</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2efb189e19a74df07c9f106b1c6aa71c">getEntityMetadata</a>(){
<a name="l00468"></a>00468         <span class="keywordflow">return</span> $this-&gt;entityMetadata;
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00474"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a45cc8a980c3eda1d4e273cb306ba6ee2">00474</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a45cc8a980c3eda1d4e273cb306ba6ee2">getPlayerMetadata</a>(){
<a name="l00475"></a>00475         <span class="keywordflow">return</span> $this-&gt;playerMetadata;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 
<a name="l00481"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abfe026c6e1f8dc7dd37784d56baa8fe9">00481</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abfe026c6e1f8dc7dd37784d56baa8fe9">getLevelMetadata</a>(){
<a name="l00482"></a>00482         <span class="keywordflow">return</span> $this-&gt;levelMetadata;
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484 
<a name="l00488"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a564abe1d7f99cd090eb2850cf4d4f030">00488</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a564abe1d7f99cd090eb2850cf4d4f030">getUpdater</a>(){
<a name="l00489"></a>00489         <span class="keywordflow">return</span> $this-&gt;updater;
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491 
<a name="l00495"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a84e31713e6e82d71c1a05c735599d94e">00495</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a84e31713e6e82d71c1a05c735599d94e">getPluginManager</a>(){
<a name="l00496"></a>00496         <span class="keywordflow">return</span> $this-&gt;pluginManager;
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498 
<a name="l00502"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2645ea9d5ebe563eebd4b95062f0e2a9">00502</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2645ea9d5ebe563eebd4b95062f0e2a9">getCraftingManager</a>(){
<a name="l00503"></a>00503         <span class="keywordflow">return</span> $this-&gt;craftingManager;
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505 
<a name="l00509"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a4543769e8a4baebde1ebf2a52c8fbe1d">00509</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a4543769e8a4baebde1ebf2a52c8fbe1d">getScheduler</a>(){
<a name="l00510"></a>00510         <span class="keywordflow">return</span> $this-&gt;scheduler;
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512 
<a name="l00516"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6feac399caca26cc3d81f5367ee323e6">00516</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6feac399caca26cc3d81f5367ee323e6">getGenerationManager</a>(){
<a name="l00517"></a>00517         <span class="keywordflow">return</span> $this-&gt;generationManager;
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519 
<a name="l00523"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af584a38f21185a98def3acc867d5c1c0">00523</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af584a38f21185a98def3acc867d5c1c0">getTick</a>(){
<a name="l00524"></a>00524         <span class="keywordflow">return</span> $this-&gt;tickCounter;
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 
<a name="l00532"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3f09f0e8b2925c01d97c2a767c0eadad">00532</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3f09f0e8b2925c01d97c2a767c0eadad">getTicksPerSecond</a>(){
<a name="l00533"></a>00533         <span class="keywordflow">return</span> round((0.05 / $this-&gt;tickMeasure) * 20, 2);
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535 
<a name="l00539"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a28497b688d55ae15e185a0078813c9e1">00539</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a28497b688d55ae15e185a0078813c9e1">getInterfaces</a>(){
<a name="l00540"></a>00540         <span class="keywordflow">return</span> $this-&gt;interfaces;
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00546"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0a77866f12dab7c5a92cdb40cc1784e8">00546</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0a77866f12dab7c5a92cdb40cc1784e8">addInterface</a>(SourceInterface $interface){
<a name="l00547"></a>00547         $this-&gt;interfaces[] = $interface;
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549 
<a name="l00553"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ade8d430cfe9a43fa0dd5b3c515e63101">00553</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ade8d430cfe9a43fa0dd5b3c515e63101">getCommandMap</a>(){
<a name="l00554"></a>00554         <span class="keywordflow">return</span> $this-&gt;commandMap;
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556 
<a name="l00560"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab173ee59d49782e9a9fd13a1cdc39cbf">00560</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab173ee59d49782e9a9fd13a1cdc39cbf">getOnlinePlayers</a>(){
<a name="l00561"></a>00561         <span class="keywordflow">return</span> $this-&gt;players;
<a name="l00562"></a>00562     }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <span class="keyword">public</span> <span class="keyword">function</span> addRecipe(Recipe $recipe){
<a name="l00565"></a>00565         $this-&gt;craftingManager-&gt;registerRecipe($recipe);
<a name="l00566"></a>00566     }
<a name="l00567"></a>00567 
<a name="l00573"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6d7424f9555fa4438381aef1e5bb942e">00573</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6d7424f9555fa4438381aef1e5bb942e">getOfflinePlayer</a>($name){
<a name="l00574"></a>00574         $name = strtolower($name);
<a name="l00575"></a>00575         $result = $this-&gt;getPlayerExact($name);
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         <span class="keywordflow">if</span>($result === null){
<a name="l00578"></a>00578             $result = <span class="keyword">new</span> <a class="code" href="../../d9/d5f/classpocketmine_1_1_offline_player.html">OfflinePlayer</a>($this, $name);
<a name="l00579"></a>00579         }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581         <span class="keywordflow">return</span> $result;
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583 
<a name="l00589"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a488247de559bd8d720ae935d66d69949">00589</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a488247de559bd8d720ae935d66d69949">getOfflinePlayerData</a>($name){
<a name="l00590"></a>00590         $name = strtolower($name);
<a name="l00591"></a>00591         $path = $this-&gt;getDataPath() . <span class="stringliteral">&quot;players/&quot;</span>;
<a name="l00592"></a>00592         <span class="keywordflow">if</span>(!file_exists($path . <span class="stringliteral">&quot;$name.dat&quot;</span>)){
<a name="l00593"></a>00593             $spawn = $this-&gt;getDefaultLevel()-&gt;getSafeSpawn();
<a name="l00594"></a>00594             $nbt = <span class="keyword">new</span> Compound(<span class="keyword">false</span>, array(
<a name="l00595"></a>00595                 <span class="keyword">new</span> Long(<span class="stringliteral">&quot;firstPlayed&quot;</span>, floor(microtime(<span class="keyword">true</span>) * 1000)),
<a name="l00596"></a>00596                 <span class="keyword">new</span> Long(<span class="stringliteral">&quot;lastPlayed&quot;</span>, floor(microtime(<span class="keyword">true</span>) * 1000)),
<a name="l00597"></a>00597                 <span class="keyword">new</span> Enum(<span class="stringliteral">&quot;Pos&quot;</span>, array(
<a name="l00598"></a>00598                     <span class="keyword">new</span> Double(0, $spawn-&gt;x),
<a name="l00599"></a>00599                     <span class="keyword">new</span> Double(1, $spawn-&gt;y),
<a name="l00600"></a>00600                     <span class="keyword">new</span> Double(2, $spawn-&gt;z)
<a name="l00601"></a>00601                 )),
<a name="l00602"></a>00602                 <span class="keyword">new</span> String(<span class="stringliteral">&quot;Level&quot;</span>, $this-&gt;getDefaultLevel()-&gt;getName()),
<a name="l00603"></a>00603                 <span class="keyword">new</span> String(<span class="stringliteral">&quot;SpawnLevel&quot;</span>, $this-&gt;getDefaultLevel()-&gt;getName()),
<a name="l00604"></a>00604                 <span class="keyword">new</span> Int(<span class="stringliteral">&quot;SpawnX&quot;</span>, (<span class="keywordtype">int</span>) $spawn-&gt;x),
<a name="l00605"></a>00605                 <span class="keyword">new</span> Int(<span class="stringliteral">&quot;SpawnY&quot;</span>, (<span class="keywordtype">int</span>) $spawn-&gt;y),
<a name="l00606"></a>00606                 <span class="keyword">new</span> Int(<span class="stringliteral">&quot;SpawnZ&quot;</span>, (<span class="keywordtype">int</span>) $spawn-&gt;z),
<a name="l00607"></a>00607                 <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;SpawnForced&quot;</span>, 1), <span class="comment">//TODO</span>
<a name="l00608"></a>00608                 <span class="keyword">new</span> Enum(<span class="stringliteral">&quot;Inventory&quot;</span>, []),
<a name="l00609"></a>00609                 <span class="keyword">new</span> Compound(<span class="stringliteral">&quot;Achievements&quot;</span>, []),
<a name="l00610"></a>00610                 <span class="keyword">new</span> Int(<span class="stringliteral">&quot;playerGameType&quot;</span>, $this-&gt;getGamemode()),
<a name="l00611"></a>00611                 <span class="keyword">new</span> Enum(<span class="stringliteral">&quot;Motion&quot;</span>, array(
<a name="l00612"></a>00612                     <span class="keyword">new</span> Double(0, 0.0),
<a name="l00613"></a>00613                     <span class="keyword">new</span> Double(1, 0.0),
<a name="l00614"></a>00614                     <span class="keyword">new</span> Double(2, 0.0)
<a name="l00615"></a>00615                 )),
<a name="l00616"></a>00616                 <span class="keyword">new</span> Enum(<span class="stringliteral">&quot;Rotation&quot;</span>, array(
<a name="l00617"></a>00617                     <span class="keyword">new</span> Float(0, 0.0),
<a name="l00618"></a>00618                     <span class="keyword">new</span> Float(1, 0.0)
<a name="l00619"></a>00619                 )),
<a name="l00620"></a>00620                 <span class="keyword">new</span> Float(<span class="stringliteral">&quot;FallDistance&quot;</span>, 0.0),
<a name="l00621"></a>00621                 <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Fire&quot;</span>, 0),
<a name="l00622"></a>00622                 <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Air&quot;</span>, 0),
<a name="l00623"></a>00623                 <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;OnGround&quot;</span>, 1),
<a name="l00624"></a>00624                 <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Invulnerable&quot;</span>, 0),
<a name="l00625"></a>00625                 <span class="keyword">new</span> String(<span class="stringliteral">&quot;NameTag&quot;</span>, $name),
<a name="l00626"></a>00626             ));
<a name="l00627"></a>00627             $nbt-&gt;Pos-&gt;setTagType(NBT::TAG_Double);
<a name="l00628"></a>00628             $nbt-&gt;Inventory-&gt;setTagType(NBT::TAG_Compound);
<a name="l00629"></a>00629             $nbt-&gt;Motion-&gt;setTagType(NBT::TAG_Double);
<a name="l00630"></a>00630             $nbt-&gt;Rotation-&gt;setTagType(NBT::TAG_Float);
<a name="l00631"></a>00631 
<a name="l00632"></a>00632             <span class="keywordflow">if</span>(file_exists($path . <span class="stringliteral">&quot;$name.yml&quot;</span>)){ <span class="comment">//Importing old PocketMine-MP files</span>
<a name="l00633"></a>00633                 $data = <span class="keyword">new</span> Config($path . <span class="stringliteral">&quot;$name.yml&quot;</span>, Config::YAML, []);
<a name="l00634"></a>00634                 $nbt[<span class="stringliteral">&quot;playerGameType&quot;</span>] = (int) $data-&gt;get(<span class="stringliteral">&quot;gamemode&quot;</span>);
<a name="l00635"></a>00635                 $nbt[<span class="stringliteral">&quot;Level&quot;</span>] = $data-&gt;get(<span class="stringliteral">&quot;position&quot;</span>)[<span class="stringliteral">&quot;level&quot;</span>];
<a name="l00636"></a>00636                 $nbt[<span class="stringliteral">&quot;Pos&quot;</span>][0] = $data-&gt;get(<span class="stringliteral">&quot;position&quot;</span>)[<span class="stringliteral">&quot;x&quot;</span>];
<a name="l00637"></a>00637                 $nbt[<span class="stringliteral">&quot;Pos&quot;</span>][1] = $data-&gt;get(<span class="stringliteral">&quot;position&quot;</span>)[<span class="stringliteral">&quot;y&quot;</span>];
<a name="l00638"></a>00638                 $nbt[<span class="stringliteral">&quot;Pos&quot;</span>][2] = $data-&gt;get(<span class="stringliteral">&quot;position&quot;</span>)[<span class="stringliteral">&quot;z&quot;</span>];
<a name="l00639"></a>00639                 $nbt[<span class="stringliteral">&quot;SpawnLevel&quot;</span>] = $data-&gt;get(<span class="stringliteral">&quot;spawn&quot;</span>)[<span class="stringliteral">&quot;level&quot;</span>];
<a name="l00640"></a>00640                 $nbt[<span class="stringliteral">&quot;SpawnX&quot;</span>] = (int) $data-&gt;get(<span class="stringliteral">&quot;spawn&quot;</span>)[<span class="stringliteral">&quot;x&quot;</span>];
<a name="l00641"></a>00641                 $nbt[<span class="stringliteral">&quot;SpawnY&quot;</span>] = (int) $data-&gt;get(<span class="stringliteral">&quot;spawn&quot;</span>)[<span class="stringliteral">&quot;y&quot;</span>];
<a name="l00642"></a>00642                 $nbt[<span class="stringliteral">&quot;SpawnZ&quot;</span>] = (int) $data-&gt;get(<span class="stringliteral">&quot;spawn&quot;</span>)[<span class="stringliteral">&quot;z&quot;</span>];
<a name="l00643"></a>00643                 $this-&gt;logger-&gt;notice(<span class="stringliteral">&quot;Old Player data found for \&quot;&quot;</span> . $name . <span class="stringliteral">&quot;\&quot;, upgrading profile&quot;</span>);
<a name="l00644"></a>00644                 <span class="keywordflow">foreach</span>($data-&gt;get(<span class="stringliteral">&quot;inventory&quot;</span>) as $slot =&gt; $item){
<a name="l00645"></a>00645                     <span class="keywordflow">if</span>(count($item) === 3){
<a name="l00646"></a>00646                         $nbt-&gt;Inventory[$slot + 9] = <span class="keyword">new</span> Compound(<span class="keyword">false</span>, array(
<a name="l00647"></a>00647                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;id&quot;</span>, $item[0]),
<a name="l00648"></a>00648                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Damage&quot;</span>, $item[1]),
<a name="l00649"></a>00649                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Count&quot;</span>, $item[2]),
<a name="l00650"></a>00650                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Slot&quot;</span>, $slot + 9),
<a name="l00651"></a>00651                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;TrueSlot&quot;</span>, $slot + 9)
<a name="l00652"></a>00652                         ));
<a name="l00653"></a>00653                     }
<a name="l00654"></a>00654                 }
<a name="l00655"></a>00655                 <span class="keywordflow">foreach</span>($data-&gt;get(<span class="stringliteral">&quot;hotbar&quot;</span>) as $slot =&gt; $itemSlot){
<a name="l00656"></a>00656                     <span class="keywordflow">if</span>(isset($nbt-&gt;Inventory[$itemSlot + 9])){
<a name="l00657"></a>00657                         $item = $nbt-&gt;Inventory[$itemSlot + 9];
<a name="l00658"></a>00658                         $nbt-&gt;Inventory[$slot] = <span class="keyword">new</span> Compound(<span class="keyword">false</span>, array(
<a name="l00659"></a>00659                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;id&quot;</span>, $item-&gt;id),
<a name="l00660"></a>00660                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Damage&quot;</span>, $item-&gt;Damage),
<a name="l00661"></a>00661                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Count&quot;</span>, $item-&gt;Count),
<a name="l00662"></a>00662                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Slot&quot;</span>, $slot),
<a name="l00663"></a>00663                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;TrueSlot&quot;</span>, $item-&gt;TrueSlot)
<a name="l00664"></a>00664                         ));
<a name="l00665"></a>00665                     }
<a name="l00666"></a>00666                 }
<a name="l00667"></a>00667                 <span class="keywordflow">foreach</span>($data-&gt;get(<span class="stringliteral">&quot;armor&quot;</span>) as $slot =&gt; $item){
<a name="l00668"></a>00668                     <span class="keywordflow">if</span>(count($item) === 2){
<a name="l00669"></a>00669                         $nbt-&gt;Inventory[$slot + 100] = <span class="keyword">new</span> Compound(<span class="keyword">false</span>, array(
<a name="l00670"></a>00670                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;id&quot;</span>, $item[0]),
<a name="l00671"></a>00671                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Damage&quot;</span>, $item[1]),
<a name="l00672"></a>00672                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Count&quot;</span>, 1),
<a name="l00673"></a>00673                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Slot&quot;</span>, $slot + 100)
<a name="l00674"></a>00674                         ));
<a name="l00675"></a>00675                     }
<a name="l00676"></a>00676                 }
<a name="l00677"></a>00677                 <span class="keywordflow">foreach</span>($data-&gt;get(<span class="stringliteral">&quot;achievements&quot;</span>) as $achievement =&gt; $status){
<a name="l00678"></a>00678                     $nbt-&gt;Achievements[$achievement] = <span class="keyword">new</span> Byte($achievement, $status == <span class="keyword">true</span> ? 1 : 0);
<a name="l00679"></a>00679                 }
<a name="l00680"></a>00680                 unlink($path . <span class="stringliteral">&quot;$name.yml&quot;</span>);
<a name="l00681"></a>00681             }<span class="keywordflow">else</span>{
<a name="l00682"></a>00682                 $this-&gt;logger-&gt;notice(<span class="stringliteral">&quot;Player data not found for \&quot;&quot;</span> . $name . <span class="stringliteral">&quot;\&quot;, creating new profile&quot;</span>);
<a name="l00683"></a>00683             }
<a name="l00684"></a>00684             $this-&gt;saveOfflinePlayerData($name, $nbt);
<a name="l00685"></a>00685 
<a name="l00686"></a>00686             <span class="keywordflow">return</span> $nbt;
<a name="l00687"></a>00687         }<span class="keywordflow">else</span>{
<a name="l00688"></a>00688             $nbt = <span class="keyword">new</span> NBT(NBT::BIG_ENDIAN);
<a name="l00689"></a>00689             $nbt-&gt;readCompressed(file_get_contents($path . <span class="stringliteral">&quot;$name.dat&quot;</span>));
<a name="l00690"></a>00690 
<a name="l00691"></a>00691             <span class="keywordflow">return</span> $nbt-&gt;getData();
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694 
<a name="l00699"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0adf3b92ba17f5fb029417e08ced6d87">00699</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0adf3b92ba17f5fb029417e08ced6d87">saveOfflinePlayerData</a>($name, Compound $nbtTag){
<a name="l00700"></a>00700         $nbt = <span class="keyword">new</span> NBT(NBT::BIG_ENDIAN);
<a name="l00701"></a>00701         $nbt-&gt;setData($nbtTag);
<a name="l00702"></a>00702         file_put_contents($this-&gt;getDataPath() . <span class="stringliteral">&quot;players/&quot;</span> . strtolower($name) . <span class="stringliteral">&quot;.dat&quot;</span>, $nbt-&gt;writeCompressed());
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704 
<a name="l00710"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a11ca89d500fa7bd68ce92c9dec5e87c7">00710</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a11ca89d500fa7bd68ce92c9dec5e87c7">getPlayer</a>($name){
<a name="l00711"></a>00711         $found = null;
<a name="l00712"></a>00712         $name = strtolower($name);
<a name="l00713"></a>00713         $delta = PHP_INT_MAX;
<a name="l00714"></a>00714         <span class="keywordflow">foreach</span>($this-&gt;getOnlinePlayers() as $player){
<a name="l00715"></a>00715             <span class="keywordflow">if</span>(stripos($player-&gt;getName(), $name) === 0){
<a name="l00716"></a>00716                 $curDelta = strlen($player-&gt;getName()) - strlen($name);
<a name="l00717"></a>00717                 <span class="keywordflow">if</span>($curDelta &lt; $delta){
<a name="l00718"></a>00718                     $found = $player;
<a name="l00719"></a>00719                     $delta = $curDelta;
<a name="l00720"></a>00720                 }
<a name="l00721"></a>00721                 <span class="keywordflow">if</span>($curDelta === 0){
<a name="l00722"></a>00722                     <span class="keywordflow">break</span>;
<a name="l00723"></a>00723                 }
<a name="l00724"></a>00724             }
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727         <span class="keywordflow">return</span> $found;
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 
<a name="l00735"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac88d550852c49cfc51e17c41ed453e62">00735</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac88d550852c49cfc51e17c41ed453e62">getPlayerExact</a>($name){
<a name="l00736"></a>00736         $name = strtolower($name);
<a name="l00737"></a>00737         <span class="keywordflow">foreach</span>($this-&gt;getOnlinePlayers() as $player){
<a name="l00738"></a>00738             <span class="keywordflow">if</span>(strtolower($player-&gt;getName()) === $name){
<a name="l00739"></a>00739                 <span class="keywordflow">return</span> $player;
<a name="l00740"></a>00740             }
<a name="l00741"></a>00741         }
<a name="l00742"></a>00742 
<a name="l00743"></a>00743         <span class="keywordflow">return</span> null;
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 
<a name="l00751"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac1629347e675896064b5744a441dc189">00751</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac1629347e675896064b5744a441dc189">matchPlayer</a>($partialName){
<a name="l00752"></a>00752         $partialName = strtolower($partialName);
<a name="l00753"></a>00753         $matchedPlayers = [];
<a name="l00754"></a>00754         <span class="keywordflow">foreach</span>($this-&gt;getOnlinePlayers() as $player){
<a name="l00755"></a>00755             <span class="keywordflow">if</span>(strtolower($player-&gt;getName()) === $partialName){
<a name="l00756"></a>00756                 $matchedPlayers = array($player);
<a name="l00757"></a>00757                 <span class="keywordflow">break</span>;
<a name="l00758"></a>00758             }elseif(stripos($player-&gt;getName(), $partialName) !== <span class="keyword">false</span>){
<a name="l00759"></a>00759                 $matchedPlayers[] = $player;
<a name="l00760"></a>00760             }
<a name="l00761"></a>00761         }
<a name="l00762"></a>00762 
<a name="l00763"></a>00763         <span class="keywordflow">return</span> $matchedPlayers;
<a name="l00764"></a>00764     }
<a name="l00765"></a>00765 
<a name="l00769"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a367fb2e6f278c32c0ec534c92f20d1bb">00769</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a367fb2e6f278c32c0ec534c92f20d1bb">removePlayer</a>(<a class="code" href="../../df/d2c/classpocketmine_1_1_player.html">Player</a> $player){
<a name="l00770"></a>00770         <span class="keywordflow">if</span>($player-&gt;<a class="code" href="../../df/d2c/classpocketmine_1_1_player.html#ad129342e283c32902a928e413a11a136">isOnline</a>() === <span class="keyword">false</span>){
<a name="l00771"></a>00771             unset($this-&gt;players[$player-&gt;<a class="code" href="../../df/d2c/classpocketmine_1_1_player.html#a813a79221b9f51a6ef6f2b5de416735f">getAddress</a>() . <span class="stringliteral">&quot;:&quot;</span> . $player-&gt;<a class="code" href="../../df/d2c/classpocketmine_1_1_player.html#a5697e068c73b84615dcae1cc02ed8354">getPort</a>()]);
<a name="l00772"></a>00772         }
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774 
<a name="l00778"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1b3f6752c126bddaf3303b10a2854028">00778</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1b3f6752c126bddaf3303b10a2854028">getLevels</a>(){
<a name="l00779"></a>00779         <span class="keywordflow">return</span> $this-&gt;levels;
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781 
<a name="l00785"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af85e6e324f7a562c215383c24317cf2a">00785</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af85e6e324f7a562c215383c24317cf2a">getDefaultLevel</a>(){
<a name="l00786"></a>00786         <span class="keywordflow">return</span> $this-&gt;levelDefault;
<a name="l00787"></a>00787     }
<a name="l00788"></a>00788 
<a name="l00796"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab29b6a4f96f4ab25bb825f7bf3d2f3fe">00796</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab29b6a4f96f4ab25bb825f7bf3d2f3fe">setDefaultLevel</a>($level){
<a name="l00797"></a>00797         <span class="keywordflow">if</span>($level === null or ($this-&gt;isLevelLoaded($level-&gt;getFolderName()) and $level !== $this-&gt;levelDefault)){
<a name="l00798"></a>00798             $this-&gt;levelDefault = $level;
<a name="l00799"></a>00799         }
<a name="l00800"></a>00800     }
<a name="l00801"></a>00801 
<a name="l00807"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab753dd9eb97cec14e31636d3123cb3e3">00807</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab753dd9eb97cec14e31636d3123cb3e3">isLevelLoaded</a>($name){
<a name="l00808"></a>00808         <span class="keywordflow">return</span> $this-&gt;getLevelByName($name) instanceof Level;
<a name="l00809"></a>00809     }
<a name="l00810"></a>00810 
<a name="l00816"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2cca785b9348b216c90905f3df454a45">00816</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2cca785b9348b216c90905f3df454a45">getLevel</a>($levelId){
<a name="l00817"></a>00817         <span class="keywordflow">if</span>(isset($this-&gt;levels[$levelId])){
<a name="l00818"></a>00818             <span class="keywordflow">return</span> $this-&gt;levels[$levelId];
<a name="l00819"></a>00819         }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821         <span class="keywordflow">return</span> null;
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823 
<a name="l00829"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a021cf840abb4aa375bdb88caa1da81e6">00829</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a021cf840abb4aa375bdb88caa1da81e6">getLevelByName</a>($name){
<a name="l00830"></a>00830         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l00831"></a>00831             <span class="keywordflow">if</span>($level-&gt;getFolderName() === $name){
<a name="l00832"></a>00832                 <span class="keywordflow">return</span> $level;
<a name="l00833"></a>00833             }
<a name="l00834"></a>00834         }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836         <span class="keywordflow">return</span> null;
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838 
<a name="l00843"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1dbad5e1e5f4b5ac16818c5cff4ab85b">00843</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1dbad5e1e5f4b5ac16818c5cff4ab85b">unloadLevel</a>(Level $level, $forceUnload = <span class="keyword">false</span>){
<a name="l00844"></a>00844         <span class="keywordflow">if</span>($level-&gt;unload($forceUnload) === <span class="keyword">true</span> and $this-&gt;isLevelLoaded($level-&gt;getFolderName())){
<a name="l00845"></a>00845             unset($this-&gt;levels[$level-&gt;getID()]);
<a name="l00846"></a>00846         }
<a name="l00847"></a>00847     }
<a name="l00848"></a>00848 
<a name="l00858"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6214959ee395bc37213ad51c10a21c3c">00858</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6214959ee395bc37213ad51c10a21c3c">loadLevel</a>($name){
<a name="l00859"></a>00859         <span class="keywordflow">if</span>(trim($name) === <span class="stringliteral">&quot;&quot;</span>){
<a name="l00860"></a>00860             <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;Invalid empty level name&quot;</span>);
<a name="l00861"></a>00861         }
<a name="l00862"></a>00862         <span class="keywordflow">if</span>($this-&gt;isLevelLoaded($name)){
<a name="l00863"></a>00863             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00864"></a>00864         }elseif(!$this-&gt;isLevelGenerated($name)){
<a name="l00865"></a>00865             $this-&gt;logger-&gt;notice(<span class="stringliteral">&quot;Level \&quot;&quot;</span> . $name . <span class="stringliteral">&quot;\&quot; not found&quot;</span>);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00868"></a>00868         }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870         $path = $this-&gt;getDataPath() . <span class="stringliteral">&quot;worlds/&quot;</span> . $name . <span class="stringliteral">&quot;/&quot;</span>;
<a name="l00871"></a>00871 
<a name="l00872"></a>00872         $provider = LevelProviderManager::getProvider($path);
<a name="l00873"></a>00873 
<a name="l00874"></a>00874         <span class="keywordflow">if</span>($provider === null){
<a name="l00875"></a>00875             $this-&gt;logger-&gt;error(<span class="stringliteral">&quot;Could not load level \&quot;&quot;</span> . $name . <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l00876"></a>00876 
<a name="l00877"></a>00877             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00878"></a>00878         }
<a name="l00879"></a>00879         <span class="comment">//$entities = new Config($path.&quot;entities.yml&quot;, Config::YAML);</span>
<a name="l00880"></a>00880         <span class="comment">//if(file_exists($path . &quot;tileEntities.yml&quot;)){</span>
<a name="l00881"></a>00881         <span class="comment">//  @rename($path . &quot;tileEntities.yml&quot;, $path . &quot;tiles.yml&quot;);</span>
<a name="l00882"></a>00882         <span class="comment">//}</span>
<a name="l00883"></a>00883 
<a name="l00884"></a>00884         $level = <span class="keyword">new</span> Level($this, $name, $path, $provider);
<a name="l00885"></a>00885         $this-&gt;levels[$level-&gt;getID()] = $level;
<a name="l00886"></a>00886         <span class="comment">/*foreach($entities-&gt;getAll() as $entity){</span>
<a name="l00887"></a>00887 <span class="comment">            if(!isset($entity[&quot;id&quot;])){</span>
<a name="l00888"></a>00888 <span class="comment">                break;</span>
<a name="l00889"></a>00889 <span class="comment">            }</span>
<a name="l00890"></a>00890 <span class="comment">            if($entity[&quot;id&quot;] === 64){ //Item Drop</span>
<a name="l00891"></a>00891 <span class="comment">                $e = $this-&gt;server-&gt;api-&gt;entity-&gt;add($this-&gt;levels[$name], ENTITY_ITEM, $entity[&quot;Item&quot;][&quot;id&quot;], array(</span>
<a name="l00892"></a>00892 <span class="comment">                    &quot;meta&quot; =&gt; $entity[&quot;Item&quot;][&quot;Damage&quot;],</span>
<a name="l00893"></a>00893 <span class="comment">                    &quot;stack&quot; =&gt; $entity[&quot;Item&quot;][&quot;Count&quot;],</span>
<a name="l00894"></a>00894 <span class="comment">                    &quot;x&quot; =&gt; $entity[&quot;Pos&quot;][0],</span>
<a name="l00895"></a>00895 <span class="comment">                    &quot;y&quot; =&gt; $entity[&quot;Pos&quot;][1],</span>
<a name="l00896"></a>00896 <span class="comment">                    &quot;z&quot; =&gt; $entity[&quot;Pos&quot;][2],</span>
<a name="l00897"></a>00897 <span class="comment">                    &quot;yaw&quot; =&gt; $entity[&quot;Rotation&quot;][0],</span>
<a name="l00898"></a>00898 <span class="comment">                    &quot;pitch&quot; =&gt; $entity[&quot;Rotation&quot;][1],</span>
<a name="l00899"></a>00899 <span class="comment">                ));</span>
<a name="l00900"></a>00900 <span class="comment">            }elseif($entity[&quot;id&quot;] === FALLING_SAND){</span>
<a name="l00901"></a>00901 <span class="comment">                $e = $this-&gt;server-&gt;api-&gt;entity-&gt;add($this-&gt;levels[$name], ENTITY_FALLING, $entity[&quot;id&quot;], $entity);</span>
<a name="l00902"></a>00902 <span class="comment">                $e-&gt;setPosition(new Vector3($entity[&quot;Pos&quot;][0], $entity[&quot;Pos&quot;][1], $entity[&quot;Pos&quot;][2]), $entity[&quot;Rotation&quot;][0], $entity[&quot;Rotation&quot;][1]);</span>
<a name="l00903"></a>00903 <span class="comment">                $e-&gt;setHealth($entity[&quot;Health&quot;]);</span>
<a name="l00904"></a>00904 <span class="comment">            }elseif($entity[&quot;id&quot;] === OBJECT_PAINTING or $entity[&quot;id&quot;] === OBJECT_ARROW){ //Painting</span>
<a name="l00905"></a>00905 <span class="comment">                $e = $this-&gt;server-&gt;api-&gt;entity-&gt;add($this-&gt;levels[$name], ENTITY_OBJECT, $entity[&quot;id&quot;], $entity);</span>
<a name="l00906"></a>00906 <span class="comment">                $e-&gt;setPosition(new Vector3($entity[&quot;Pos&quot;][0], $entity[&quot;Pos&quot;][1], $entity[&quot;Pos&quot;][2]), $entity[&quot;Rotation&quot;][0], $entity[&quot;Rotation&quot;][1]);</span>
<a name="l00907"></a>00907 <span class="comment">                $e-&gt;setHealth(1);</span>
<a name="l00908"></a>00908 <span class="comment">            }else{</span>
<a name="l00909"></a>00909 <span class="comment">                $e = $this-&gt;server-&gt;api-&gt;entity-&gt;add($this-&gt;levels[$name], ENTITY_MOB, $entity[&quot;id&quot;], $entity);</span>
<a name="l00910"></a>00910 <span class="comment">                $e-&gt;setPosition(new Vector3($entity[&quot;Pos&quot;][0], $entity[&quot;Pos&quot;][1], $entity[&quot;Pos&quot;][2]), $entity[&quot;Rotation&quot;][0], $entity[&quot;Rotation&quot;][1]);</span>
<a name="l00911"></a>00911 <span class="comment">                $e-&gt;setHealth($entity[&quot;Health&quot;]);</span>
<a name="l00912"></a>00912 <span class="comment">            }</span>
<a name="l00913"></a>00913 <span class="comment">        }*/</span>
<a name="l00914"></a>00914 
<a name="l00915"></a>00915         <span class="comment">/*if(file_exists($path . &quot;tiles.yml&quot;)){</span>
<a name="l00916"></a>00916 <span class="comment">            $tiles = new Config($path . &quot;tiles.yml&quot;, Config::YAML);</span>
<a name="l00917"></a>00917 <span class="comment">            foreach($tiles-&gt;getAll() as $tile){</span>
<a name="l00918"></a>00918 <span class="comment">                if(!isset($tile[&quot;id&quot;])){</span>
<a name="l00919"></a>00919 <span class="comment">                    continue;</span>
<a name="l00920"></a>00920 <span class="comment">                }</span>
<a name="l00921"></a>00921 <span class="comment">                $level-&gt;loadChunk($tile[&quot;x&quot;] &gt;&gt; 4, $tile[&quot;z&quot;] &gt;&gt; 4);</span>
<a name="l00922"></a>00922 <span class="comment"></span>
<a name="l00923"></a>00923 <span class="comment">                $nbt = new Compound(false, []);</span>
<a name="l00924"></a>00924 <span class="comment">                foreach($tile as $index =&gt; $data){</span>
<a name="l00925"></a>00925 <span class="comment">                    switch($index){</span>
<a name="l00926"></a>00926 <span class="comment">                        case &quot;Items&quot;:</span>
<a name="l00927"></a>00927 <span class="comment">                            $tag = new Enum(&quot;Items&quot;, []);</span>
<a name="l00928"></a>00928 <span class="comment">                            $tag-&gt;setTagType(NBT::TAG_Compound);</span>
<a name="l00929"></a>00929 <span class="comment">                            foreach($data as $slot =&gt; $fields){</span>
<a name="l00930"></a>00930 <span class="comment">                                $tag[(int) $slot] = new Compound(false, array(</span>
<a name="l00931"></a>00931 <span class="comment">                                    &quot;Count&quot; =&gt; new Byte(&quot;Count&quot;, $fields[&quot;Count&quot;]),</span>
<a name="l00932"></a>00932 <span class="comment">                                    &quot;Slot&quot; =&gt; new Short(&quot;Slot&quot;, $fields[&quot;Slot&quot;]),</span>
<a name="l00933"></a>00933 <span class="comment">                                    &quot;Damage&quot; =&gt; new Short(&quot;Damage&quot;, $fields[&quot;Damage&quot;]),</span>
<a name="l00934"></a>00934 <span class="comment">                                    &quot;id&quot; =&gt; new String(&quot;id&quot;, $fields[&quot;id&quot;])</span>
<a name="l00935"></a>00935 <span class="comment">                                ));</span>
<a name="l00936"></a>00936 <span class="comment">                            }</span>
<a name="l00937"></a>00937 <span class="comment">                            $nbt[&quot;Items&quot;] = $tag;</span>
<a name="l00938"></a>00938 <span class="comment">                            break;</span>
<a name="l00939"></a>00939 <span class="comment"></span>
<a name="l00940"></a>00940 <span class="comment">                        case &quot;id&quot;:</span>
<a name="l00941"></a>00941 <span class="comment">                        case &quot;Text1&quot;:</span>
<a name="l00942"></a>00942 <span class="comment">                        case &quot;Text2&quot;:</span>
<a name="l00943"></a>00943 <span class="comment">                        case &quot;Text3&quot;:</span>
<a name="l00944"></a>00944 <span class="comment">                        case &quot;Text4&quot;:</span>
<a name="l00945"></a>00945 <span class="comment">                            $nbt[$index] = new String($index, $data);</span>
<a name="l00946"></a>00946 <span class="comment">                            break;</span>
<a name="l00947"></a>00947 <span class="comment"></span>
<a name="l00948"></a>00948 <span class="comment">                        case &quot;x&quot;:</span>
<a name="l00949"></a>00949 <span class="comment">                        case &quot;y&quot;:</span>
<a name="l00950"></a>00950 <span class="comment">                        case &quot;z&quot;:</span>
<a name="l00951"></a>00951 <span class="comment">                        case &quot;pairx&quot;:</span>
<a name="l00952"></a>00952 <span class="comment">                        case &quot;pairz&quot;:</span>
<a name="l00953"></a>00953 <span class="comment">                            $nbt[$index] = new Int($index, $data);</span>
<a name="l00954"></a>00954 <span class="comment">                            break;</span>
<a name="l00955"></a>00955 <span class="comment"></span>
<a name="l00956"></a>00956 <span class="comment">                        case &quot;BurnTime&quot;:</span>
<a name="l00957"></a>00957 <span class="comment">                        case &quot;CookTime&quot;:</span>
<a name="l00958"></a>00958 <span class="comment">                        case &quot;MaxTime&quot;:</span>
<a name="l00959"></a>00959 <span class="comment">                            $nbt[$index] = new Short($index, $data);</span>
<a name="l00960"></a>00960 <span class="comment">                            break;</span>
<a name="l00961"></a>00961 <span class="comment">                    }</span>
<a name="l00962"></a>00962 <span class="comment">                }</span>
<a name="l00963"></a>00963 <span class="comment">                switch($tile[&quot;id&quot;]){</span>
<a name="l00964"></a>00964 <span class="comment">                    case Tile::FURNACE:</span>
<a name="l00965"></a>00965 <span class="comment">                        new Furnace($level, $nbt);</span>
<a name="l00966"></a>00966 <span class="comment">                        break;</span>
<a name="l00967"></a>00967 <span class="comment">                    case Tile::CHEST:</span>
<a name="l00968"></a>00968 <span class="comment">                        new Chest($level, $nbt);</span>
<a name="l00969"></a>00969 <span class="comment">                        break;</span>
<a name="l00970"></a>00970 <span class="comment">                    case Tile::SIGN:</span>
<a name="l00971"></a>00971 <span class="comment">                        new Sign($level, $nbt);</span>
<a name="l00972"></a>00972 <span class="comment">                        break;</span>
<a name="l00973"></a>00973 <span class="comment">                }</span>
<a name="l00974"></a>00974 <span class="comment">            }</span>
<a name="l00975"></a>00975 <span class="comment">            unlink($path . &quot;tiles.yml&quot;);</span>
<a name="l00976"></a>00976 <span class="comment">            $level-&gt;save(true, true);</span>
<a name="l00977"></a>00977 <span class="comment">        }*/</span>
<a name="l00978"></a>00978 
<a name="l00979"></a>00979         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00980"></a>00980     }
<a name="l00981"></a>00981 
<a name="l00992"></a>00992     <span class="keyword">public</span> <span class="keyword">function</span> generateLevel($name, $seed = null, $generator = null, array $options = []){
<a name="l00993"></a>00993         <span class="keywordflow">if</span>(trim($name) === <span class="stringliteral">&quot;&quot;</span> or $this-&gt;isLevelGenerated($name)){
<a name="l00994"></a>00994             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00995"></a>00995         }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997         $seed = $seed === null ? Binary::readInt(Utils::getRandomBytes(4, <span class="keyword">false</span>)) : (int) $seed;
<a name="l00998"></a>00998 
<a name="l00999"></a>00999         <span class="keywordflow">if</span>($generator !== null and class_exists($generator) and is_subclass_of($generator, <span class="stringliteral">&quot;pocketmine\\level\\generator\\Generator&quot;</span>)){
<a name="l01000"></a>01000             $generator = <span class="keyword">new</span> $generator($options);
<a name="l01001"></a>01001         }<span class="keywordflow">else</span>{
<a name="l01002"></a>01002             <span class="keywordflow">if</span>(strtoupper($this-&gt;getLevelType()) == <span class="stringliteral">&quot;FLAT&quot;</span>){
<a name="l01003"></a>01003                 $generator = Generator::getGenerator(<span class="stringliteral">&quot;flat&quot;</span>);
<a name="l01004"></a>01004                 $options[<span class="stringliteral">&quot;preset&quot;</span>] = $this-&gt;getConfigString(<span class="stringliteral">&quot;generator-settings&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01005"></a>01005             }<span class="keywordflow">else</span>{
<a name="l01006"></a>01006                 $generator = Generator::getGenerator(<span class="stringliteral">&quot;normal&quot;</span>);
<a name="l01007"></a>01007             }
<a name="l01008"></a>01008         }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010         $provider = <span class="stringliteral">&quot;pocketmine\\level\\format\\anvil\\Anvil&quot;</span>;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012         $path = $this-&gt;getDataPath() . <span class="stringliteral">&quot;worlds/&quot;</span> . $name . <span class="stringliteral">&quot;/&quot;</span>;
<a name="l01014"></a>01014         $provider::generate($path, $name, $seed, $generator, $options);
<a name="l01015"></a>01015 
<a name="l01016"></a>01016         $level = <span class="keyword">new</span> Level($this, $name, $path, $provider);
<a name="l01017"></a>01017         $this-&gt;levels[$level-&gt;getID()] = $level;
<a name="l01018"></a>01018         <span class="keywordflow">for</span>($Z = 5; $Z &lt;= 11; ++$Z){
<a name="l01019"></a>01019             <span class="keywordflow">for</span>($X = 5; $X &lt;= 11; ++$X){
<a name="l01020"></a>01020                 $level-&gt;generateChunk($X, $Z);
<a name="l01021"></a>01021             }
<a name="l01022"></a>01022         }
<a name="l01023"></a>01023 
<a name="l01024"></a>01024         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01025"></a>01025     }
<a name="l01026"></a>01026 
<a name="l01032"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a69b304816e4908963dbecf833886a7c3">01032</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a69b304816e4908963dbecf833886a7c3">isLevelGenerated</a>($name){
<a name="l01033"></a>01033         <span class="keywordflow">if</span>(trim($name) === <span class="stringliteral">&quot;&quot;</span>){
<a name="l01034"></a>01034             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01035"></a>01035         }
<a name="l01036"></a>01036         $path = $this-&gt;getDataPath() . <span class="stringliteral">&quot;worlds/&quot;</span> . $name . <span class="stringliteral">&quot;/&quot;</span>;
<a name="l01037"></a>01037         <span class="keywordflow">if</span>(!($this-&gt;getLevelByName($name) instanceof Level)){
<a name="l01038"></a>01038 
<a name="l01039"></a>01039             <span class="keywordflow">if</span>(LevelProviderManager::getProvider($path) === null){
<a name="l01040"></a>01040                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01041"></a>01041             }
<a name="l01042"></a>01042             <span class="comment">/*if(file_exists($path)){</span>
<a name="l01043"></a>01043 <span class="comment">                $level = new LevelImport($path);</span>
<a name="l01044"></a>01044 <span class="comment">                if($level-&gt;import() === false){ //Try importing a world</span>
<a name="l01045"></a>01045 <span class="comment">                    return false;</span>
<a name="l01046"></a>01046 <span class="comment">                }</span>
<a name="l01047"></a>01047 <span class="comment">            }else{</span>
<a name="l01048"></a>01048 <span class="comment">                return false;</span>
<a name="l01049"></a>01049 <span class="comment">            }*/</span>
<a name="l01050"></a>01050         }
<a name="l01051"></a>01051 
<a name="l01052"></a>01052         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01053"></a>01053     }
<a name="l01054"></a>01054 
<a name="l01061"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#adda555a21068a3533daca72a7af81a3a">01061</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#adda555a21068a3533daca72a7af81a3a">getConfigString</a>($variable, $defaultValue = <span class="stringliteral">&quot;&quot;</span>){
<a name="l01062"></a>01062         $v = getopt(<span class="stringliteral">&quot;&quot;</span>, array(<span class="stringliteral">&quot;$variable::&quot;</span>));
<a name="l01063"></a>01063         <span class="keywordflow">if</span>(isset($v[$variable])){
<a name="l01064"></a>01064             <span class="keywordflow">return</span> (<span class="keywordtype">string</span>) $v[$variable];
<a name="l01065"></a>01065         }
<a name="l01066"></a>01066 
<a name="l01067"></a>01067         <span class="keywordflow">return</span> $this-&gt;properties-&gt;exists($variable) ? $this-&gt;properties-&gt;get($variable) : $defaultValue;
<a name="l01068"></a>01068     }
<a name="l01069"></a>01069 
<a name="l01076"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac265f101529c1a415db5927c18c34726">01076</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac265f101529c1a415db5927c18c34726">getProperty</a>($variable, $defaultValue = null){
<a name="l01077"></a>01077         $vars = explode(<span class="stringliteral">&quot;.&quot;</span>, $variable);
<a name="l01078"></a>01078         $base = array_shift($vars);
<a name="l01079"></a>01079         <span class="keywordflow">if</span>($this-&gt;config-&gt;exists($base)){
<a name="l01080"></a>01080             $base = $this-&gt;config-&gt;get($base);
<a name="l01081"></a>01081         }<span class="keywordflow">else</span>{
<a name="l01082"></a>01082             <span class="keywordflow">return</span> $defaultValue;
<a name="l01083"></a>01083         }
<a name="l01084"></a>01084 
<a name="l01085"></a>01085         <span class="keywordflow">while</span>(count($vars) &gt; 0){
<a name="l01086"></a>01086             $baseKey = array_shift($vars);
<a name="l01087"></a>01087             <span class="keywordflow">if</span>(is_array($base) and isset($base[$baseKey])){
<a name="l01088"></a>01088                 $base = $base[$baseKey];
<a name="l01089"></a>01089             }<span class="keywordflow">else</span>{
<a name="l01090"></a>01090                 <span class="keywordflow">return</span> $defaultValue;
<a name="l01091"></a>01091             }
<a name="l01092"></a>01092         }
<a name="l01093"></a>01093 
<a name="l01094"></a>01094         <span class="keywordflow">return</span> $base;
<a name="l01095"></a>01095     }
<a name="l01096"></a>01096 
<a name="l01101"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a066ef60cf58c5bcd99e11d8915a0eada">01101</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a066ef60cf58c5bcd99e11d8915a0eada">setConfigString</a>($variable, $value){
<a name="l01102"></a>01102         $this-&gt;properties-&gt;set($variable, $value);
<a name="l01103"></a>01103     }
<a name="l01104"></a>01104 
<a name="l01111"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a18d2faa05c5d6fc74e1a20490f0920a9">01111</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a18d2faa05c5d6fc74e1a20490f0920a9">getConfigInt</a>($variable, $defaultValue = 0){
<a name="l01112"></a>01112         $v = getopt(<span class="stringliteral">&quot;&quot;</span>, array(<span class="stringliteral">&quot;$variable::&quot;</span>));
<a name="l01113"></a>01113         <span class="keywordflow">if</span>(isset($v[$variable])){
<a name="l01114"></a>01114             <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) $v[$variable];
<a name="l01115"></a>01115         }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117         <span class="keywordflow">return</span> $this-&gt;properties-&gt;exists($variable) ? (int) $this-&gt;properties-&gt;get($variable) : (int) $defaultValue;
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119 
<a name="l01124"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abd71b5ad117b1ba5af5665abed2c3c49">01124</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abd71b5ad117b1ba5af5665abed2c3c49">setConfigInt</a>($variable, $value){
<a name="l01125"></a>01125         $this-&gt;properties-&gt;set($variable, (<span class="keywordtype">int</span>) $value);
<a name="l01126"></a>01126     }
<a name="l01127"></a>01127 
<a name="l01134"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a02bc691da9dbf2429fc2ffa1729f9910">01134</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a02bc691da9dbf2429fc2ffa1729f9910">getConfigBoolean</a>($variable, $defaultValue = <span class="keyword">false</span>){
<a name="l01135"></a>01135         $v = getopt(<span class="stringliteral">&quot;&quot;</span>, array(<span class="stringliteral">&quot;$variable::&quot;</span>));
<a name="l01136"></a>01136         <span class="keywordflow">if</span>(isset($v[$variable])){
<a name="l01137"></a>01137             $value = $v[$variable];
<a name="l01138"></a>01138         }<span class="keywordflow">else</span>{
<a name="l01139"></a>01139             $value = $this-&gt;properties-&gt;exists($variable) ? $this-&gt;properties-&gt;get($variable) : $defaultValue;
<a name="l01140"></a>01140         }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142         <span class="keywordflow">if</span>(is_bool($value)){
<a name="l01143"></a>01143             <span class="keywordflow">return</span> $value;
<a name="l01144"></a>01144         }
<a name="l01145"></a>01145         <span class="keywordflow">switch</span>(strtolower($value)){
<a name="l01146"></a>01146             <span class="keywordflow">case</span> <span class="stringliteral">&quot;on&quot;</span>:
<a name="l01147"></a>01147             <span class="keywordflow">case</span> <span class="stringliteral">&quot;true&quot;</span>:
<a name="l01148"></a>01148             <span class="keywordflow">case</span> <span class="stringliteral">&quot;1&quot;</span>:
<a name="l01149"></a>01149             <span class="keywordflow">case</span> <span class="stringliteral">&quot;yes&quot;</span>:
<a name="l01150"></a>01150                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01151"></a>01151         }
<a name="l01152"></a>01152 
<a name="l01153"></a>01153         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01154"></a>01154     }
<a name="l01155"></a>01155 
<a name="l01160"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ad668cf5d808100a8c610b92eb4a0eaea">01160</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ad668cf5d808100a8c610b92eb4a0eaea">setConfigBool</a>($variable, $value){
<a name="l01161"></a>01161         $this-&gt;properties-&gt;set($variable, $value == <span class="keyword">true</span> ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);
<a name="l01162"></a>01162     }
<a name="l01163"></a>01163 
<a name="l01169"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6349a96662299bd31b23e2db65e877d3">01169</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6349a96662299bd31b23e2db65e877d3">getPluginCommand</a>($name){
<a name="l01170"></a>01170         <span class="keywordflow">if</span>(($command = $this-&gt;commandMap-&gt;getCommand($name)) instanceof PluginIdentifiableCommand){
<a name="l01171"></a>01171             <span class="keywordflow">return</span> $command;
<a name="l01172"></a>01172         }<span class="keywordflow">else</span>{
<a name="l01173"></a>01173             <span class="keywordflow">return</span> null;
<a name="l01174"></a>01174         }
<a name="l01175"></a>01175     }
<a name="l01176"></a>01176 
<a name="l01180"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aef9a89a6ddfa4f24db1e6591943c8d36">01180</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aef9a89a6ddfa4f24db1e6591943c8d36">getNameBans</a>(){
<a name="l01181"></a>01181         <span class="keywordflow">return</span> $this-&gt;banByName;
<a name="l01182"></a>01182     }
<a name="l01183"></a>01183 
<a name="l01187"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a860eca57448382c37113d750e07f1a0d">01187</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a860eca57448382c37113d750e07f1a0d">getIPBans</a>(){
<a name="l01188"></a>01188         <span class="keywordflow">return</span> $this-&gt;banByIP;
<a name="l01189"></a>01189     }
<a name="l01190"></a>01190 
<a name="l01194"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af2e736d87e59fefd0665884e44249dc5">01194</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af2e736d87e59fefd0665884e44249dc5">addOp</a>($name){
<a name="l01195"></a>01195         $this-&gt;operators-&gt;set(strtolower($name), <span class="keyword">true</span>);
<a name="l01196"></a>01196 
<a name="l01197"></a>01197         <span class="keywordflow">if</span>(($player = $this-&gt;getPlayerExact($name)) instanceof <a class="code" href="../../df/d2c/classpocketmine_1_1_player.html">Player</a>){
<a name="l01198"></a>01198             $player-&gt;recalculatePermissions();
<a name="l01199"></a>01199         }
<a name="l01200"></a>01200         $this-&gt;operators-&gt;save();
<a name="l01201"></a>01201     }
<a name="l01202"></a>01202 
<a name="l01206"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a130fbe5b5da60c7b89062fd98a798830">01206</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a130fbe5b5da60c7b89062fd98a798830">removeOp</a>($name){
<a name="l01207"></a>01207         $this-&gt;operators-&gt;remove(strtolower($name));
<a name="l01208"></a>01208 
<a name="l01209"></a>01209         <span class="keywordflow">if</span>(($player = $this-&gt;getPlayerExact($name)) instanceof <a class="code" href="../../df/d2c/classpocketmine_1_1_player.html">Player</a>){
<a name="l01210"></a>01210             $player-&gt;recalculatePermissions();
<a name="l01211"></a>01211         }
<a name="l01212"></a>01212         $this-&gt;operators-&gt;save();
<a name="l01213"></a>01213     }
<a name="l01214"></a>01214 
<a name="l01218"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa49d4ae6654a2661dc8d3486d03a74ca">01218</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa49d4ae6654a2661dc8d3486d03a74ca">addWhitelist</a>($name){
<a name="l01219"></a>01219         $this-&gt;whitelist-&gt;set(strtolower($name), <span class="keyword">true</span>);
<a name="l01220"></a>01220         $this-&gt;whitelist-&gt;save();
<a name="l01221"></a>01221     }
<a name="l01222"></a>01222 
<a name="l01226"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aeb881b8fae095764efeb0ececee8f60d">01226</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aeb881b8fae095764efeb0ececee8f60d">removeWhitelist</a>($name){
<a name="l01227"></a>01227         $this-&gt;whitelist-&gt;remove(strtolower($name));
<a name="l01228"></a>01228         $this-&gt;whitelist-&gt;save();
<a name="l01229"></a>01229     }
<a name="l01230"></a>01230 
<a name="l01236"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a925730d6322733ed1d4b25f465e29861">01236</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a925730d6322733ed1d4b25f465e29861">isWhitelisted</a>($name){
<a name="l01237"></a>01237         <span class="keywordflow">return</span> !$this-&gt;hasWhitelist() or $this-&gt;operators-&gt;exists($name, <span class="keyword">true</span>) or $this-&gt;whitelist-&gt;exists($name, <span class="keyword">true</span>);
<a name="l01238"></a>01238     }
<a name="l01239"></a>01239 
<a name="l01245"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a19138d1076b6f6eaa10ab9b4a09296ea">01245</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a19138d1076b6f6eaa10ab9b4a09296ea">isOp</a>($name){
<a name="l01246"></a>01246         <span class="keywordflow">return</span> $this-&gt;operators-&gt;exists($name, <span class="keyword">true</span>);
<a name="l01247"></a>01247     }
<a name="l01248"></a>01248 
<a name="l01252"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a725ac49cf0ff1d37bb90457c1507874f">01252</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a725ac49cf0ff1d37bb90457c1507874f">getWhitelisted</a>(){
<a name="l01253"></a>01253         <span class="keywordflow">return</span> $this-&gt;whitelist;
<a name="l01254"></a>01254     }
<a name="l01255"></a>01255 
<a name="l01259"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a69fbc0762846eb5c23205f4342815a7e">01259</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a69fbc0762846eb5c23205f4342815a7e">getOPs</a>(){
<a name="l01260"></a>01260         <span class="keywordflow">return</span> $this-&gt;operators;
<a name="l01261"></a>01261     }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263     <span class="keyword">public</span> <span class="keyword">function</span> reloadWhitelist(){
<a name="l01264"></a>01264         $this-&gt;whitelist-&gt;reload();
<a name="l01265"></a>01265     }
<a name="l01266"></a>01266 
<a name="l01270"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a54adb1578aafddec9f34c1af3f660b45">01270</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a54adb1578aafddec9f34c1af3f660b45">getCommandAliases</a>(){
<a name="l01271"></a>01271         $section = $this-&gt;getProperty(<span class="stringliteral">&quot;aliases&quot;</span>);
<a name="l01272"></a>01272         $result = [];
<a name="l01273"></a>01273         <span class="keywordflow">if</span>(is_array($section)){
<a name="l01274"></a>01274             <span class="keywordflow">foreach</span>($section as $key =&gt; $value){
<a name="l01275"></a>01275                 $commands = [];
<a name="l01276"></a>01276                 <span class="keywordflow">if</span>(is_array($value)){
<a name="l01277"></a>01277                     $commands = $value;
<a name="l01278"></a>01278                 }<span class="keywordflow">else</span>{
<a name="l01279"></a>01279                     $commands[] = $value;
<a name="l01280"></a>01280                 }
<a name="l01281"></a>01281 
<a name="l01282"></a>01282                 $result[$key] = $commands;
<a name="l01283"></a>01283             }
<a name="l01284"></a>01284         }
<a name="l01285"></a>01285 
<a name="l01286"></a>01286         <span class="keywordflow">return</span> $result;
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288 
<a name="l01292"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8d9b9873eb3c7efce048f10f803c2b2e">01292</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8d9b9873eb3c7efce048f10f803c2b2e">getInstance</a>(){
<a name="l01293"></a>01293         <span class="keywordflow">return</span> self::$instance;
<a name="l01294"></a>01294     }
<a name="l01295"></a>01295 
<a name="l01303"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af97447fb9c82067aab4c6fd9e2dfea6c">01303</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af97447fb9c82067aab4c6fd9e2dfea6c">__construct</a>(\SplClassLoader $autoloader, \<a class="code" href="../../d0/d55/class_threaded_logger.html">ThreadedLogger</a> $logger, $filePath, $dataPath, $pluginPath){
<a name="l01304"></a>01304         self::$instance = $this;
<a name="l01305"></a>01305 
<a name="l01306"></a>01306         $this-&gt;autoloader = $autoloader;
<a name="l01307"></a>01307         $this-&gt;logger = $logger;
<a name="l01308"></a>01308         $this-&gt;filePath = $filePath;
<a name="l01309"></a>01309         $this-&gt;dataPath = $dataPath;
<a name="l01310"></a>01310         $this-&gt;pluginPath = $pluginPath;
<a name="l01311"></a>01311         @mkdir($this-&gt;dataPath . <span class="stringliteral">&quot;worlds/&quot;</span>, 0777);
<a name="l01312"></a>01312         @mkdir($this-&gt;dataPath . <span class="stringliteral">&quot;players/&quot;</span>, 0777);
<a name="l01313"></a>01313         @mkdir($this-&gt;pluginPath, 0777);
<a name="l01314"></a>01314 
<a name="l01315"></a>01315         $this-&gt;entityMetadata = <span class="keyword">new</span> EntityMetadataStore();
<a name="l01316"></a>01316         $this-&gt;playerMetadata = <span class="keyword">new</span> PlayerMetadataStore();
<a name="l01317"></a>01317         $this-&gt;levelMetadata = <span class="keyword">new</span> LevelMetadataStore();
<a name="l01318"></a>01318 
<a name="l01319"></a>01319         $this-&gt;operators = new Config($this-&gt;dataPath . <span class="stringliteral">&quot;ops.txt&quot;</span>, Config::ENUM);
<a name="l01320"></a>01320         $this-&gt;whitelist = <span class="keyword">new</span> Config($this-&gt;dataPath . <span class="stringliteral">&quot;white-list.txt&quot;</span>, Config::ENUM);
<a name="l01321"></a>01321         <span class="keywordflow">if</span>(file_exists($this-&gt;dataPath . <span class="stringliteral">&quot;banned.txt&quot;</span>) and !file_exists($this-&gt;dataPath . <span class="stringliteral">&quot;banned-players.txt&quot;</span>)){
<a name="l01322"></a>01322             @rename($this-&gt;dataPath . <span class="stringliteral">&quot;banned.txt&quot;</span>, $this-&gt;dataPath . <span class="stringliteral">&quot;banned-players.txt&quot;</span>);
<a name="l01323"></a>01323         }
<a name="l01324"></a>01324         @touch($this-&gt;dataPath . <span class="stringliteral">&quot;banned-players.txt&quot;</span>);
<a name="l01325"></a>01325         $this-&gt;banByName = <span class="keyword">new</span> BanList($this-&gt;dataPath . <span class="stringliteral">&quot;banned-players.txt&quot;</span>);
<a name="l01326"></a>01326         $this-&gt;banByName-&gt;load();
<a name="l01327"></a>01327         @touch($this-&gt;dataPath . <span class="stringliteral">&quot;banned-ips.txt&quot;</span>);
<a name="l01328"></a>01328         $this-&gt;banByIP = <span class="keyword">new</span> BanList($this-&gt;dataPath . <span class="stringliteral">&quot;banned-ips.txt&quot;</span>);
<a name="l01329"></a>01329         $this-&gt;banByIP-&gt;load();
<a name="l01330"></a>01330 
<a name="l01331"></a>01331         $this-&gt;console = <span class="keyword">new</span> CommandReader();
<a name="l01332"></a>01332 
<a name="l01333"></a>01333         $version = <span class="keyword">new</span> VersionString($this-&gt;getPocketMineVersion());
<a name="l01334"></a>01334         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Starting Minecraft: PE server version &quot;</span> . TextFormat::AQUA . $this-&gt;getVersion());
<a name="l01335"></a>01335 
<a name="l01336"></a>01336         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Loading properties...&quot;</span>);
<a name="l01337"></a>01337         <span class="keywordflow">if</span>(!file_exists($this-&gt;dataPath . <span class="stringliteral">&quot;pocketmine.yml&quot;</span>)){
<a name="l01338"></a>01338             @file_put_contents($this-&gt;dataPath . <span class="stringliteral">&quot;pocketmine.yml&quot;</span>, file_get_contents($this-&gt;filePath . <span class="stringliteral">&quot;src/pocketmine/resources/pocketmine.yml&quot;</span>));
<a name="l01339"></a>01339         }
<a name="l01340"></a>01340         $this-&gt;config = <span class="keyword">new</span> Config($this-&gt;dataPath . <span class="stringliteral">&quot;pocketmine.yml&quot;</span>, Config::YAML, []);
<a name="l01341"></a>01341         $this-&gt;properties = <span class="keyword">new</span> Config($this-&gt;dataPath . <span class="stringliteral">&quot;server.properties&quot;</span>, Config::PROPERTIES, array(
<a name="l01342"></a>01342             <span class="stringliteral">&quot;motd&quot;</span> =&gt; <span class="stringliteral">&quot;Minecraft: PE Server&quot;</span>,
<a name="l01343"></a>01343             <span class="stringliteral">&quot;server-port&quot;</span> =&gt; 19132,
<a name="l01344"></a>01344             <span class="stringliteral">&quot;memory-limit&quot;</span> =&gt; <span class="stringliteral">&quot;256M&quot;</span>,
<a name="l01345"></a>01345             <span class="stringliteral">&quot;white-list&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01346"></a>01346             <span class="stringliteral">&quot;announce-player-achievements&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01347"></a>01347             <span class="stringliteral">&quot;spawn-protection&quot;</span> =&gt; 16,
<a name="l01348"></a>01348             <span class="stringliteral">&quot;view-distance&quot;</span> =&gt; 8,
<a name="l01349"></a>01349             <span class="stringliteral">&quot;max-players&quot;</span> =&gt; 20,
<a name="l01350"></a>01350             <span class="stringliteral">&quot;allow-flight&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01351"></a>01351             <span class="stringliteral">&quot;spawn-animals&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01352"></a>01352             <span class="stringliteral">&quot;spawn-mobs&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01353"></a>01353             <span class="stringliteral">&quot;gamemode&quot;</span> =&gt; 0,
<a name="l01354"></a>01354             <span class="stringliteral">&quot;force-gamemode&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01355"></a>01355             <span class="stringliteral">&quot;hardcore&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01356"></a>01356             <span class="stringliteral">&quot;pvp&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01357"></a>01357             <span class="stringliteral">&quot;difficulty&quot;</span> =&gt; 1,
<a name="l01358"></a>01358             <span class="stringliteral">&quot;generator-settings&quot;</span> =&gt; <span class="stringliteral">&quot;&quot;</span>,
<a name="l01359"></a>01359             <span class="stringliteral">&quot;level-name&quot;</span> =&gt; <span class="stringliteral">&quot;world&quot;</span>,
<a name="l01360"></a>01360             <span class="stringliteral">&quot;level-seed&quot;</span> =&gt; <span class="stringliteral">&quot;&quot;</span>,
<a name="l01361"></a>01361             <span class="stringliteral">&quot;level-type&quot;</span> =&gt; <span class="stringliteral">&quot;DEFAULT&quot;</span>,
<a name="l01362"></a>01362             <span class="stringliteral">&quot;enable-query&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01363"></a>01363             <span class="stringliteral">&quot;enable-rcon&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01364"></a>01364             <span class="stringliteral">&quot;rcon.password&quot;</span> =&gt; substr(base64_encode(Utils::getRandomBytes(20, <span class="keyword">false</span>)), 3, 10),
<a name="l01365"></a>01365             <span class="stringliteral">&quot;auto-save&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01366"></a>01366         ));
<a name="l01367"></a>01367 
<a name="l01368"></a>01368         ServerScheduler::$WORKERS = $this-&gt;getProperty(<span class="stringliteral">&quot;settings.async-workers&quot;</span>, ServerScheduler::$WORKERS);
<a name="l01369"></a>01369 
<a name="l01370"></a>01370         $this-&gt;scheduler = <span class="keyword">new</span> ServerScheduler();
<a name="l01371"></a>01371 
<a name="l01372"></a>01372         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;enable-rcon&quot;</span>, <span class="keyword">false</span>) === <span class="keyword">true</span>){
<a name="l01373"></a>01373             $this-&gt;rcon = <span class="keyword">new</span> RCON($this-&gt;getConfigString(<span class="stringliteral">&quot;rcon.password&quot;</span>, <span class="stringliteral">&quot;&quot;</span>), $this-&gt;getConfigInt(<span class="stringliteral">&quot;rcon.port&quot;</span>, $this-&gt;getPort()), ($ip = $this-&gt;getIp()) != <span class="stringliteral">&quot;&quot;</span> ? $ip : <span class="stringliteral">&quot;0.0.0.0&quot;</span>, $this-&gt;getConfigInt(<span class="stringliteral">&quot;rcon.threads&quot;</span>, 1), $this-&gt;getConfigInt(<span class="stringliteral">&quot;rcon.clients-per-thread&quot;</span>, 50));
<a name="l01374"></a>01374         }
<a name="l01375"></a>01375 
<a name="l01376"></a>01376         $this-&gt;maxPlayers = $this-&gt;getConfigInt(<span class="stringliteral">&quot;max-players&quot;</span>, 20);
<a name="l01377"></a>01377 
<a name="l01378"></a>01378         <span class="keywordflow">if</span>(($memory = str_replace(<span class="stringliteral">&quot;B&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, strtoupper($this-&gt;getConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>, <span class="stringliteral">&quot;128M&quot;</span>)))) !== <span class="keyword">false</span>){
<a name="l01379"></a>01379             $value = array(<span class="stringliteral">&quot;M&quot;</span> =&gt; 1, <span class="stringliteral">&quot;G&quot;</span> =&gt; 1024);
<a name="l01380"></a>01380             $real = ((int) substr($memory, 0, -1)) * $value[substr($memory, -1)];
<a name="l01381"></a>01381             <span class="keywordflow">if</span>($real &lt; 128){
<a name="l01382"></a>01382                 $this-&gt;logger-&gt;warning(<span class="stringliteral">&quot;PocketMine-MP may not work right with less than 128MB of RAM&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01383"></a>01383             }
<a name="l01384"></a>01384             @ini_set(<span class="stringliteral">&quot;memory_limit&quot;</span>, $memory);
<a name="l01385"></a>01385         }<span class="keywordflow">else</span>{
<a name="l01386"></a>01386             $this-&gt;setConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>, <span class="stringliteral">&quot;128M&quot;</span>);
<a name="l01387"></a>01387         }
<a name="l01388"></a>01388 
<a name="l01389"></a>01389         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;hardcore&quot;</span>, <span class="keyword">false</span>) === <span class="keyword">true</span> and $this-&gt;getDifficulty() &lt; 3){
<a name="l01390"></a>01390             $this-&gt;setConfigInt(<span class="stringliteral">&quot;difficulty&quot;</span>, 3);
<a name="l01391"></a>01391         }
<a name="l01392"></a>01392 
<a name="l01393"></a>01393         define(<span class="stringliteral">&quot;pocketmine\\DEBUG&quot;</span>, $this-&gt;getProperty(<span class="stringliteral">&quot;debug.level&quot;</span>, 1));
<a name="l01394"></a>01394         <span class="keywordflow">if</span>($this-&gt;logger instanceof MainLogger){
<a name="l01395"></a>01395             $this-&gt;logger-&gt;setLogDebug(\pocketmine\DEBUG &gt; 1);
<a name="l01396"></a>01396         }
<a name="l01397"></a>01397         define(<span class="stringliteral">&quot;ADVANCED_CACHE&quot;</span>, $this-&gt;getProperty(<span class="stringliteral">&quot;settings.advanced-cache&quot;</span>, <span class="keyword">false</span>));
<a name="l01398"></a>01398         <span class="keywordflow">if</span>(ADVANCED_CACHE == <span class="keyword">true</span>){
<a name="l01399"></a>01399             $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Advanced cache enabled&quot;</span>);
<a name="l01400"></a>01400         }
<a name="l01401"></a>01401 
<a name="l01402"></a>01402         Level::$COMPRESSION_LEVEL = $this-&gt;getProperty(<span class="stringliteral">&quot;chunk-sending.compression-level&quot;</span>, 7);
<a name="l01403"></a>01403 
<a name="l01404"></a>01404         <span class="keywordflow">if</span>(defined(<span class="stringliteral">&quot;pocketmine\\DEBUG&quot;</span>) and \pocketmine\DEBUG &gt;= 0 and function_exists(<span class="stringliteral">&quot;cli_set_process_title&quot;</span>)){
<a name="l01405"></a>01405             @cli_set_process_title(<span class="stringliteral">&quot;PocketMine-MP &quot;</span> . $this-&gt;getPocketMineVersion());
<a name="l01406"></a>01406         }
<a name="l01407"></a>01407 
<a name="l01408"></a>01408         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Starting Minecraft PE server on &quot;</span> . ($this-&gt;getIp() === <span class="stringliteral">&quot;&quot;</span> ? <span class="stringliteral">&quot;*&quot;</span> : $this-&gt;getIp()) . <span class="stringliteral">&quot;:&quot;</span> . $this-&gt;getPort());
<a name="l01409"></a>01409         define(<span class="stringliteral">&quot;BOOTUP_RANDOM&quot;</span>, Utils::getRandomBytes(16));
<a name="l01410"></a>01410         $this-&gt;serverID = Binary::readLong(substr(Utils::getUniqueID(<span class="keyword">true</span>, $this-&gt;getIp() . $this-&gt;getPort()), 0, 8));
<a name="l01411"></a>01411 
<a name="l01412"></a>01412         $this-&gt;interfaces[] = <span class="keyword">new</span> RakLibInterface($this);
<a name="l01413"></a>01413 
<a name="l01414"></a>01414         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;This server is running PocketMine-MP version &quot;</span> . ($version-&gt;isDev() ? TextFormat::YELLOW : <span class="stringliteral">&quot;&quot;</span>) . $version-&gt;get(<span class="keyword">false</span>) . TextFormat::RESET . <span class="stringliteral">&quot; \&quot;&quot;</span> . $this-&gt;getCodename() . <span class="stringliteral">&quot;\&quot; (API &quot;</span> . $this-&gt;getApiVersion() . <span class="stringliteral">&quot;)&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01415"></a>01415         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;PocketMine-MP is distributed under the LGPL License&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01416"></a>01416 
<a name="l01417"></a>01417         $this-&gt;consoleSender = <span class="keyword">new</span> ConsoleCommandSender();
<a name="l01418"></a>01418         $this-&gt;commandMap = <span class="keyword">new</span> SimpleCommandMap($this);
<a name="l01419"></a>01419 
<a name="l01420"></a>01420         InventoryType::init();
<a name="l01421"></a>01421         Block::init();
<a name="l01422"></a>01422         Item::init();
<a name="l01423"></a>01423         $this-&gt;craftingManager = <span class="keyword">new</span> CraftingManager();
<a name="l01424"></a>01424 
<a name="l01425"></a>01425         $this-&gt;pluginManager = <span class="keyword">new</span> PluginManager($this, $this-&gt;commandMap);
<a name="l01426"></a>01426         $this-&gt;pluginManager-&gt;subscribeToPermission(Server::BROADCAST_CHANNEL_ADMINISTRATIVE, $this-&gt;consoleSender);
<a name="l01427"></a>01427         $this-&gt;pluginManager-&gt;registerInterface(<span class="stringliteral">&quot;pocketmine\\plugin\\PharPluginLoader&quot;</span>);
<a name="l01428"></a>01428         $this-&gt;pluginManager-&gt;loadPlugins($this-&gt;pluginPath);
<a name="l01429"></a>01429 
<a name="l01430"></a>01430         $this-&gt;updater = <span class="keyword">new</span> AutoUpdater($this, $this-&gt;getProperty(<span class="stringliteral">&quot;auto-updater.host&quot;</span>, <span class="stringliteral">&quot;www.pocketmine.net&quot;</span>));
<a name="l01431"></a>01431 
<a name="l01432"></a>01432         $this-&gt;enablePlugins(PluginLoadOrder::STARTUP);
<a name="l01433"></a>01433 
<a name="l01434"></a>01434         $this-&gt;generationManager = <span class="keyword">new</span> GenerationRequestManager($this);
<a name="l01435"></a>01435 
<a name="l01436"></a>01436         LevelProviderManager::addProvider($this, <span class="stringliteral">&quot;pocketmine\\level\\format\\anvil\\Anvil&quot;</span>);
<a name="l01437"></a>01437 
<a name="l01438"></a>01438 
<a name="l01439"></a>01439         Generator::addGenerator(<span class="stringliteral">&quot;pocketmine\\level\\generator\\Flat&quot;</span>, <span class="stringliteral">&quot;flat&quot;</span>);
<a name="l01440"></a>01440         Generator::addGenerator(<span class="stringliteral">&quot;pocketmine\\level\\generator\\Normal&quot;</span>, <span class="stringliteral">&quot;normal&quot;</span>);
<a name="l01441"></a>01441         Generator::addGenerator(<span class="stringliteral">&quot;pocketmine\\level\\generator\\Normal&quot;</span>, <span class="stringliteral">&quot;default&quot;</span>);
<a name="l01442"></a>01442 
<a name="l01443"></a>01443         <span class="keywordflow">if</span>($this-&gt;getDefaultLevel() === null){
<a name="l01444"></a>01444             $default = $this-&gt;getConfigString(<span class="stringliteral">&quot;level-name&quot;</span>, <span class="stringliteral">&quot;world&quot;</span>);
<a name="l01445"></a>01445             <span class="keywordflow">if</span>(trim($default) == <span class="stringliteral">&quot;&quot;</span>){
<a name="l01446"></a>01446                 trigger_error(<span class="stringliteral">&quot;level-name cannot be null, using default&quot;</span>, E_USER_WARNING);
<a name="l01447"></a>01447                 $default = <span class="stringliteral">&quot;world&quot;</span>;
<a name="l01448"></a>01448                 $this-&gt;setConfigString(<span class="stringliteral">&quot;level-name&quot;</span>, <span class="stringliteral">&quot;world&quot;</span>);
<a name="l01449"></a>01449             }
<a name="l01450"></a>01450             <span class="keywordflow">if</span>($this-&gt;loadLevel($default) === <span class="keyword">false</span>){
<a name="l01451"></a>01451                 $seed = $this-&gt;getConfigInt(<span class="stringliteral">&quot;level-seed&quot;</span>, time());
<a name="l01452"></a>01452                 $this-&gt;generateLevel($default, $seed === 0 ? time() : $seed);
<a name="l01453"></a>01453             }
<a name="l01454"></a>01454 
<a name="l01455"></a>01455             $this-&gt;setDefaultLevel($this-&gt;getLevelByName($default));
<a name="l01456"></a>01456         }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458 
<a name="l01459"></a>01459         $this-&gt;properties-&gt;save();
<a name="l01460"></a>01460 
<a name="l01461"></a>01461         $this-&gt;scheduler-&gt;scheduleDelayedRepeatingTask(<span class="keyword">new</span> CallbackTask(<span class="stringliteral">&quot;pocketmine\\utils\\Cache::cleanup&quot;</span>), $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.cache-cleanup&quot;</span>, 900), $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.cache-cleanup&quot;</span>, 900));
<a name="l01462"></a>01462         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;auto-save&quot;</span>, <span class="keyword">true</span>) === <span class="keyword">true</span> and $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.autosave&quot;</span>, 6000) &gt; 0){
<a name="l01463"></a>01463             $this-&gt;scheduler-&gt;scheduleDelayedRepeatingTask(<span class="keyword">new</span> CallbackTask(array($this, <span class="stringliteral">&quot;doAutoSave&quot;</span>)), $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.autosave&quot;</span>, 6000), $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.autosave&quot;</span>, 6000));
<a name="l01464"></a>01464         }
<a name="l01465"></a>01465 
<a name="l01466"></a>01466         <span class="keywordflow">if</span>($this-&gt;getProperty(<span class="stringliteral">&quot;chunk-gc.period-in-ticks&quot;</span>, 600) &gt; 0){
<a name="l01467"></a>01467             $this-&gt;scheduler-&gt;scheduleDelayedRepeatingTask(<span class="keyword">new</span> CallbackTask(array($this, <span class="stringliteral">&quot;doLevelGC&quot;</span>)), $this-&gt;getProperty(<span class="stringliteral">&quot;chunk-gc.period-in-ticks&quot;</span>, 600), $this-&gt;getProperty(<span class="stringliteral">&quot;chunk-gc.period-in-ticks&quot;</span>, 600));
<a name="l01468"></a>01468         }
<a name="l01469"></a>01469 
<a name="l01470"></a>01470         $this-&gt;enablePlugins(PluginLoadOrder::POSTWORLD);
<a name="l01471"></a>01471 
<a name="l01472"></a>01472     }
<a name="l01473"></a>01473 
<a name="l01479"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a42a1b94e72b0cb2072709c314ea0e78a">01479</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a42a1b94e72b0cb2072709c314ea0e78a">broadcastMessage</a>($message){
<a name="l01480"></a>01480         <span class="keywordflow">return</span> $this-&gt;broadcast($message, self::BROADCAST_CHANNEL_USERS);
<a name="l01481"></a>01481     }
<a name="l01482"></a>01482 
<a name="l01489"></a>01489     <span class="keyword">public</span> <span class="keyword">function</span> broadcast($message, $permissions){
<a name="l01491"></a>01491         $recipients = [];
<a name="l01492"></a>01492         <span class="keywordflow">foreach</span>(explode(<span class="stringliteral">&quot;;&quot;</span>, $permissions) as $permission){
<a name="l01493"></a>01493             <span class="keywordflow">foreach</span>($this-&gt;pluginManager-&gt;getPermissionSubscriptions($permission) as $permissible){
<a name="l01494"></a>01494                 <span class="keywordflow">if</span>($permissible instanceof CommandSender and $permissible-&gt;hasPermission($permission)){
<a name="l01495"></a>01495                     $recipients[spl_object_hash($permissible)] = $permissible; <span class="comment">// do not send messages directly, or some might be repeated</span>
<a name="l01496"></a>01496                 }
<a name="l01497"></a>01497             }
<a name="l01498"></a>01498         }
<a name="l01499"></a>01499 
<a name="l01500"></a>01500         <span class="keywordflow">foreach</span>($recipients as $recipient){
<a name="l01501"></a>01501             $recipient-&gt;sendMessage($message);
<a name="l01502"></a>01502         }
<a name="l01503"></a>01503         <span class="keywordflow">return</span> count($recipients);
<a name="l01504"></a>01504     }
<a name="l01505"></a>01505 
<a name="l01512"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2713a3d6f609a81b92d53a8a8af68b42">01512</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2713a3d6f609a81b92d53a8a8af68b42">broadcastPacket</a>(array $players, DataPacket $packet){
<a name="l01513"></a>01513         <span class="keywordflow">foreach</span>($players as $player){
<a name="l01514"></a>01514             $player-&gt;dataPacket(clone $packet);
<a name="l01515"></a>01515         }
<a name="l01516"></a>01516     }
<a name="l01517"></a>01517 
<a name="l01518"></a>01518 
<a name="l01522"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a45d2d1a0000140935158e800b8ce8e51">01522</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a45d2d1a0000140935158e800b8ce8e51">enablePlugins</a>($type){
<a name="l01523"></a>01523         <span class="keywordflow">foreach</span>($this-&gt;pluginManager-&gt;getPlugins() as $plugin){
<a name="l01524"></a>01524             <span class="keywordflow">if</span>(!$plugin-&gt;isEnabled() and $plugin-&gt;getDescription()-&gt;getOrder() === $type){
<a name="l01525"></a>01525                 $this-&gt;loadPlugin($plugin);
<a name="l01526"></a>01526             }
<a name="l01527"></a>01527         }
<a name="l01528"></a>01528 
<a name="l01529"></a>01529         <span class="keywordflow">if</span>($type === PluginLoadOrder::POSTWORLD){
<a name="l01530"></a>01530             $this-&gt;commandMap-&gt;registerServerAliases();
<a name="l01531"></a>01531             DefaultPermissions::registerCorePermissions();
<a name="l01532"></a>01532         }
<a name="l01533"></a>01533     }
<a name="l01534"></a>01534 
<a name="l01538"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ae3201921c5012ba0d6849106a0037675">01538</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ae3201921c5012ba0d6849106a0037675">loadPlugin</a>(Plugin $plugin){
<a name="l01539"></a>01539         $this-&gt;pluginManager-&gt;enablePlugin($plugin);
<a name="l01540"></a>01540     }
<a name="l01541"></a>01541 
<a name="l01542"></a>01542     <span class="keyword">public</span> <span class="keyword">function</span> disablePlugins(){
<a name="l01543"></a>01543         $this-&gt;pluginManager-&gt;disablePlugins();
<a name="l01544"></a>01544     }
<a name="l01545"></a>01545 
<a name="l01546"></a>01546     <span class="keyword">public</span> <span class="keyword">function</span> checkConsole(){
<a name="l01547"></a>01547         <span class="keywordflow">if</span>(($line = $this-&gt;console-&gt;getLine()) !== null){
<a name="l01548"></a>01548             $this-&gt;pluginManager-&gt;callEvent($ev = <span class="keyword">new</span> ServerCommandEvent($this-&gt;consoleSender, $line));
<a name="l01549"></a>01549             $this-&gt;dispatchCommand($this-&gt;consoleSender, $ev-&gt;getCommand());
<a name="l01550"></a>01550         }
<a name="l01551"></a>01551     }
<a name="l01552"></a>01552 
<a name="l01561"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5dcbe6191809a32aa98358e68c115197">01561</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5dcbe6191809a32aa98358e68c115197">dispatchCommand</a>(CommandSender $sender, $commandLine){
<a name="l01562"></a>01562         <span class="keywordflow">if</span>($this-&gt;commandMap-&gt;dispatch($sender, $commandLine)){
<a name="l01563"></a>01563             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01564"></a>01564         }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566         <span class="keywordflow">if</span>($sender instanceof <a class="code" href="../../df/d2c/classpocketmine_1_1_player.html">Player</a>){
<a name="l01567"></a>01567             $sender-&gt;sendMessage(<span class="stringliteral">&quot;Unknown command. Type \&quot;/help\&quot; for help.&quot;</span>);
<a name="l01568"></a>01568         }<span class="keywordflow">else</span>{
<a name="l01569"></a>01569             $sender-&gt;sendMessage(<span class="stringliteral">&quot;Unknown command. Type \&quot;help\&quot; for help.&quot;</span>);
<a name="l01570"></a>01570         }
<a name="l01571"></a>01571 
<a name="l01572"></a>01572         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01573"></a>01573     }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575     <span class="keyword">public</span> <span class="keyword">function</span> reload(){
<a name="l01576"></a>01576         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Saving levels...&quot;</span>);
<a name="l01577"></a>01577 
<a name="l01578"></a>01578         <span class="keywordflow">foreach</span>($this-&gt;levels as $level){
<a name="l01579"></a>01579             $level-&gt;save();
<a name="l01580"></a>01580         }
<a name="l01581"></a>01581 
<a name="l01582"></a>01582         $this-&gt;pluginManager-&gt;disablePlugins();
<a name="l01583"></a>01583         $this-&gt;pluginManager-&gt;clearPlugins();
<a name="l01584"></a>01584         $this-&gt;commandMap-&gt;clearCommands();
<a name="l01585"></a>01585 
<a name="l01586"></a>01586         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Reloading properties...&quot;</span>);
<a name="l01587"></a>01587         $this-&gt;properties-&gt;reload();
<a name="l01588"></a>01588         $this-&gt;maxPlayers = $this-&gt;getConfigInt(<span class="stringliteral">&quot;max-players&quot;</span>, 20);
<a name="l01589"></a>01589 
<a name="l01590"></a>01590         <span class="keywordflow">if</span>(($memory = str_replace(<span class="stringliteral">&quot;B&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, strtoupper($this-&gt;getConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>, <span class="stringliteral">&quot;256M&quot;</span>)))) !== <span class="keyword">false</span>){
<a name="l01591"></a>01591             $value = array(<span class="stringliteral">&quot;M&quot;</span> =&gt; 1, <span class="stringliteral">&quot;G&quot;</span> =&gt; 1024);
<a name="l01592"></a>01592             $real = ((int) substr($memory, 0, -1)) * $value[substr($memory, -1)];
<a name="l01593"></a>01593             <span class="keywordflow">if</span>($real &lt; 256){
<a name="l01594"></a>01594                 $this-&gt;logger-&gt;warning(<span class="stringliteral">&quot;PocketMine-MP may not work right with less than 256MB of RAM&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01595"></a>01595             }
<a name="l01596"></a>01596             @ini_set(<span class="stringliteral">&quot;memory_limit&quot;</span>, $memory);
<a name="l01597"></a>01597         }<span class="keywordflow">else</span>{
<a name="l01598"></a>01598             $this-&gt;setConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>, <span class="stringliteral">&quot;128M&quot;</span>);
<a name="l01599"></a>01599         }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;hardcore&quot;</span>, <span class="keyword">false</span>) === <span class="keyword">true</span> and $this-&gt;getDifficulty() &lt; 3){
<a name="l01602"></a>01602             $this-&gt;setConfigInt(<span class="stringliteral">&quot;difficulty&quot;</span>, 3);
<a name="l01603"></a>01603         }
<a name="l01604"></a>01604 
<a name="l01605"></a>01605         $this-&gt;banByIP-&gt;load();
<a name="l01606"></a>01606         $this-&gt;banByName-&gt;load();
<a name="l01607"></a>01607         $this-&gt;reloadWhitelist();
<a name="l01608"></a>01608         $this-&gt;operators-&gt;reload();
<a name="l01609"></a>01609 
<a name="l01610"></a>01610 
<a name="l01611"></a>01611         $this-&gt;pluginManager-&gt;registerInterface(<span class="stringliteral">&quot;pocketmine\\plugin\\PharPluginLoader&quot;</span>);
<a name="l01612"></a>01612         $this-&gt;pluginManager-&gt;loadPlugins($this-&gt;pluginPath);
<a name="l01613"></a>01613         $this-&gt;enablePlugins(PluginLoadOrder::STARTUP);
<a name="l01614"></a>01614         $this-&gt;enablePlugins(PluginLoadOrder::POSTWORLD);
<a name="l01615"></a>01615     }
<a name="l01616"></a>01616 
<a name="l01620"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5ea673149c3d2e0fbc7146d72d128563">01620</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5ea673149c3d2e0fbc7146d72d128563">shutdown</a>(){
<a name="l01621"></a>01621         $this-&gt;isRunning = <span class="keyword">false</span>;
<a name="l01622"></a>01622     }
<a name="l01623"></a>01623 
<a name="l01624"></a>01624     <span class="keyword">public</span> <span class="keyword">function</span> forceShutdown(){
<a name="l01625"></a>01625         $this-&gt;shutdown();
<a name="l01626"></a>01626         <span class="keywordflow">if</span>($this-&gt;rcon instanceof RCON){
<a name="l01627"></a>01627             $this-&gt;rcon-&gt;stop();
<a name="l01628"></a>01628         }
<a name="l01629"></a>01629 
<a name="l01630"></a>01630         <span class="keywordflow">if</span>($this-&gt;getProperty(<span class="stringliteral">&quot;settings.upnp-forwarding&quot;</span>, <span class="keyword">false</span>) === <span class="keyword">true</span>){
<a name="l01631"></a>01631             $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;[UPnP] Removing port forward...&quot;</span>);
<a name="l01632"></a>01632             UPnP::RemovePortForward($this-&gt;getPort());
<a name="l01633"></a>01633         }
<a name="l01634"></a>01634 
<a name="l01635"></a>01635         $this-&gt;pluginManager-&gt;disablePlugins();
<a name="l01636"></a>01636 
<a name="l01637"></a>01637         <span class="keywordflow">foreach</span>($this-&gt;players as $player){
<a name="l01638"></a>01638             $player-&gt;close(TextFormat::YELLOW . $player-&gt;getName() . <span class="stringliteral">&quot; has left the game&quot;</span>, $this-&gt;getProperty(<span class="stringliteral">&quot;settings.shutdown-message&quot;</span>, <span class="stringliteral">&quot;Server closed&quot;</span>));
<a name="l01639"></a>01639         }
<a name="l01640"></a>01640 
<a name="l01641"></a>01641         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l01642"></a>01642             $this-&gt;unloadLevel($level, <span class="keyword">true</span>);
<a name="l01643"></a>01643         }
<a name="l01644"></a>01644         $this-&gt;generationManager-&gt;shutdown();
<a name="l01645"></a>01645 
<a name="l01646"></a>01646         HandlerList::unregisterAll();
<a name="l01647"></a>01647         $this-&gt;scheduler-&gt;cancelAllTasks();
<a name="l01648"></a>01648         $this-&gt;scheduler-&gt;mainThreadHeartbeat(PHP_INT_MAX);
<a name="l01649"></a>01649 
<a name="l01650"></a>01650         $this-&gt;properties-&gt;save();
<a name="l01651"></a>01651 
<a name="l01652"></a>01652         $this-&gt;console-&gt;kill();
<a name="l01653"></a>01653         <span class="keywordflow">foreach</span>($this-&gt;interfaces as $interface){
<a name="l01654"></a>01654             $interface-&gt;shutdown();
<a name="l01655"></a>01655         }
<a name="l01656"></a>01656     }
<a name="l01657"></a>01657 
<a name="l01661"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac6822634150519db3dce79e3b590e79a">01661</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac6822634150519db3dce79e3b590e79a">start</a>(){
<a name="l01662"></a>01662 
<a name="l01663"></a>01663         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;enable-query&quot;</span>, <span class="keyword">true</span>) === <span class="keyword">true</span>){
<a name="l01664"></a>01664             <span class="comment">//$this-&gt;queryHandler = new QueryHandler();</span>
<a name="l01665"></a>01665             <span class="comment">//TODO: query</span>
<a name="l01666"></a>01666         }
<a name="l01667"></a>01667 
<a name="l01668"></a>01668 
<a name="l01669"></a>01669         <span class="keywordflow">if</span>($this-&gt;getProperty(<span class="stringliteral">&quot;settings.send-usage&quot;</span>, <span class="keyword">true</span>) !== <span class="keyword">false</span>){
<a name="l01670"></a>01670             $this-&gt;scheduler-&gt;scheduleDelayedRepeatingTask(<span class="keyword">new</span> CallbackTask(array($this, <span class="stringliteral">&quot;sendUsage&quot;</span>)), 6000, 6000);
<a name="l01671"></a>01671             $this-&gt;sendUsage();
<a name="l01672"></a>01672         }
<a name="l01673"></a>01673 
<a name="l01674"></a>01674 
<a name="l01675"></a>01675         <span class="keywordflow">if</span>($this-&gt;getProperty(<span class="stringliteral">&quot;settings.upnp-forwarding&quot;</span>, <span class="keyword">false</span>) == <span class="keyword">true</span>){
<a name="l01676"></a>01676             $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;[UPnP] Trying to port forward...&quot;</span>);
<a name="l01677"></a>01677             UPnP::PortForward($this-&gt;getPort());
<a name="l01678"></a>01678         }
<a name="l01679"></a>01679 
<a name="l01680"></a>01680         $this-&gt;tickCounter = 0;
<a name="l01681"></a>01681 
<a name="l01682"></a>01682         <span class="comment">//register_shutdown_function(array($this, &quot;dumpError&quot;));</span>
<a name="l01683"></a>01683         register_shutdown_function(array($this, <span class="stringliteral">&quot;forceShutdown&quot;</span>));
<a name="l01684"></a>01684         <span class="keywordflow">if</span>(function_exists(<span class="stringliteral">&quot;pcntl_signal&quot;</span>)){
<a name="l01685"></a>01685             pcntl_signal(SIGTERM, array($this, <span class="stringliteral">&quot;shutdown&quot;</span>));
<a name="l01686"></a>01686             pcntl_signal(SIGINT, array($this, <span class="stringliteral">&quot;shutdown&quot;</span>));
<a name="l01687"></a>01687             pcntl_signal(SIGHUP, array($this, <span class="stringliteral">&quot;shutdown&quot;</span>));
<a name="l01688"></a>01688         }
<a name="l01689"></a>01689 
<a name="l01690"></a>01690         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Default game type: &quot;</span> . self::getGamemodeString($this-&gt;getGamemode())); <span class="comment">//TODO: string name</span>
<a name="l01691"></a>01691 
<a name="l01692"></a>01692         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Done (&quot;</span> . round(microtime(<span class="keyword">true</span>) - \pocketmine\START_TIME, 3) . <span class="stringliteral">&#39;s)! For help, type &quot;help&quot; or &quot;?&quot;&#39;</span>);
<a name="l01693"></a>01693 
<a name="l01694"></a>01694         <span class="keywordflow">if</span>(Utils::getOS() === <span class="stringliteral">&quot;win&quot;</span>){ <span class="comment">//Workaround less usleep() waste</span>
<a name="l01695"></a>01695             $this-&gt;tickProcessorWindows();
<a name="l01696"></a>01696         }<span class="keywordflow">else</span>{
<a name="l01697"></a>01697             $this-&gt;tickProcessor();
<a name="l01698"></a>01698         }
<a name="l01699"></a>01699         $this-&gt;forceShutdown();
<a name="l01700"></a>01700     }
<a name="l01701"></a>01701 
<a name="l01702"></a>01702     <span class="keyword">private</span> <span class="keyword">function</span> tickProcessorWindows(){
<a name="l01703"></a>01703         $lastLoop = 0;
<a name="l01704"></a>01704         <span class="keywordflow">while</span>($this-&gt;isRunning){
<a name="l01705"></a>01705             <span class="keywordflow">foreach</span>($this-&gt;interfaces as $interface){
<a name="l01706"></a>01706                 <span class="keywordflow">if</span>($interface-&gt;process()){
<a name="l01707"></a>01707                     $lastLoop = 0;
<a name="l01708"></a>01708                 }
<a name="l01709"></a>01709             }
<a name="l01710"></a>01710             $this-&gt;generationManager-&gt;handlePackets();
<a name="l01711"></a>01711 
<a name="l01712"></a>01712             <span class="keywordflow">if</span>(($ticks = $this-&gt;tick()) !== <span class="keyword">true</span>){
<a name="l01713"></a>01713                 ++$lastLoop;
<a name="l01714"></a>01714                 <span class="keywordflow">if</span>($lastLoop &gt; 128){
<a name="l01715"></a>01715                     usleep(1000);
<a name="l01716"></a>01716                 }
<a name="l01717"></a>01717             }<span class="keywordflow">else</span>{
<a name="l01718"></a>01718                 $lastLoop = 0;
<a name="l01719"></a>01719             }
<a name="l01720"></a>01720         }
<a name="l01721"></a>01721     }
<a name="l01722"></a>01722 
<a name="l01723"></a>01723     <span class="keyword">public</span> <span class="keyword">function</span> checkTicks(){
<a name="l01724"></a>01724         <span class="keywordflow">if</span>($this-&gt;getTicksPerSecond() &lt; 12){
<a name="l01725"></a>01725             $this-&gt;logger-&gt;warning(<span class="stringliteral">&quot;Can&#39;t keep up! Is the server overloaded?&quot;</span>);
<a name="l01726"></a>01726         }
<a name="l01727"></a>01727     }
<a name="l01728"></a>01728 
<a name="l01729"></a>01729     <span class="keyword">public</span> <span class="keyword">function</span> checkMemory(){
<a name="l01730"></a>01730         <span class="comment">//TODO</span>
<a name="l01731"></a>01731         $info = $this-&gt;debugInfo();
<a name="l01732"></a>01732         $data = $info[<span class="stringliteral">&quot;memory_usage&quot;</span>] . <span class="stringliteral">&quot;,&quot;</span> . $info[<span class="stringliteral">&quot;players&quot;</span>] . <span class="stringliteral">&quot;,&quot;</span> . $info[<span class="stringliteral">&quot;entities&quot;</span>];
<a name="l01733"></a>01733         $i = count($this-&gt;memoryStats) - 1;
<a name="l01734"></a>01734         <span class="keywordflow">if</span>($i &lt; 0 or $this-&gt;memoryStats[$i] !== $data){
<a name="l01735"></a>01735             $this-&gt;memoryStats[] = $data;
<a name="l01736"></a>01736         }
<a name="l01737"></a>01737     }
<a name="l01738"></a>01738 
<a name="l01739"></a>01739     <span class="keyword">public</span> <span class="keyword">function</span> dumpError(){
<a name="l01740"></a>01740         <span class="comment">//TODO</span>
<a name="l01741"></a>01741         <span class="keywordflow">if</span>($this-&gt;stop === <span class="keyword">true</span>){
<a name="l01742"></a>01742             <span class="keywordflow">return</span>;
<a name="l01743"></a>01743         }
<a name="l01744"></a>01744         ini_set(<span class="stringliteral">&quot;memory_limit&quot;</span>, <span class="stringliteral">&quot;-1&quot;</span>); <span class="comment">//Fix error dump not dumped on memory problems</span>
<a name="l01745"></a>01745         $this-&gt;logger-&gt;emergency(<span class="stringliteral">&quot;An unrecoverable has occurred and the server has crashed. Creating an error dump&quot;</span>);
<a name="l01746"></a>01746         $dump = <span class="stringliteral">&quot;```\r\n# PocketMine-MP Error Dump &quot;</span> . date(<span class="stringliteral">&quot;D M j H:i:s T Y&quot;</span>) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01747"></a>01747         $er = error_get_last();
<a name="l01748"></a>01748         $errorConversion = array(
<a name="l01749"></a>01749             E_ERROR =&gt; <span class="stringliteral">&quot;E_ERROR&quot;</span>,
<a name="l01750"></a>01750             E_WARNING =&gt; <span class="stringliteral">&quot;E_WARNING&quot;</span>,
<a name="l01751"></a>01751             E_PARSE =&gt; <span class="stringliteral">&quot;E_PARSE&quot;</span>,
<a name="l01752"></a>01752             E_NOTICE =&gt; <span class="stringliteral">&quot;E_NOTICE&quot;</span>,
<a name="l01753"></a>01753             E_CORE_ERROR =&gt; <span class="stringliteral">&quot;E_CORE_ERROR&quot;</span>,
<a name="l01754"></a>01754             E_CORE_WARNING =&gt; <span class="stringliteral">&quot;E_CORE_WARNING&quot;</span>,
<a name="l01755"></a>01755             E_COMPILE_ERROR =&gt; <span class="stringliteral">&quot;E_COMPILE_ERROR&quot;</span>,
<a name="l01756"></a>01756             E_COMPILE_WARNING =&gt; <span class="stringliteral">&quot;E_COMPILE_WARNING&quot;</span>,
<a name="l01757"></a>01757             E_USER_ERROR =&gt; <span class="stringliteral">&quot;E_USER_ERROR&quot;</span>,
<a name="l01758"></a>01758             E_USER_WARNING =&gt; <span class="stringliteral">&quot;E_USER_WARNING&quot;</span>,
<a name="l01759"></a>01759             E_USER_NOTICE =&gt; <span class="stringliteral">&quot;E_USER_NOTICE&quot;</span>,
<a name="l01760"></a>01760             E_STRICT =&gt; <span class="stringliteral">&quot;E_STRICT&quot;</span>,
<a name="l01761"></a>01761             E_RECOVERABLE_ERROR =&gt; <span class="stringliteral">&quot;E_RECOVERABLE_ERROR&quot;</span>,
<a name="l01762"></a>01762             E_DEPRECATED =&gt; <span class="stringliteral">&quot;E_DEPRECATED&quot;</span>,
<a name="l01763"></a>01763             E_USER_DEPRECATED =&gt; <span class="stringliteral">&quot;E_USER_DEPRECATED&quot;</span>,
<a name="l01764"></a>01764         );
<a name="l01765"></a>01765         $er[<span class="stringliteral">&quot;type&quot;</span>] = isset($errorConversion[$er[<span class="stringliteral">&quot;type&quot;</span>]]) ? $errorConversion[$er[<span class="stringliteral">&quot;type&quot;</span>]] : $er[<span class="stringliteral">&quot;type&quot;</span>];
<a name="l01766"></a>01766         $dump .= <span class="stringliteral">&quot;Error: &quot;</span> . var_export($er, <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n\r\n&quot;</span>;
<a name="l01767"></a>01767         <span class="keywordflow">if</span>(stripos($er[<span class="stringliteral">&quot;file&quot;</span>], <span class="stringliteral">&quot;plugin&quot;</span>) !== <span class="keyword">false</span>){
<a name="l01768"></a>01768             $dump .= <span class="stringliteral">&quot;THIS ERROR WAS CAUSED BY A PLUGIN. REPORT IT TO THE PLUGIN DEVELOPER.\r\n&quot;</span>;
<a name="l01769"></a>01769         }
<a name="l01770"></a>01770 
<a name="l01771"></a>01771         $dump .= <span class="stringliteral">&quot;Code: \r\n&quot;</span>;
<a name="l01772"></a>01772         $file = @file($er[<span class="stringliteral">&quot;file&quot;</span>], FILE_IGNORE_NEW_LINES);
<a name="l01773"></a>01773         <span class="keywordflow">for</span>($l = max(0, $er[<span class="stringliteral">&quot;line&quot;</span>] - 10); $l &lt; $er[<span class="stringliteral">&quot;line&quot;</span>] + 10; ++$l){
<a name="l01774"></a>01774             $dump .= <span class="stringliteral">&quot;[&quot;</span> . ($l + 1) . <span class="stringliteral">&quot;] &quot;</span> . @$file[$l] . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01775"></a>01775         }
<a name="l01776"></a>01776         $dump .= <span class="stringliteral">&quot;\r\n\r\n&quot;</span>;
<a name="l01777"></a>01777         $dump .= <span class="stringliteral">&quot;Backtrace: \r\n&quot;</span>;
<a name="l01778"></a>01778         <span class="keywordflow">foreach</span>(getTrace() as $line){
<a name="l01779"></a>01779             $dump .= <span class="stringliteral">&quot;$line\r\n&quot;</span>;
<a name="l01780"></a>01780         }
<a name="l01781"></a>01781         $dump .= <span class="stringliteral">&quot;\r\n\r\n&quot;</span>;
<a name="l01782"></a>01782         $version = <span class="keyword">new</span> VersionString();
<a name="l01783"></a>01783         $dump .= <span class="stringliteral">&quot;PocketMine-MP version: &quot;</span> . $version-&gt;get(<span class="keyword">false</span>). <span class="stringliteral">&quot; #&quot;</span> . $version-&gt;getNumber() . <span class="stringliteral">&quot; [Protocol &quot;</span> . Info::CURRENT_PROTOCOL . <span class="stringliteral">&quot;; API &quot;</span> . API_VERSION . <span class="stringliteral">&quot;]\r\n&quot;</span>;
<a name="l01784"></a>01784         $dump .= <span class="stringliteral">&quot;Git commit: &quot;</span> . GIT_COMMIT . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01785"></a>01785         $dump .= <span class="stringliteral">&quot;uname -a: &quot;</span> . php_uname(<span class="stringliteral">&quot;a&quot;</span>) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01786"></a>01786         $dump .= <span class="stringliteral">&quot;PHP Version: &quot;</span> . phpversion() . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01787"></a>01787         $dump .= <span class="stringliteral">&quot;Zend version: &quot;</span> . zend_version() . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01788"></a>01788         $dump .= <span class="stringliteral">&quot;OS : &quot;</span> . PHP_OS . <span class="stringliteral">&quot;, &quot;</span> . Utils::getOS() . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01789"></a>01789         $dump .= <span class="stringliteral">&quot;Debug Info: &quot;</span> . var_export($this-&gt;debugInfo(<span class="keyword">false</span>), <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n\r\n\r\n&quot;</span>;
<a name="l01790"></a>01790         global $arguments;
<a name="l01791"></a>01791         $dump .= <span class="stringliteral">&quot;Parameters: &quot;</span> . var_export($arguments, <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n\r\n\r\n&quot;</span>;
<a name="l01792"></a>01792         $p = $this-&gt;api-&gt;getProperties();
<a name="l01793"></a>01793         <span class="keywordflow">if</span>($p[<span class="stringliteral">&quot;rcon.password&quot;</span>] != <span class="stringliteral">&quot;&quot;</span>){
<a name="l01794"></a>01794             $p[<span class="stringliteral">&quot;rcon.password&quot;</span>] = <span class="stringliteral">&quot;******&quot;</span>;
<a name="l01795"></a>01795         }
<a name="l01796"></a>01796         $dump .= <span class="stringliteral">&quot;server.properties: &quot;</span> . var_export($p, <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n\r\n\r\n&quot;</span>;
<a name="l01797"></a>01797         <span class="keywordflow">if</span>(class_exists(<span class="stringliteral">&quot;pocketmine\\plugin\\PluginManager&quot;</span>, <span class="keyword">false</span>)){
<a name="l01798"></a>01798             $dump .= <span class="stringliteral">&quot;Loaded plugins:\r\n&quot;</span>;
<a name="l01799"></a>01799             <span class="keywordflow">foreach</span>($this-&gt;getPluginManager()-&gt;getPlugins() as $p){
<a name="l01800"></a>01800                 $d = $p-&gt;getDescription();
<a name="l01801"></a>01801                 $dump .= $d-&gt;getName() . <span class="stringliteral">&quot; &quot;</span> . $d-&gt;getVersion() . <span class="stringliteral">&quot; by &quot;</span> . implode(<span class="stringliteral">&quot;, &quot;</span>, $d-&gt;getAuthors()) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01802"></a>01802             }
<a name="l01803"></a>01803             $dump .= <span class="stringliteral">&quot;\r\n\r\n&quot;</span>;
<a name="l01804"></a>01804         }
<a name="l01805"></a>01805 
<a name="l01806"></a>01806         $extensions = [];
<a name="l01807"></a>01807         <span class="keywordflow">foreach</span>(get_loaded_extensions() as $ext){
<a name="l01808"></a>01808             $extensions[$ext] = phpversion($ext);
<a name="l01809"></a>01809         }
<a name="l01810"></a>01810 
<a name="l01811"></a>01811         $dump .= <span class="stringliteral">&quot;Loaded Modules: &quot;</span> . var_export($extensions, <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01812"></a>01812         $this-&gt;checkMemory();
<a name="l01813"></a>01813         $dump .= <span class="stringliteral">&quot;Memory Usage Tracking: \r\n&quot;</span> . chunk_split(base64_encode(gzdeflate(implode(<span class="stringliteral">&quot;;&quot;</span>, $this-&gt;memoryStats), 9))) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01814"></a>01814         ob_start();
<a name="l01815"></a>01815         phpinfo();
<a name="l01816"></a>01816         $dump .= <span class="stringliteral">&quot;\r\nphpinfo(): \r\n&quot;</span> . chunk_split(base64_encode(gzdeflate(ob_get_contents(), 9))) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01817"></a>01817         ob_end_clean();
<a name="l01818"></a>01818         $dump .= <span class="stringliteral">&quot;\r\n```&quot;</span>;
<a name="l01819"></a>01819         $name = <span class="stringliteral">&quot;Error_Dump_&quot;</span> . date(<span class="stringliteral">&quot;D_M_j-H.i.s-T_Y&quot;</span>);
<a name="l01820"></a>01820         <span class="comment">//log($dump, $name, true, 0, true);</span>
<a name="l01821"></a>01821         $this-&gt;logger-&gt;emergency(<span class="stringliteral">&quot;Please submit the \&quot;{$name}.log\&quot; file to the Bug Reporting page. Give as much info as you can.&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01822"></a>01822     }
<a name="l01823"></a>01823 
<a name="l01824"></a>01824     <span class="keyword">private</span> <span class="keyword">function</span> tickProcessor(){
<a name="l01825"></a>01825         $lastLoop = 0;
<a name="l01826"></a>01826         <span class="keywordflow">while</span>($this-&gt;isRunning){
<a name="l01827"></a>01827 
<a name="l01828"></a>01828             <span class="keywordflow">foreach</span>($this-&gt;interfaces as $interface){
<a name="l01829"></a>01829                 <span class="keywordflow">if</span>($interface-&gt;process()){
<a name="l01830"></a>01830                     $lastLoop = 0;
<a name="l01831"></a>01831                 }
<a name="l01832"></a>01832             }
<a name="l01833"></a>01833             $this-&gt;generationManager-&gt;handlePackets();
<a name="l01834"></a>01834 
<a name="l01835"></a>01835             <span class="keywordflow">if</span>(($ticks = $this-&gt;tick()) !== <span class="keyword">true</span>){
<a name="l01836"></a>01836                 ++$lastLoop;
<a name="l01837"></a>01837                 <span class="keywordflow">if</span>($lastLoop &gt; 16 and $lastLoop &lt; 128){
<a name="l01838"></a>01838                     usleep(200);
<a name="l01839"></a>01839                 }elseif($lastLoop &lt; 512){
<a name="l01840"></a>01840                     usleep(400);
<a name="l01841"></a>01841                 }<span class="keywordflow">else</span>{
<a name="l01842"></a>01842                     usleep(1000);
<a name="l01843"></a>01843                 }
<a name="l01844"></a>01844             }<span class="keywordflow">else</span>{
<a name="l01845"></a>01845                 $lastLoop = 0;
<a name="l01846"></a>01846             }
<a name="l01847"></a>01847         }
<a name="l01848"></a>01848     }
<a name="l01849"></a>01849 
<a name="l01850"></a>01850     <span class="keyword">public</span> <span class="keyword">function</span> addPlayer($identifier, Player $player){
<a name="l01851"></a>01851         $this-&gt;players[$identifier] = $player;
<a name="l01852"></a>01852     }
<a name="l01853"></a>01853 
<a name="l01854"></a>01854     <span class="keyword">private</span> <span class="keyword">function</span> checkTickUpdates($currentTick){
<a name="l01855"></a>01855         <span class="comment">//Update entities that need update</span>
<a name="l01856"></a>01856         <span class="keywordflow">if</span>(count(Entity::$needUpdate) &gt; 0){
<a name="l01857"></a>01857             <span class="keywordflow">foreach</span>(Entity::$needUpdate as $id =&gt; $entity){
<a name="l01858"></a>01858                 <span class="keywordflow">if</span>($entity-&gt;onUpdate() === <span class="keyword">false</span>){
<a name="l01859"></a>01859                     unset(Entity::$needUpdate[$id]);
<a name="l01860"></a>01860                 }
<a name="l01861"></a>01861             }
<a name="l01862"></a>01862         }
<a name="l01863"></a>01863 
<a name="l01864"></a>01864         <span class="comment">//Update tiles that need update</span>
<a name="l01865"></a>01865         <span class="keywordflow">if</span>(count(Tile::$needUpdate) &gt; 0){
<a name="l01866"></a>01866             <span class="keywordflow">foreach</span>(Tile::$needUpdate as $id =&gt; $tile){
<a name="l01867"></a>01867                 <span class="keywordflow">if</span>($tile-&gt;onUpdate() === <span class="keyword">false</span>){
<a name="l01868"></a>01868                     unset(Tile::$needUpdate[$id]);
<a name="l01869"></a>01869                 }
<a name="l01870"></a>01870             }
<a name="l01871"></a>01871         }
<a name="l01872"></a>01872 
<a name="l01873"></a>01873         <span class="comment">//TODO: Add level blocks</span>
<a name="l01874"></a>01874 
<a name="l01875"></a>01875         <span class="comment">//Do level ticks</span>
<a name="l01876"></a>01876         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l01877"></a>01877             $level-&gt;doTick($currentTick);
<a name="l01878"></a>01878         }
<a name="l01879"></a>01879     }
<a name="l01880"></a>01880 
<a name="l01881"></a>01881     <span class="keyword">public</span> <span class="keyword">function</span> doAutoSave(){
<a name="l01882"></a>01882 
<a name="l01883"></a>01883         <span class="comment">/*foreach($this-&gt;getOnlinePlayers() as $player){</span>
<a name="l01884"></a>01884 <span class="comment">            $player-&gt;save();</span>
<a name="l01885"></a>01885 <span class="comment">        }*/</span>
<a name="l01886"></a>01886 
<a name="l01887"></a>01887         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l01888"></a>01888             $level-&gt;save();
<a name="l01889"></a>01889         }
<a name="l01890"></a>01890     }
<a name="l01891"></a>01891 
<a name="l01892"></a>01892     <span class="keyword">public</span> <span class="keyword">function</span> doLevelGC(){
<a name="l01893"></a>01893         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l01894"></a>01894             $level-&gt;doChunkGarbageCollection();
<a name="l01895"></a>01895         }
<a name="l01896"></a>01896     }
<a name="l01897"></a>01897 
<a name="l01898"></a>01898     <span class="keyword">public</span> <span class="keyword">function</span> sendUsage(){
<a name="l01899"></a>01899         <span class="keywordflow">if</span>($this-&gt;lastSendUsage instanceof SendUsageTask){
<a name="l01900"></a>01900             <span class="keywordflow">if</span>(!$this-&gt;lastSendUsage-&gt;isFinished()){ <span class="comment">//do not call multiple times</span>
<a name="l01901"></a>01901                 <span class="keywordflow">return</span>;
<a name="l01902"></a>01902             }
<a name="l01903"></a>01903         }
<a name="l01904"></a>01904         $plist = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01905"></a>01905         <span class="keywordflow">foreach</span>($this-&gt;getPluginManager()-&gt;getPlugins() as $p){
<a name="l01906"></a>01906             $d = $p-&gt;getDescription();
<a name="l01907"></a>01907             $plist .= str_replace(array(<span class="stringliteral">&quot;;&quot;</span>, <span class="stringliteral">&quot;:&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, $d-&gt;getName()) . <span class="stringliteral">&quot;:&quot;</span> . str_replace(array(<span class="stringliteral">&quot;;&quot;</span>, <span class="stringliteral">&quot;:&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, $d-&gt;getVersion()) . <span class="stringliteral">&quot;;&quot;</span>;
<a name="l01908"></a>01908         }
<a name="l01909"></a>01909 
<a name="l01910"></a>01910         $version = <span class="keyword">new</span> VersionString();
<a name="l01911"></a>01911         $this-&gt;lastSendUsage = <span class="keyword">new</span> SendUsageTask(<span class="stringliteral">&quot;http://stats.pocketmine.net/usage.php&quot;</span>, array(
<a name="l01912"></a>01912             <span class="stringliteral">&quot;serverid&quot;</span> =&gt; Binary::readLong(substr(Utils::getUniqueID(<span class="keyword">true</span>, $this-&gt;getIp() . <span class="stringliteral">&quot;:&quot;</span> . $this-&gt;getPort()), 0, 8)),
<a name="l01913"></a>01913             <span class="stringliteral">&quot;port&quot;</span> =&gt; $this-&gt;getPort(),
<a name="l01914"></a>01914             <span class="stringliteral">&quot;os&quot;</span> =&gt; Utils::getOS(),
<a name="l01915"></a>01915             <span class="stringliteral">&quot;memory_total&quot;</span> =&gt; $this-&gt;getConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>),
<a name="l01916"></a>01916             <span class="stringliteral">&quot;memory_usage&quot;</span> =&gt; memory_get_usage(),
<a name="l01917"></a>01917             <span class="stringliteral">&quot;php_version&quot;</span> =&gt; \pocketmine\PHP_VERSION,
<a name="l01918"></a>01918             <span class="stringliteral">&quot;version&quot;</span> =&gt; $version-&gt;get(<span class="keyword">false</span>),
<a name="l01919"></a>01919             <span class="stringliteral">&quot;build&quot;</span> =&gt; $version-&gt;getBuild(),
<a name="l01920"></a>01920             <span class="stringliteral">&quot;mc_version&quot;</span> =&gt; \pocketmine\MINECRAFT_VERSION,
<a name="l01921"></a>01921             <span class="stringliteral">&quot;protocol&quot;</span> =&gt; network\protocol\Info::CURRENT_PROTOCOL,
<a name="l01922"></a>01922             <span class="stringliteral">&quot;online&quot;</span> =&gt; count($this-&gt;players),
<a name="l01923"></a>01923             <span class="stringliteral">&quot;max&quot;</span> =&gt; $this-&gt;getMaxPlayers(),
<a name="l01924"></a>01924             <span class="stringliteral">&quot;plugins&quot;</span> =&gt; $plist,
<a name="l01925"></a>01925         ));
<a name="l01926"></a>01926 
<a name="l01927"></a>01927         $this-&gt;scheduler-&gt;scheduleAsyncTask($this-&gt;lastSendUsage);
<a name="l01928"></a>01928     }
<a name="l01929"></a>01929 
<a name="l01930"></a>01930     <span class="keyword">public</span> <span class="keyword">function</span> titleTick(){
<a name="l01931"></a>01931         <span class="keywordflow">if</span>(defined(<span class="stringliteral">&quot;pocketmine\\DEBUG&quot;</span>) and \pocketmine\DEBUG &gt;= 0 and \pocketmine\ANSI === <span class="keyword">true</span>){
<a name="l01932"></a>01932             echo <span class="stringliteral">&quot;\x1b]0;PocketMine-MP &quot;</span> . $this-&gt;getPocketMineVersion() . <span class="stringliteral">&quot; | Online &quot;</span> . count($this-&gt;players) . <span class="stringliteral">&quot;/&quot;</span> . $this-&gt;getMaxPlayers() . <span class="stringliteral">&quot; | RAM &quot;</span> . round((memory_get_usage() / 1024) / 1024, 2) . <span class="stringliteral">&quot;/&quot;</span> . round((memory_get_usage(<span class="keyword">true</span>) / 1024) / 1024, 2) . <span class="stringliteral">&quot; MB | U -1 D -1 kB/s | TPS &quot;</span> . $this-&gt;getTicksPerSecond() . <span class="stringliteral">&quot;\x07&quot;</span>;
<a name="l01933"></a>01933         }
<a name="l01934"></a>01934     }
<a name="l01935"></a>01935 
<a name="l01936"></a>01936 
<a name="l01940"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a89769729bbcf4c255d97771318436e07">01940</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a89769729bbcf4c255d97771318436e07">tick</a>(){
<a name="l01941"></a>01941         <span class="keywordflow">if</span>($this-&gt;inTick === <span class="keyword">false</span>){
<a name="l01942"></a>01942             $tickTime = microtime(<span class="keyword">true</span>);
<a name="l01943"></a>01943             <span class="keywordflow">if</span>($tickTime &lt; $this-&gt;nextTick){
<a name="l01944"></a>01944                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01945"></a>01945             }
<a name="l01946"></a>01946 
<a name="l01947"></a>01947             $this-&gt;inTick = <span class="keyword">true</span>; <span class="comment">//Fix race conditions</span>
<a name="l01948"></a>01948             ++$this-&gt;tickCounter;
<a name="l01949"></a>01949 
<a name="l01950"></a>01950             $this-&gt;checkConsole();
<a name="l01951"></a>01951             $this-&gt;scheduler-&gt;mainThreadHeartbeat($this-&gt;tickCounter);
<a name="l01952"></a>01952             $this-&gt;checkTickUpdates($this-&gt;tickCounter);
<a name="l01953"></a>01953 
<a name="l01954"></a>01954             <span class="keywordflow">if</span>(($this-&gt;tickCounter &amp; 0b1111) === 0){
<a name="l01955"></a>01955                 $this-&gt;titleTick();
<a name="l01956"></a>01956                 <span class="keywordflow">if</span>(isset($this-&gt;queryHandler) and ($this-&gt;tickCounter &amp; 0b111111111) === 0){
<a name="l01957"></a>01957                     $this-&gt;queryHandler-&gt;regenerateInfo();
<a name="l01958"></a>01958                 }
<a name="l01959"></a>01959             }
<a name="l01960"></a>01960 
<a name="l01961"></a>01961             $this-&gt;tickMeasure = (($time = microtime(<span class="keyword">true</span>)) - $this-&gt;tickTime);
<a name="l01962"></a>01962             $this-&gt;tickTime = $time;
<a name="l01963"></a>01963             $this-&gt;nextTick = 0.05 * (0.05 / max(0.05, $this-&gt;tickMeasure)) + $time;
<a name="l01964"></a>01964             $this-&gt;inTick = <span class="keyword">false</span>;
<a name="l01965"></a>01965 
<a name="l01966"></a>01966             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01967"></a>01967         }
<a name="l01968"></a>01968 
<a name="l01969"></a>01969         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01970"></a>01970     }
<a name="l01971"></a>01971 
<a name="l01972"></a>01972 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>Server.php</b>      </li>

    <li class="footer">Generated on Thu Jul 3 2014 11:38:33 for PocketMine-MP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
