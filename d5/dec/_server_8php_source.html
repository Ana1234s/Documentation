<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>PocketMine-MP: Server.php Source File</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="../../PocketMine-h-64.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">PocketMine-MP
   &#160;<span id="projectnumber">Alpha_1.4dev - API 1.0.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Packages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d5/dec/_server_8php.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Server.php</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  ____            _        _   __  __ _                  __  __ ____</span>
<a name="l00006"></a>00006 <span class="comment"> * |  _ \ ___   ___| | _____| |_|  \/  (_)_ __   ___      |  \/  |  _ \</span>
<a name="l00007"></a>00007 <span class="comment"> * | |_) / _ \ / __| |/ / _ \ __| |\/| | | &#39;_ \ / _ \_____| |\/| | |_) |</span>
<a name="l00008"></a>00008 <span class="comment"> * |  __/ (_) | (__|   &lt;  __/ |_| |  | | | | | |  __/_____| |  | |  __/</span>
<a name="l00009"></a>00009 <span class="comment"> * |_|   \___/ \___|_|\_\___|\__|_|  |_|_|_| |_|\___|     |_|  |_|_|</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * This program is free software: you can redistribute it and/or modify</span>
<a name="l00012"></a>00012 <span class="comment"> * it under the terms of the GNU Lesser General Public License as published by</span>
<a name="l00013"></a>00013 <span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00014"></a>00014 <span class="comment"> * (at your option) any later version.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * @author PocketMine Team</span>
<a name="l00017"></a>00017 <span class="comment"> * @link http://www.pocketmine.net/</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment">*/</span>
<a name="l00021"></a>00021 
<a name="l00026"></a>00026 <span class="keyword">namespace </span>pocketmine;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 use pocketmine\block\Block;
<a name="l00029"></a>00029 use pocketmine\command\CommandReader;
<a name="l00030"></a>00030 use pocketmine\command\CommandSender;
<a name="l00031"></a>00031 use pocketmine\command\ConsoleCommandSender;
<a name="l00032"></a>00032 use pocketmine\command\PluginIdentifiableCommand;
<a name="l00033"></a>00033 use pocketmine\command\SimpleCommandMap;
<a name="l00034"></a>00034 use pocketmine\entity\Entity;
<a name="l00035"></a>00035 use pocketmine\event\HandlerList;
<a name="l00036"></a>00036 use pocketmine\event\level\LevelInitEvent;
<a name="l00037"></a>00037 use pocketmine\event\level\LevelLoadEvent;
<a name="l00038"></a>00038 use pocketmine\event\server\ServerCommandEvent;
<a name="l00039"></a>00039 use pocketmine\inventory\CraftingManager;
<a name="l00040"></a>00040 use pocketmine\inventory\InventoryType;
<a name="l00041"></a>00041 use pocketmine\inventory\Recipe;
<a name="l00042"></a>00042 use pocketmine\item\Item;
<a name="l00043"></a>00043 use pocketmine\level\format\LevelProviderManager;
<a name="l00044"></a>00044 use pocketmine\level\generator\GenerationRequestManager;
<a name="l00045"></a>00045 use pocketmine\level\generator\Generator;
<a name="l00046"></a>00046 use pocketmine\level\Level;
<a name="l00047"></a>00047 use pocketmine\metadata\EntityMetadataStore;
<a name="l00048"></a>00048 use pocketmine\metadata\LevelMetadataStore;
<a name="l00049"></a>00049 use pocketmine\metadata\PlayerMetadataStore;
<a name="l00050"></a>00050 use pocketmine\nbt\NBT;
<a name="l00051"></a>00051 use pocketmine\nbt\tag\Byte;
<a name="l00052"></a>00052 use pocketmine\nbt\tag\Compound;
<a name="l00053"></a>00053 use pocketmine\nbt\tag\Double;
<a name="l00054"></a>00054 use pocketmine\nbt\tag\Enum;
<a name="l00055"></a>00055 use pocketmine\nbt\tag\Float;
<a name="l00056"></a>00056 use pocketmine\nbt\tag\Int;
<a name="l00057"></a>00057 use pocketmine\nbt\tag\Long;
<a name="l00058"></a>00058 use pocketmine\nbt\tag\Short;
<a name="l00059"></a>00059 use pocketmine\nbt\tag\String;
<a name="l00060"></a>00060 use pocketmine\network\protocol\DataPacket;
<a name="l00061"></a>00061 use pocketmine\network\protocol\Info;
<a name="l00062"></a>00062 use pocketmine\network\query\QueryHandler;
<a name="l00063"></a>00063 use pocketmine\network\query\QueryPacket;
<a name="l00064"></a>00064 use pocketmine\network\RakLibInterface;
<a name="l00065"></a>00065 use pocketmine\network\rcon\RCON;
<a name="l00066"></a>00066 use pocketmine\network\SourceInterface;
<a name="l00067"></a>00067 use pocketmine\network\upnp\UPnP;
<a name="l00068"></a>00068 use pocketmine\permission\BanList;
<a name="l00069"></a>00069 use pocketmine\permission\DefaultPermissions;
<a name="l00070"></a>00070 use pocketmine\plugin\Plugin;
<a name="l00071"></a>00071 use pocketmine\plugin\PluginLoadOrder;
<a name="l00072"></a>00072 use pocketmine\plugin\PluginManager;
<a name="l00073"></a>00073 use pocketmine\scheduler\CallbackTask;
<a name="l00074"></a>00074 use pocketmine\scheduler\SendUsageTask;
<a name="l00075"></a>00075 use pocketmine\scheduler\ServerScheduler;
<a name="l00076"></a>00076 use pocketmine\tile\Tile;
<a name="l00077"></a>00077 use pocketmine\updater\AutoUpdater;
<a name="l00078"></a>00078 use pocketmine\utils\Binary;
<a name="l00079"></a>00079 use pocketmine\utils\Config;
<a name="l00080"></a>00080 use pocketmine\utils\MainLogger;
<a name="l00081"></a>00081 use pocketmine\utils\TextFormat;
<a name="l00082"></a>00082 use pocketmine\utils\Utils;
<a name="l00083"></a>00083 use pocketmine\utils\VersionString;
<a name="l00084"></a>00084 
<a name="l00088"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html">00088</a> <span class="keyword">class </span><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html">Server</a>{
<a name="l00089"></a>00089     <span class="keyword">const</span> BROADCAST_CHANNEL_ADMINISTRATIVE = <span class="stringliteral">&quot;pocketmine.broadcast.admin&quot;</span>;
<a name="l00090"></a>00090     <span class="keyword">const</span> BROADCAST_CHANNEL_USERS = <span class="stringliteral">&quot;pocketmine.broadcast.user&quot;</span>;
<a name="l00091"></a>00091 
<a name="l00093"></a>00093     <span class="keyword">private</span> <span class="keyword">static</span> $instance = null;
<a name="l00094"></a>00094 
<a name="l00096"></a>00096     <span class="keyword">private</span> $banByName = null;
<a name="l00097"></a>00097 
<a name="l00099"></a>00099     <span class="keyword">private</span> $banByIP = null;
<a name="l00100"></a>00100 
<a name="l00102"></a>00102     <span class="keyword">private</span> $operators = null;
<a name="l00103"></a>00103 
<a name="l00105"></a>00105     <span class="keyword">private</span> $whitelist = null;
<a name="l00106"></a>00106 
<a name="l00108"></a>00108     <span class="keyword">private</span> $isRunning = <span class="keyword">true</span>;
<a name="l00109"></a>00109 
<a name="l00111"></a>00111     <span class="keyword">private</span> $pluginManager = null;
<a name="l00112"></a>00112 
<a name="l00114"></a>00114     <span class="keyword">private</span> $updater = null;
<a name="l00115"></a>00115 
<a name="l00117"></a>00117     <span class="keyword">private</span> $scheduler = null;
<a name="l00118"></a>00118 
<a name="l00120"></a>00120     <span class="keyword">private</span> $generationManager = null;
<a name="l00121"></a>00121 
<a name="l00127"></a>00127     <span class="keyword">private</span> $tickCounter;
<a name="l00128"></a>00128     <span class="keyword">private</span> $nextTick = 0;
<a name="l00129"></a>00129     <span class="keyword">private</span> $tickMeasure = 20;
<a name="l00130"></a>00130     <span class="keyword">private</span> $tickTime = 0;
<a name="l00131"></a>00131     <span class="keyword">private</span> $inTick = <span class="keyword">false</span>;
<a name="l00132"></a>00132 
<a name="l00134"></a>00134     <span class="keyword">private</span> $logger;
<a name="l00135"></a>00135 
<a name="l00137"></a>00137     <span class="keyword">private</span> $console = null;
<a name="l00138"></a>00138 
<a name="l00140"></a>00140     <span class="keyword">private</span> $commandMap = null;
<a name="l00141"></a>00141 
<a name="l00143"></a>00143     <span class="keyword">private</span> $craftingManager;
<a name="l00144"></a>00144 
<a name="l00146"></a>00146     <span class="keyword">private</span> $consoleSender;
<a name="l00147"></a>00147 
<a name="l00149"></a>00149     <span class="keyword">private</span> $maxPlayers;
<a name="l00150"></a>00150 
<a name="l00152"></a>00152     <span class="keyword">private</span> $rcon;
<a name="l00153"></a>00153 
<a name="l00155"></a>00155     <span class="keyword">private</span> $entityMetadata;
<a name="l00156"></a>00156 
<a name="l00158"></a>00158     <span class="keyword">private</span> $playerMetadata;
<a name="l00159"></a>00159 
<a name="l00161"></a>00161     <span class="keyword">private</span> $levelMetadata;
<a name="l00162"></a>00162 
<a name="l00164"></a>00164     <span class="keyword">private</span> $interfaces = [];
<a name="l00166"></a>00166     <span class="keyword">private</span> $mainInterface;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <span class="keyword">private</span> $serverID;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keyword">private</span> $autoloader;
<a name="l00171"></a>00171     <span class="keyword">private</span> $filePath;
<a name="l00172"></a>00172     <span class="keyword">private</span> $dataPath;
<a name="l00173"></a>00173     <span class="keyword">private</span> $pluginPath;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="keyword">private</span> $lastSendUsage = null;
<a name="l00176"></a>00176 
<a name="l00178"></a>00178     <span class="keyword">private</span> $queryHandler;
<a name="l00179"></a>00179 
<a name="l00181"></a>00181     <span class="keyword">private</span> $properties;
<a name="l00182"></a>00182 
<a name="l00184"></a>00184     <span class="keyword">private</span> $config;
<a name="l00185"></a>00185 
<a name="l00187"></a>00187     <span class="keyword">private</span> $players = [];
<a name="l00188"></a>00188 
<a name="l00190"></a>00190     <span class="keyword">private</span> $levels = [];
<a name="l00191"></a>00191 
<a name="l00193"></a>00193     <span class="keyword">private</span> $levelDefault = null;
<a name="l00194"></a>00194 
<a name="l00198"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ace3e6dc06f0fb014b041c6e69a460edb">00198</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ace3e6dc06f0fb014b041c6e69a460edb">getName</a>(){
<a name="l00199"></a>00199         <span class="keywordflow">return</span> <span class="stringliteral">&quot;PocketMine-MP&quot;</span>;
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 
<a name="l00205"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8b8f89c289651349591981da5938e2c2">00205</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8b8f89c289651349591981da5938e2c2">isRunning</a>(){
<a name="l00206"></a>00206         <span class="keywordflow">return</span> $this-&gt;isRunning === <span class="keyword">true</span>;
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208 
<a name="l00212"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af9924a23f41a59324dca1ce385732af9">00212</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af9924a23f41a59324dca1ce385732af9">getPocketMineVersion</a>(){
<a name="l00213"></a>00213         return \pocketmine\VERSION;
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215 
<a name="l00219"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a76bb64798b2e5858dabf534de3379020">00219</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a76bb64798b2e5858dabf534de3379020">getCodename</a>(){
<a name="l00220"></a>00220         return \pocketmine\CODENAME;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00226"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8b29f0a0f19898129c6075be08a9a91a">00226</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8b29f0a0f19898129c6075be08a9a91a">getVersion</a>(){
<a name="l00227"></a>00227         return \pocketmine\MINECRAFT_VERSION;
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229 
<a name="l00233"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ae0f9ce5a194df30a970535b18c55c095">00233</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ae0f9ce5a194df30a970535b18c55c095">getApiVersion</a>(){
<a name="l00234"></a>00234         return \pocketmine\API_VERSION;
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236 
<a name="l00240"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a95f4304c8761313669609b9ec2055cc0">00240</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a95f4304c8761313669609b9ec2055cc0">getFilePath</a>(){
<a name="l00241"></a>00241         <span class="keywordflow">return</span> $this-&gt;filePath;
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243 
<a name="l00247"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a351940576579e51ede22778e8de54a67">00247</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a351940576579e51ede22778e8de54a67">getDataPath</a>(){
<a name="l00248"></a>00248         <span class="keywordflow">return</span> $this-&gt;dataPath;
<a name="l00249"></a>00249     }
<a name="l00250"></a>00250 
<a name="l00254"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2db11732779c7975c535b9d4858c81e1">00254</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2db11732779c7975c535b9d4858c81e1">getPluginPath</a>(){
<a name="l00255"></a>00255         <span class="keywordflow">return</span> $this-&gt;pluginPath;
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257 
<a name="l00261"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a34fc53d1942c7c1cf7c57f4f6924f2fe">00261</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a34fc53d1942c7c1cf7c57f4f6924f2fe">getMaxPlayers</a>(){
<a name="l00262"></a>00262         <span class="keywordflow">return</span> $this-&gt;maxPlayers;
<a name="l00263"></a>00263     }
<a name="l00264"></a>00264 
<a name="l00268"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3edbf7b2a001dc85c1d745475765983e">00268</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3edbf7b2a001dc85c1d745475765983e">getPort</a>(){
<a name="l00269"></a>00269         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;server-port&quot;</span>, 19132);
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271 
<a name="l00275"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6a849ef529ae9c09a58ca2c401a52b74">00275</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6a849ef529ae9c09a58ca2c401a52b74">getViewDistance</a>(){
<a name="l00276"></a>00276         <span class="keywordflow">return</span> min(11, max($this-&gt;getConfigInt(<span class="stringliteral">&quot;view-distance&quot;</span>, 7), 4));
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278 
<a name="l00282"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0181decc07fcfcfee74ca8e05da066ac">00282</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0181decc07fcfcfee74ca8e05da066ac">getIp</a>(){
<a name="l00283"></a>00283         <span class="keywordflow">return</span> $this-&gt;getConfigString(<span class="stringliteral">&quot;server-ip&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285 
<a name="l00289"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a46d68467c41a3650bf14a1957faa0cbc">00289</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a46d68467c41a3650bf14a1957faa0cbc">getServerName</a>(){
<a name="l00290"></a>00290         <span class="keywordflow">return</span> $this-&gt;getConfigString(<span class="stringliteral">&quot;server-name&quot;</span>, <span class="stringliteral">&quot;Unknown server&quot;</span>);
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 
<a name="l00296"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a4626a034d3a4486f5abb31306beada26">00296</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a4626a034d3a4486f5abb31306beada26">getLevelType</a>(){
<a name="l00297"></a>00297         <span class="keywordflow">return</span> $this-&gt;getConfigString(<span class="stringliteral">&quot;level-type&quot;</span>, <span class="stringliteral">&quot;DEFAULT&quot;</span>);
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00303"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa121c3ec5cfb590c424045977ae246d9">00303</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa121c3ec5cfb590c424045977ae246d9">getGenerateStructures</a>(){
<a name="l00304"></a>00304         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;generate-structures&quot;</span>, <span class="keyword">true</span>);
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306 
<a name="l00310"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1ed187d1b4b3754d76dbfd774bccc505">00310</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1ed187d1b4b3754d76dbfd774bccc505">getGamemode</a>(){
<a name="l00311"></a>00311         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;gamemode&quot;</span>, 0) &amp; 0b11;
<a name="l00312"></a>00312     }
<a name="l00313"></a>00313 
<a name="l00317"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a33676b0f56790f5b24b5d868450abfb7">00317</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a33676b0f56790f5b24b5d868450abfb7">getForceGamemode</a>(){
<a name="l00318"></a>00318         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;force-gamemode&quot;</span>, <span class="keyword">false</span>);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00328"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa633a31f5c0009a597dd6e8acbe595d8">00328</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa633a31f5c0009a597dd6e8acbe595d8">getGamemodeString</a>($mode){
<a name="l00329"></a>00329         <span class="keywordflow">switch</span>((<span class="keywordtype">int</span>) $mode){
<a name="l00330"></a>00330             <span class="keywordflow">case</span> Player::SURVIVAL:
<a name="l00331"></a>00331                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;SURVIVAL&quot;</span>;
<a name="l00332"></a>00332             <span class="keywordflow">case</span> Player::CREATIVE:
<a name="l00333"></a>00333                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;CREATIVE&quot;</span>;
<a name="l00334"></a>00334             <span class="keywordflow">case</span> Player::ADVENTURE:
<a name="l00335"></a>00335                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;ADVENTURE&quot;</span>;
<a name="l00336"></a>00336             <span class="keywordflow">case</span> Player::SPECTATOR:
<a name="l00337"></a>00337                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;SPECTATOR&quot;</span>;
<a name="l00338"></a>00338         }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340         <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNKNOWN&quot;</span>;
<a name="l00341"></a>00341     }
<a name="l00342"></a>00342 
<a name="l00350"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#addd964a3db05684e48bf62080fabcb2c">00350</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#addd964a3db05684e48bf62080fabcb2c">getGamemodeFromString</a>($str){
<a name="l00351"></a>00351         <span class="keywordflow">switch</span>(strtolower(trim($str))){
<a name="l00352"></a>00352             <span class="keywordflow">case</span> (<span class="keywordtype">string</span>) Player::SURVIVAL:
<a name="l00353"></a>00353             <span class="keywordflow">case</span> <span class="stringliteral">&quot;survival&quot;</span>:
<a name="l00354"></a>00354             <span class="keywordflow">case</span> <span class="stringliteral">&quot;s&quot;</span>:
<a name="l00355"></a>00355                 <span class="keywordflow">return</span> Player::SURVIVAL;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357             <span class="keywordflow">case</span> (<span class="keywordtype">string</span>) Player::CREATIVE:
<a name="l00358"></a>00358             <span class="keywordflow">case</span> <span class="stringliteral">&quot;creative&quot;</span>:
<a name="l00359"></a>00359             <span class="keywordflow">case</span> <span class="stringliteral">&quot;c&quot;</span>:
<a name="l00360"></a>00360                 <span class="keywordflow">return</span> Player::CREATIVE;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362             <span class="keywordflow">case</span> (<span class="keywordtype">string</span>) Player::ADVENTURE:
<a name="l00363"></a>00363             <span class="keywordflow">case</span> <span class="stringliteral">&quot;adventure&quot;</span>:
<a name="l00364"></a>00364             <span class="keywordflow">case</span> <span class="stringliteral">&quot;a&quot;</span>:
<a name="l00365"></a>00365                 <span class="keywordflow">return</span> Player::ADVENTURE;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367             <span class="keywordflow">case</span> (<span class="keywordtype">string</span>) Player::SPECTATOR:
<a name="l00368"></a>00368             <span class="keywordflow">case</span> <span class="stringliteral">&quot;spectator&quot;</span>:
<a name="l00369"></a>00369             <span class="keywordflow">case</span> <span class="stringliteral">&quot;view&quot;</span>:
<a name="l00370"></a>00370             <span class="keywordflow">case</span> <span class="stringliteral">&quot;v&quot;</span>:
<a name="l00371"></a>00371                 <span class="keywordflow">return</span> Player::SPECTATOR;
<a name="l00372"></a>00372         }
<a name="l00373"></a>00373         <span class="keywordflow">return</span> -1;
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375 
<a name="l00381"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3839746528326c085edb1f04498f473a">00381</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3839746528326c085edb1f04498f473a">getDifficultyFromString</a>($str){
<a name="l00382"></a>00382         <span class="keywordflow">switch</span>(strtolower(trim($str))){
<a name="l00383"></a>00383             <span class="keywordflow">case</span> <span class="stringliteral">&quot;0&quot;</span>:
<a name="l00384"></a>00384             <span class="keywordflow">case</span> <span class="stringliteral">&quot;peaceful&quot;</span>:
<a name="l00385"></a>00385             <span class="keywordflow">case</span> <span class="stringliteral">&quot;p&quot;</span>:
<a name="l00386"></a>00386                 <span class="keywordflow">return</span> 0;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388             <span class="keywordflow">case</span> <span class="stringliteral">&quot;1&quot;</span>:
<a name="l00389"></a>00389             <span class="keywordflow">case</span> <span class="stringliteral">&quot;easy&quot;</span>:
<a name="l00390"></a>00390             <span class="keywordflow">case</span> <span class="stringliteral">&quot;e&quot;</span>:
<a name="l00391"></a>00391                 <span class="keywordflow">return</span> 1;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393             <span class="keywordflow">case</span> <span class="stringliteral">&quot;2&quot;</span>:
<a name="l00394"></a>00394             <span class="keywordflow">case</span> <span class="stringliteral">&quot;normal&quot;</span>:
<a name="l00395"></a>00395             <span class="keywordflow">case</span> <span class="stringliteral">&quot;n&quot;</span>:
<a name="l00396"></a>00396                 <span class="keywordflow">return</span> 2;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398             <span class="keywordflow">case</span> <span class="stringliteral">&quot;3&quot;</span>:
<a name="l00399"></a>00399             <span class="keywordflow">case</span> <span class="stringliteral">&quot;hard&quot;</span>:
<a name="l00400"></a>00400             <span class="keywordflow">case</span> <span class="stringliteral">&quot;h&quot;</span>:
<a name="l00401"></a>00401                 <span class="keywordflow">return</span> 3;
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403         <span class="keywordflow">return</span> -1;
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 
<a name="l00409"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac5467ae1322f4e9a0add3dd47dad63fc">00409</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac5467ae1322f4e9a0add3dd47dad63fc">getDifficulty</a>(){
<a name="l00410"></a>00410         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;difficulty&quot;</span>, 1);
<a name="l00411"></a>00411     }
<a name="l00412"></a>00412 
<a name="l00416"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a64c6e1b40600af48d8e00422251ee8a0">00416</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a64c6e1b40600af48d8e00422251ee8a0">hasWhitelist</a>(){
<a name="l00417"></a>00417         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;white-list&quot;</span>, <span class="keyword">false</span>);
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 
<a name="l00423"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a7bf8fb080c6890b0ea196d333d453224">00423</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a7bf8fb080c6890b0ea196d333d453224">getSpawnRadius</a>(){
<a name="l00424"></a>00424         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;spawn-protection&quot;</span>, 16);
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 
<a name="l00430"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ad856f5f0435681a95f8d0594e1fdcd93">00430</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ad856f5f0435681a95f8d0594e1fdcd93">getAllowFlight</a>(){
<a name="l00431"></a>00431         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;allow-flight&quot;</span>, <span class="keyword">false</span>);
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433 
<a name="l00437"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a57b342fd413e8d0984fd5e4deaff6236">00437</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a57b342fd413e8d0984fd5e4deaff6236">isHardcore</a>(){
<a name="l00438"></a>00438         <span class="keywordflow">return</span> $this-&gt;getConfigBoolean(<span class="stringliteral">&quot;hardcore&quot;</span>, <span class="keyword">false</span>);
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 
<a name="l00444"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af1d998f0c790cac843e833a3fbfb478f">00444</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af1d998f0c790cac843e833a3fbfb478f">getDefaultGamemode</a>(){
<a name="l00445"></a>00445         <span class="keywordflow">return</span> $this-&gt;getConfigInt(<span class="stringliteral">&quot;gamemode&quot;</span>, 0) &amp; 0b11;
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447 
<a name="l00451"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1e7807b4cce45cbb94b1d4896698617b">00451</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1e7807b4cce45cbb94b1d4896698617b">getMotd</a>(){
<a name="l00452"></a>00452         <span class="keywordflow">return</span> $this-&gt;getConfigString(<span class="stringliteral">&quot;motd&quot;</span>, <span class="stringliteral">&quot;Minecraft: PE Server&quot;</span>);
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 
<a name="l00458"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af9c4f86ccd5d076e961e423be2fcdd9a">00458</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af9c4f86ccd5d076e961e423be2fcdd9a">getLoader</a>(){
<a name="l00459"></a>00459         <span class="keywordflow">return</span> $this-&gt;autoloader;
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461 
<a name="l00465"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5b32c69f8f444fc6b2768a5afc0af656">00465</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5b32c69f8f444fc6b2768a5afc0af656">getLogger</a>(){
<a name="l00466"></a>00466         <span class="keywordflow">return</span> $this-&gt;logger;
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468 
<a name="l00472"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2efb189e19a74df07c9f106b1c6aa71c">00472</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2efb189e19a74df07c9f106b1c6aa71c">getEntityMetadata</a>(){
<a name="l00473"></a>00473         <span class="keywordflow">return</span> $this-&gt;entityMetadata;
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475 
<a name="l00479"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a45cc8a980c3eda1d4e273cb306ba6ee2">00479</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a45cc8a980c3eda1d4e273cb306ba6ee2">getPlayerMetadata</a>(){
<a name="l00480"></a>00480         <span class="keywordflow">return</span> $this-&gt;playerMetadata;
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482 
<a name="l00486"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abfe026c6e1f8dc7dd37784d56baa8fe9">00486</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abfe026c6e1f8dc7dd37784d56baa8fe9">getLevelMetadata</a>(){
<a name="l00487"></a>00487         <span class="keywordflow">return</span> $this-&gt;levelMetadata;
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489 
<a name="l00493"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a564abe1d7f99cd090eb2850cf4d4f030">00493</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a564abe1d7f99cd090eb2850cf4d4f030">getUpdater</a>(){
<a name="l00494"></a>00494         <span class="keywordflow">return</span> $this-&gt;updater;
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496 
<a name="l00500"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a84e31713e6e82d71c1a05c735599d94e">00500</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a84e31713e6e82d71c1a05c735599d94e">getPluginManager</a>(){
<a name="l00501"></a>00501         <span class="keywordflow">return</span> $this-&gt;pluginManager;
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503 
<a name="l00507"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2645ea9d5ebe563eebd4b95062f0e2a9">00507</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2645ea9d5ebe563eebd4b95062f0e2a9">getCraftingManager</a>(){
<a name="l00508"></a>00508         <span class="keywordflow">return</span> $this-&gt;craftingManager;
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510 
<a name="l00514"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a4543769e8a4baebde1ebf2a52c8fbe1d">00514</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a4543769e8a4baebde1ebf2a52c8fbe1d">getScheduler</a>(){
<a name="l00515"></a>00515         <span class="keywordflow">return</span> $this-&gt;scheduler;
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517 
<a name="l00521"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6feac399caca26cc3d81f5367ee323e6">00521</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6feac399caca26cc3d81f5367ee323e6">getGenerationManager</a>(){
<a name="l00522"></a>00522         <span class="keywordflow">return</span> $this-&gt;generationManager;
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524 
<a name="l00528"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af584a38f21185a98def3acc867d5c1c0">00528</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af584a38f21185a98def3acc867d5c1c0">getTick</a>(){
<a name="l00529"></a>00529         <span class="keywordflow">return</span> $this-&gt;tickCounter;
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 
<a name="l00537"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3f09f0e8b2925c01d97c2a767c0eadad">00537</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a3f09f0e8b2925c01d97c2a767c0eadad">getTicksPerSecond</a>(){
<a name="l00538"></a>00538         <span class="keywordflow">return</span> round((0.05 / $this-&gt;tickMeasure) * 20, 2);
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540 
<a name="l00544"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a28497b688d55ae15e185a0078813c9e1">00544</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a28497b688d55ae15e185a0078813c9e1">getInterfaces</a>(){
<a name="l00545"></a>00545         <span class="keywordflow">return</span> $this-&gt;interfaces;
<a name="l00546"></a>00546     }
<a name="l00547"></a>00547 
<a name="l00551"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0a77866f12dab7c5a92cdb40cc1784e8">00551</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0a77866f12dab7c5a92cdb40cc1784e8">addInterface</a>(SourceInterface $interface){
<a name="l00552"></a>00552         $this-&gt;interfaces[spl_object_hash($interface)] = $interface;
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554 
<a name="l00558"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abfbccdc805ed1f787769d9c12ba8ba39">00558</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abfbccdc805ed1f787769d9c12ba8ba39">removeInterface</a>(SourceInterface $interface){
<a name="l00559"></a>00559         $interface-&gt;shutdown();
<a name="l00560"></a>00560         unset($this-&gt;interfaces[spl_object_hash($interface)]);
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562 
<a name="l00568"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a91629a8535231964b63adcaf1dfed7ec">00568</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a91629a8535231964b63adcaf1dfed7ec">sendPacket</a>($address, $port, $payload){
<a name="l00569"></a>00569         $this-&gt;mainInterface-&gt;putRaw($address, $port, $payload);
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571 
<a name="l00577"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a7b11edead6520050643a511d0c7b4a84">00577</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a7b11edead6520050643a511d0c7b4a84">handlePacket</a>($address, $port, $payload){
<a name="l00578"></a>00578         <span class="keywordflow">if</span>(strlen($payload) &gt; 2 and substr($payload, 0, 2) === <span class="stringliteral">&quot;\xfe\xfd&quot;</span> and $this-&gt;queryHandler instanceof QueryHandler){
<a name="l00579"></a>00579             $this-&gt;queryHandler-&gt;handle($address, $port, $payload);
<a name="l00580"></a>00580         } <span class="comment">//TODO: add raw packet events</span>
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582 
<a name="l00586"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ade8d430cfe9a43fa0dd5b3c515e63101">00586</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ade8d430cfe9a43fa0dd5b3c515e63101">getCommandMap</a>(){
<a name="l00587"></a>00587         <span class="keywordflow">return</span> $this-&gt;commandMap;
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589 
<a name="l00593"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab173ee59d49782e9a9fd13a1cdc39cbf">00593</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab173ee59d49782e9a9fd13a1cdc39cbf">getOnlinePlayers</a>(){
<a name="l00594"></a>00594         <span class="keywordflow">return</span> $this-&gt;players;
<a name="l00595"></a>00595     }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     <span class="keyword">public</span> <span class="keyword">function</span> addRecipe(Recipe $recipe){
<a name="l00598"></a>00598         $this-&gt;craftingManager-&gt;registerRecipe($recipe);
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600 
<a name="l00606"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6d7424f9555fa4438381aef1e5bb942e">00606</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6d7424f9555fa4438381aef1e5bb942e">getOfflinePlayer</a>($name){
<a name="l00607"></a>00607         $name = strtolower($name);
<a name="l00608"></a>00608         $result = $this-&gt;getPlayerExact($name);
<a name="l00609"></a>00609 
<a name="l00610"></a>00610         <span class="keywordflow">if</span>($result === null){
<a name="l00611"></a>00611             $result = <span class="keyword">new</span> <a class="code" href="../../d9/d5f/classpocketmine_1_1_offline_player.html">OfflinePlayer</a>($this, $name);
<a name="l00612"></a>00612         }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614         <span class="keywordflow">return</span> $result;
<a name="l00615"></a>00615     }
<a name="l00616"></a>00616 
<a name="l00622"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a488247de559bd8d720ae935d66d69949">00622</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a488247de559bd8d720ae935d66d69949">getOfflinePlayerData</a>($name){
<a name="l00623"></a>00623         $name = strtolower($name);
<a name="l00624"></a>00624         $path = $this-&gt;getDataPath() . <span class="stringliteral">&quot;players/&quot;</span>;
<a name="l00625"></a>00625         <span class="keywordflow">if</span>(!file_exists($path . <span class="stringliteral">&quot;$name.dat&quot;</span>)){
<a name="l00626"></a>00626             $spawn = $this-&gt;getDefaultLevel()-&gt;getSafeSpawn();
<a name="l00627"></a>00627             $nbt = <span class="keyword">new</span> Compound(<span class="keyword">false</span>, array(
<a name="l00628"></a>00628                 <span class="keyword">new</span> Long(<span class="stringliteral">&quot;firstPlayed&quot;</span>, floor(microtime(<span class="keyword">true</span>) * 1000)),
<a name="l00629"></a>00629                 <span class="keyword">new</span> Long(<span class="stringliteral">&quot;lastPlayed&quot;</span>, floor(microtime(<span class="keyword">true</span>) * 1000)),
<a name="l00630"></a>00630                 <span class="keyword">new</span> Enum(<span class="stringliteral">&quot;Pos&quot;</span>, array(
<a name="l00631"></a>00631                     <span class="keyword">new</span> Double(0, $spawn-&gt;x),
<a name="l00632"></a>00632                     <span class="keyword">new</span> Double(1, $spawn-&gt;y),
<a name="l00633"></a>00633                     <span class="keyword">new</span> Double(2, $spawn-&gt;z)
<a name="l00634"></a>00634                 )),
<a name="l00635"></a>00635                 <span class="keyword">new</span> String(<span class="stringliteral">&quot;Level&quot;</span>, $this-&gt;getDefaultLevel()-&gt;getName()),
<a name="l00636"></a>00636                 <span class="keyword">new</span> String(<span class="stringliteral">&quot;SpawnLevel&quot;</span>, $this-&gt;getDefaultLevel()-&gt;getName()),
<a name="l00637"></a>00637                 <span class="keyword">new</span> Int(<span class="stringliteral">&quot;SpawnX&quot;</span>, (<span class="keywordtype">int</span>) $spawn-&gt;x),
<a name="l00638"></a>00638                 <span class="keyword">new</span> Int(<span class="stringliteral">&quot;SpawnY&quot;</span>, (<span class="keywordtype">int</span>) $spawn-&gt;y),
<a name="l00639"></a>00639                 <span class="keyword">new</span> Int(<span class="stringliteral">&quot;SpawnZ&quot;</span>, (<span class="keywordtype">int</span>) $spawn-&gt;z),
<a name="l00640"></a>00640                 <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;SpawnForced&quot;</span>, 1), <span class="comment">//TODO</span>
<a name="l00641"></a>00641                 <span class="keyword">new</span> Enum(<span class="stringliteral">&quot;Inventory&quot;</span>, []),
<a name="l00642"></a>00642                 <span class="keyword">new</span> Compound(<span class="stringliteral">&quot;Achievements&quot;</span>, []),
<a name="l00643"></a>00643                 <span class="keyword">new</span> Int(<span class="stringliteral">&quot;playerGameType&quot;</span>, $this-&gt;getGamemode()),
<a name="l00644"></a>00644                 <span class="keyword">new</span> Enum(<span class="stringliteral">&quot;Motion&quot;</span>, array(
<a name="l00645"></a>00645                     <span class="keyword">new</span> Double(0, 0.0),
<a name="l00646"></a>00646                     <span class="keyword">new</span> Double(1, 0.0),
<a name="l00647"></a>00647                     <span class="keyword">new</span> Double(2, 0.0)
<a name="l00648"></a>00648                 )),
<a name="l00649"></a>00649                 <span class="keyword">new</span> Enum(<span class="stringliteral">&quot;Rotation&quot;</span>, array(
<a name="l00650"></a>00650                     <span class="keyword">new</span> Float(0, 0.0),
<a name="l00651"></a>00651                     <span class="keyword">new</span> Float(1, 0.0)
<a name="l00652"></a>00652                 )),
<a name="l00653"></a>00653                 <span class="keyword">new</span> Float(<span class="stringliteral">&quot;FallDistance&quot;</span>, 0.0),
<a name="l00654"></a>00654                 <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Fire&quot;</span>, 0),
<a name="l00655"></a>00655                 <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Air&quot;</span>, 0),
<a name="l00656"></a>00656                 <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;OnGround&quot;</span>, 1),
<a name="l00657"></a>00657                 <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Invulnerable&quot;</span>, 0),
<a name="l00658"></a>00658                 <span class="keyword">new</span> String(<span class="stringliteral">&quot;NameTag&quot;</span>, $name),
<a name="l00659"></a>00659             ));
<a name="l00660"></a>00660             $nbt-&gt;Pos-&gt;setTagType(NBT::TAG_Double);
<a name="l00661"></a>00661             $nbt-&gt;Inventory-&gt;setTagType(NBT::TAG_Compound);
<a name="l00662"></a>00662             $nbt-&gt;Motion-&gt;setTagType(NBT::TAG_Double);
<a name="l00663"></a>00663             $nbt-&gt;Rotation-&gt;setTagType(NBT::TAG_Float);
<a name="l00664"></a>00664 
<a name="l00665"></a>00665             <span class="keywordflow">if</span>(file_exists($path . <span class="stringliteral">&quot;$name.yml&quot;</span>)){ <span class="comment">//Importing old PocketMine-MP files</span>
<a name="l00666"></a>00666                 $data = <span class="keyword">new</span> Config($path . <span class="stringliteral">&quot;$name.yml&quot;</span>, Config::YAML, []);
<a name="l00667"></a>00667                 $nbt[<span class="stringliteral">&quot;playerGameType&quot;</span>] = (int) $data-&gt;get(<span class="stringliteral">&quot;gamemode&quot;</span>);
<a name="l00668"></a>00668                 $nbt[<span class="stringliteral">&quot;Level&quot;</span>] = $data-&gt;get(<span class="stringliteral">&quot;position&quot;</span>)[<span class="stringliteral">&quot;level&quot;</span>];
<a name="l00669"></a>00669                 $nbt[<span class="stringliteral">&quot;Pos&quot;</span>][0] = $data-&gt;get(<span class="stringliteral">&quot;position&quot;</span>)[<span class="stringliteral">&quot;x&quot;</span>];
<a name="l00670"></a>00670                 $nbt[<span class="stringliteral">&quot;Pos&quot;</span>][1] = $data-&gt;get(<span class="stringliteral">&quot;position&quot;</span>)[<span class="stringliteral">&quot;y&quot;</span>];
<a name="l00671"></a>00671                 $nbt[<span class="stringliteral">&quot;Pos&quot;</span>][2] = $data-&gt;get(<span class="stringliteral">&quot;position&quot;</span>)[<span class="stringliteral">&quot;z&quot;</span>];
<a name="l00672"></a>00672                 $nbt[<span class="stringliteral">&quot;SpawnLevel&quot;</span>] = $data-&gt;get(<span class="stringliteral">&quot;spawn&quot;</span>)[<span class="stringliteral">&quot;level&quot;</span>];
<a name="l00673"></a>00673                 $nbt[<span class="stringliteral">&quot;SpawnX&quot;</span>] = (int) $data-&gt;get(<span class="stringliteral">&quot;spawn&quot;</span>)[<span class="stringliteral">&quot;x&quot;</span>];
<a name="l00674"></a>00674                 $nbt[<span class="stringliteral">&quot;SpawnY&quot;</span>] = (int) $data-&gt;get(<span class="stringliteral">&quot;spawn&quot;</span>)[<span class="stringliteral">&quot;y&quot;</span>];
<a name="l00675"></a>00675                 $nbt[<span class="stringliteral">&quot;SpawnZ&quot;</span>] = (int) $data-&gt;get(<span class="stringliteral">&quot;spawn&quot;</span>)[<span class="stringliteral">&quot;z&quot;</span>];
<a name="l00676"></a>00676                 $this-&gt;logger-&gt;notice(<span class="stringliteral">&quot;Old Player data found for \&quot;&quot;</span> . $name . <span class="stringliteral">&quot;\&quot;, upgrading profile&quot;</span>);
<a name="l00677"></a>00677                 <span class="keywordflow">foreach</span>($data-&gt;get(<span class="stringliteral">&quot;inventory&quot;</span>) as $slot =&gt; $item){
<a name="l00678"></a>00678                     <span class="keywordflow">if</span>(count($item) === 3){
<a name="l00679"></a>00679                         $nbt-&gt;Inventory[$slot + 9] = <span class="keyword">new</span> Compound(<span class="keyword">false</span>, array(
<a name="l00680"></a>00680                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;id&quot;</span>, $item[0]),
<a name="l00681"></a>00681                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Damage&quot;</span>, $item[1]),
<a name="l00682"></a>00682                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Count&quot;</span>, $item[2]),
<a name="l00683"></a>00683                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Slot&quot;</span>, $slot + 9),
<a name="l00684"></a>00684                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;TrueSlot&quot;</span>, $slot + 9)
<a name="l00685"></a>00685                         ));
<a name="l00686"></a>00686                     }
<a name="l00687"></a>00687                 }
<a name="l00688"></a>00688                 <span class="keywordflow">foreach</span>($data-&gt;get(<span class="stringliteral">&quot;hotbar&quot;</span>) as $slot =&gt; $itemSlot){
<a name="l00689"></a>00689                     <span class="keywordflow">if</span>(isset($nbt-&gt;Inventory[$itemSlot + 9])){
<a name="l00690"></a>00690                         $item = $nbt-&gt;Inventory[$itemSlot + 9];
<a name="l00691"></a>00691                         $nbt-&gt;Inventory[$slot] = <span class="keyword">new</span> Compound(<span class="keyword">false</span>, array(
<a name="l00692"></a>00692                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;id&quot;</span>, $item-&gt;id),
<a name="l00693"></a>00693                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Damage&quot;</span>, $item-&gt;Damage),
<a name="l00694"></a>00694                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Count&quot;</span>, $item-&gt;Count),
<a name="l00695"></a>00695                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Slot&quot;</span>, $slot),
<a name="l00696"></a>00696                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;TrueSlot&quot;</span>, $item-&gt;TrueSlot)
<a name="l00697"></a>00697                         ));
<a name="l00698"></a>00698                     }
<a name="l00699"></a>00699                 }
<a name="l00700"></a>00700                 <span class="keywordflow">foreach</span>($data-&gt;get(<span class="stringliteral">&quot;armor&quot;</span>) as $slot =&gt; $item){
<a name="l00701"></a>00701                     <span class="keywordflow">if</span>(count($item) === 2){
<a name="l00702"></a>00702                         $nbt-&gt;Inventory[$slot + 100] = <span class="keyword">new</span> Compound(<span class="keyword">false</span>, array(
<a name="l00703"></a>00703                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;id&quot;</span>, $item[0]),
<a name="l00704"></a>00704                             <span class="keyword">new</span> Short(<span class="stringliteral">&quot;Damage&quot;</span>, $item[1]),
<a name="l00705"></a>00705                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Count&quot;</span>, 1),
<a name="l00706"></a>00706                             <span class="keyword">new</span> Byte(<span class="stringliteral">&quot;Slot&quot;</span>, $slot + 100)
<a name="l00707"></a>00707                         ));
<a name="l00708"></a>00708                     }
<a name="l00709"></a>00709                 }
<a name="l00710"></a>00710                 <span class="keywordflow">foreach</span>($data-&gt;get(<span class="stringliteral">&quot;achievements&quot;</span>) as $achievement =&gt; $status){
<a name="l00711"></a>00711                     $nbt-&gt;Achievements[$achievement] = <span class="keyword">new</span> Byte($achievement, $status == <span class="keyword">true</span> ? 1 : 0);
<a name="l00712"></a>00712                 }
<a name="l00713"></a>00713                 unlink($path . <span class="stringliteral">&quot;$name.yml&quot;</span>);
<a name="l00714"></a>00714             }<span class="keywordflow">else</span>{
<a name="l00715"></a>00715                 $this-&gt;logger-&gt;notice(<span class="stringliteral">&quot;Player data not found for \&quot;&quot;</span> . $name . <span class="stringliteral">&quot;\&quot;, creating new profile&quot;</span>);
<a name="l00716"></a>00716             }
<a name="l00717"></a>00717             $this-&gt;saveOfflinePlayerData($name, $nbt);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719             <span class="keywordflow">return</span> $nbt;
<a name="l00720"></a>00720         }<span class="keywordflow">else</span>{
<a name="l00721"></a>00721             $nbt = <span class="keyword">new</span> NBT(NBT::BIG_ENDIAN);
<a name="l00722"></a>00722             $nbt-&gt;readCompressed(file_get_contents($path . <span class="stringliteral">&quot;$name.dat&quot;</span>));
<a name="l00723"></a>00723 
<a name="l00724"></a>00724             <span class="keywordflow">return</span> $nbt-&gt;getData();
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727 
<a name="l00732"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0adf3b92ba17f5fb029417e08ced6d87">00732</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a0adf3b92ba17f5fb029417e08ced6d87">saveOfflinePlayerData</a>($name, Compound $nbtTag){
<a name="l00733"></a>00733         $nbt = <span class="keyword">new</span> NBT(NBT::BIG_ENDIAN);
<a name="l00734"></a>00734         $nbt-&gt;setData($nbtTag);
<a name="l00735"></a>00735         file_put_contents($this-&gt;getDataPath() . <span class="stringliteral">&quot;players/&quot;</span> . strtolower($name) . <span class="stringliteral">&quot;.dat&quot;</span>, $nbt-&gt;writeCompressed());
<a name="l00736"></a>00736     }
<a name="l00737"></a>00737 
<a name="l00743"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a11ca89d500fa7bd68ce92c9dec5e87c7">00743</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a11ca89d500fa7bd68ce92c9dec5e87c7">getPlayer</a>($name){
<a name="l00744"></a>00744         $found = null;
<a name="l00745"></a>00745         $name = strtolower($name);
<a name="l00746"></a>00746         $delta = PHP_INT_MAX;
<a name="l00747"></a>00747         <span class="keywordflow">foreach</span>($this-&gt;getOnlinePlayers() as $player){
<a name="l00748"></a>00748             <span class="keywordflow">if</span>(stripos($player-&gt;getName(), $name) === 0){
<a name="l00749"></a>00749                 $curDelta = strlen($player-&gt;getName()) - strlen($name);
<a name="l00750"></a>00750                 <span class="keywordflow">if</span>($curDelta &lt; $delta){
<a name="l00751"></a>00751                     $found = $player;
<a name="l00752"></a>00752                     $delta = $curDelta;
<a name="l00753"></a>00753                 }
<a name="l00754"></a>00754                 <span class="keywordflow">if</span>($curDelta === 0){
<a name="l00755"></a>00755                     <span class="keywordflow">break</span>;
<a name="l00756"></a>00756                 }
<a name="l00757"></a>00757             }
<a name="l00758"></a>00758         }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760         <span class="keywordflow">return</span> $found;
<a name="l00761"></a>00761     }
<a name="l00762"></a>00762 
<a name="l00768"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac88d550852c49cfc51e17c41ed453e62">00768</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac88d550852c49cfc51e17c41ed453e62">getPlayerExact</a>($name){
<a name="l00769"></a>00769         $name = strtolower($name);
<a name="l00770"></a>00770         <span class="keywordflow">foreach</span>($this-&gt;getOnlinePlayers() as $player){
<a name="l00771"></a>00771             <span class="keywordflow">if</span>(strtolower($player-&gt;getName()) === $name){
<a name="l00772"></a>00772                 <span class="keywordflow">return</span> $player;
<a name="l00773"></a>00773             }
<a name="l00774"></a>00774         }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776         <span class="keywordflow">return</span> null;
<a name="l00777"></a>00777     }
<a name="l00778"></a>00778 
<a name="l00784"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac1629347e675896064b5744a441dc189">00784</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac1629347e675896064b5744a441dc189">matchPlayer</a>($partialName){
<a name="l00785"></a>00785         $partialName = strtolower($partialName);
<a name="l00786"></a>00786         $matchedPlayers = [];
<a name="l00787"></a>00787         <span class="keywordflow">foreach</span>($this-&gt;getOnlinePlayers() as $player){
<a name="l00788"></a>00788             <span class="keywordflow">if</span>(strtolower($player-&gt;getName()) === $partialName){
<a name="l00789"></a>00789                 $matchedPlayers = array($player);
<a name="l00790"></a>00790                 <span class="keywordflow">break</span>;
<a name="l00791"></a>00791             }elseif(stripos($player-&gt;getName(), $partialName) !== <span class="keyword">false</span>){
<a name="l00792"></a>00792                 $matchedPlayers[] = $player;
<a name="l00793"></a>00793             }
<a name="l00794"></a>00794         }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796         <span class="keywordflow">return</span> $matchedPlayers;
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798 
<a name="l00802"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a367fb2e6f278c32c0ec534c92f20d1bb">00802</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a367fb2e6f278c32c0ec534c92f20d1bb">removePlayer</a>(<a class="code" href="../../df/d2c/classpocketmine_1_1_player.html">Player</a> $player){
<a name="l00803"></a>00803         <span class="keywordflow">if</span>($player-&gt;<a class="code" href="../../df/d2c/classpocketmine_1_1_player.html#ad129342e283c32902a928e413a11a136">isOnline</a>() === <span class="keyword">false</span>){
<a name="l00804"></a>00804             unset($this-&gt;players[$player-&gt;<a class="code" href="../../df/d2c/classpocketmine_1_1_player.html#a813a79221b9f51a6ef6f2b5de416735f">getAddress</a>() . <span class="stringliteral">&quot;:&quot;</span> . $player-&gt;<a class="code" href="../../df/d2c/classpocketmine_1_1_player.html#a5697e068c73b84615dcae1cc02ed8354">getPort</a>()]);
<a name="l00805"></a>00805         }
<a name="l00806"></a>00806     }
<a name="l00807"></a>00807 
<a name="l00811"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1b3f6752c126bddaf3303b10a2854028">00811</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1b3f6752c126bddaf3303b10a2854028">getLevels</a>(){
<a name="l00812"></a>00812         <span class="keywordflow">return</span> $this-&gt;levels;
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814 
<a name="l00818"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af85e6e324f7a562c215383c24317cf2a">00818</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af85e6e324f7a562c215383c24317cf2a">getDefaultLevel</a>(){
<a name="l00819"></a>00819         <span class="keywordflow">return</span> $this-&gt;levelDefault;
<a name="l00820"></a>00820     }
<a name="l00821"></a>00821 
<a name="l00829"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab29b6a4f96f4ab25bb825f7bf3d2f3fe">00829</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab29b6a4f96f4ab25bb825f7bf3d2f3fe">setDefaultLevel</a>($level){
<a name="l00830"></a>00830         <span class="keywordflow">if</span>($level === null or ($this-&gt;isLevelLoaded($level-&gt;getFolderName()) and $level !== $this-&gt;levelDefault)){
<a name="l00831"></a>00831             $this-&gt;levelDefault = $level;
<a name="l00832"></a>00832         }
<a name="l00833"></a>00833     }
<a name="l00834"></a>00834 
<a name="l00840"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab753dd9eb97cec14e31636d3123cb3e3">00840</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ab753dd9eb97cec14e31636d3123cb3e3">isLevelLoaded</a>($name){
<a name="l00841"></a>00841         <span class="keywordflow">return</span> $this-&gt;getLevelByName($name) instanceof Level;
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843 
<a name="l00849"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2cca785b9348b216c90905f3df454a45">00849</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2cca785b9348b216c90905f3df454a45">getLevel</a>($levelId){
<a name="l00850"></a>00850         <span class="keywordflow">if</span>(isset($this-&gt;levels[$levelId])){
<a name="l00851"></a>00851             <span class="keywordflow">return</span> $this-&gt;levels[$levelId];
<a name="l00852"></a>00852         }
<a name="l00853"></a>00853 
<a name="l00854"></a>00854         <span class="keywordflow">return</span> null;
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856 
<a name="l00862"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a021cf840abb4aa375bdb88caa1da81e6">00862</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a021cf840abb4aa375bdb88caa1da81e6">getLevelByName</a>($name){
<a name="l00863"></a>00863         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l00864"></a>00864             <span class="keywordflow">if</span>($level-&gt;getFolderName() === $name){
<a name="l00865"></a>00865                 <span class="keywordflow">return</span> $level;
<a name="l00866"></a>00866             }
<a name="l00867"></a>00867         }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869         <span class="keywordflow">return</span> null;
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871 
<a name="l00878"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1dbad5e1e5f4b5ac16818c5cff4ab85b">00878</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a1dbad5e1e5f4b5ac16818c5cff4ab85b">unloadLevel</a>(Level $level, $forceUnload = <span class="keyword">false</span>){
<a name="l00879"></a>00879         <span class="keywordflow">if</span>($level-&gt;unload($forceUnload) === <span class="keyword">true</span> and $this-&gt;isLevelLoaded($level-&gt;getFolderName())){
<a name="l00880"></a>00880             unset($this-&gt;levels[$level-&gt;getID()]);
<a name="l00881"></a>00881             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00882"></a>00882         }
<a name="l00883"></a>00883 
<a name="l00884"></a>00884         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00885"></a>00885     }
<a name="l00886"></a>00886 
<a name="l00896"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6214959ee395bc37213ad51c10a21c3c">00896</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6214959ee395bc37213ad51c10a21c3c">loadLevel</a>($name){
<a name="l00897"></a>00897         <span class="keywordflow">if</span>(trim($name) === <span class="stringliteral">&quot;&quot;</span>){
<a name="l00898"></a>00898             <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&quot;Invalid empty level name&quot;</span>);
<a name="l00899"></a>00899         }
<a name="l00900"></a>00900         <span class="keywordflow">if</span>($this-&gt;isLevelLoaded($name)){
<a name="l00901"></a>00901             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00902"></a>00902         }elseif(!$this-&gt;isLevelGenerated($name)){
<a name="l00903"></a>00903             $this-&gt;logger-&gt;notice(<span class="stringliteral">&quot;Level \&quot;&quot;</span> . $name . <span class="stringliteral">&quot;\&quot; not found&quot;</span>);
<a name="l00904"></a>00904 
<a name="l00905"></a>00905             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00906"></a>00906         }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908         $path = $this-&gt;getDataPath() . <span class="stringliteral">&quot;worlds/&quot;</span> . $name . <span class="stringliteral">&quot;/&quot;</span>;
<a name="l00909"></a>00909 
<a name="l00910"></a>00910         $provider = LevelProviderManager::getProvider($path);
<a name="l00911"></a>00911 
<a name="l00912"></a>00912         <span class="keywordflow">if</span>($provider === null){
<a name="l00913"></a>00913             $this-&gt;logger-&gt;error(<span class="stringliteral">&quot;Could not load level \&quot;&quot;</span> . $name . <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l00914"></a>00914 
<a name="l00915"></a>00915             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00916"></a>00916         }
<a name="l00917"></a>00917         <span class="comment">//$entities = new Config($path.&quot;entities.yml&quot;, Config::YAML);</span>
<a name="l00918"></a>00918         <span class="comment">//if(file_exists($path . &quot;tileEntities.yml&quot;)){</span>
<a name="l00919"></a>00919         <span class="comment">//  @rename($path . &quot;tileEntities.yml&quot;, $path . &quot;tiles.yml&quot;);</span>
<a name="l00920"></a>00920         <span class="comment">//}</span>
<a name="l00921"></a>00921 
<a name="l00922"></a>00922         $level = <span class="keyword">new</span> Level($this, $name, $path, $provider);
<a name="l00923"></a>00923         $this-&gt;levels[$level-&gt;getID()] = $level;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925         $this-&gt;getPluginManager()-&gt;callEvent(<span class="keyword">new</span> LevelLoadEvent($level));
<a name="l00926"></a>00926 
<a name="l00927"></a>00927         <span class="comment">/*foreach($entities-&gt;getAll() as $entity){</span>
<a name="l00928"></a>00928 <span class="comment">            if(!isset($entity[&quot;id&quot;])){</span>
<a name="l00929"></a>00929 <span class="comment">                break;</span>
<a name="l00930"></a>00930 <span class="comment">            }</span>
<a name="l00931"></a>00931 <span class="comment">            if($entity[&quot;id&quot;] === 64){ //Item Drop</span>
<a name="l00932"></a>00932 <span class="comment">                $e = $this-&gt;server-&gt;api-&gt;entity-&gt;add($this-&gt;levels[$name], ENTITY_ITEM, $entity[&quot;Item&quot;][&quot;id&quot;], array(</span>
<a name="l00933"></a>00933 <span class="comment">                    &quot;meta&quot; =&gt; $entity[&quot;Item&quot;][&quot;Damage&quot;],</span>
<a name="l00934"></a>00934 <span class="comment">                    &quot;stack&quot; =&gt; $entity[&quot;Item&quot;][&quot;Count&quot;],</span>
<a name="l00935"></a>00935 <span class="comment">                    &quot;x&quot; =&gt; $entity[&quot;Pos&quot;][0],</span>
<a name="l00936"></a>00936 <span class="comment">                    &quot;y&quot; =&gt; $entity[&quot;Pos&quot;][1],</span>
<a name="l00937"></a>00937 <span class="comment">                    &quot;z&quot; =&gt; $entity[&quot;Pos&quot;][2],</span>
<a name="l00938"></a>00938 <span class="comment">                    &quot;yaw&quot; =&gt; $entity[&quot;Rotation&quot;][0],</span>
<a name="l00939"></a>00939 <span class="comment">                    &quot;pitch&quot; =&gt; $entity[&quot;Rotation&quot;][1],</span>
<a name="l00940"></a>00940 <span class="comment">                ));</span>
<a name="l00941"></a>00941 <span class="comment">            }elseif($entity[&quot;id&quot;] === FALLING_SAND){</span>
<a name="l00942"></a>00942 <span class="comment">                $e = $this-&gt;server-&gt;api-&gt;entity-&gt;add($this-&gt;levels[$name], ENTITY_FALLING, $entity[&quot;id&quot;], $entity);</span>
<a name="l00943"></a>00943 <span class="comment">                $e-&gt;setPosition(new Vector3($entity[&quot;Pos&quot;][0], $entity[&quot;Pos&quot;][1], $entity[&quot;Pos&quot;][2]), $entity[&quot;Rotation&quot;][0], $entity[&quot;Rotation&quot;][1]);</span>
<a name="l00944"></a>00944 <span class="comment">                $e-&gt;setHealth($entity[&quot;Health&quot;]);</span>
<a name="l00945"></a>00945 <span class="comment">            }elseif($entity[&quot;id&quot;] === OBJECT_PAINTING or $entity[&quot;id&quot;] === OBJECT_ARROW){ //Painting</span>
<a name="l00946"></a>00946 <span class="comment">                $e = $this-&gt;server-&gt;api-&gt;entity-&gt;add($this-&gt;levels[$name], ENTITY_OBJECT, $entity[&quot;id&quot;], $entity);</span>
<a name="l00947"></a>00947 <span class="comment">                $e-&gt;setPosition(new Vector3($entity[&quot;Pos&quot;][0], $entity[&quot;Pos&quot;][1], $entity[&quot;Pos&quot;][2]), $entity[&quot;Rotation&quot;][0], $entity[&quot;Rotation&quot;][1]);</span>
<a name="l00948"></a>00948 <span class="comment">                $e-&gt;setHealth(1);</span>
<a name="l00949"></a>00949 <span class="comment">            }else{</span>
<a name="l00950"></a>00950 <span class="comment">                $e = $this-&gt;server-&gt;api-&gt;entity-&gt;add($this-&gt;levels[$name], ENTITY_MOB, $entity[&quot;id&quot;], $entity);</span>
<a name="l00951"></a>00951 <span class="comment">                $e-&gt;setPosition(new Vector3($entity[&quot;Pos&quot;][0], $entity[&quot;Pos&quot;][1], $entity[&quot;Pos&quot;][2]), $entity[&quot;Rotation&quot;][0], $entity[&quot;Rotation&quot;][1]);</span>
<a name="l00952"></a>00952 <span class="comment">                $e-&gt;setHealth($entity[&quot;Health&quot;]);</span>
<a name="l00953"></a>00953 <span class="comment">            }</span>
<a name="l00954"></a>00954 <span class="comment">        }*/</span>
<a name="l00955"></a>00955 
<a name="l00956"></a>00956         <span class="comment">/*if(file_exists($path . &quot;tiles.yml&quot;)){</span>
<a name="l00957"></a>00957 <span class="comment">            $tiles = new Config($path . &quot;tiles.yml&quot;, Config::YAML);</span>
<a name="l00958"></a>00958 <span class="comment">            foreach($tiles-&gt;getAll() as $tile){</span>
<a name="l00959"></a>00959 <span class="comment">                if(!isset($tile[&quot;id&quot;])){</span>
<a name="l00960"></a>00960 <span class="comment">                    continue;</span>
<a name="l00961"></a>00961 <span class="comment">                }</span>
<a name="l00962"></a>00962 <span class="comment">                $level-&gt;loadChunk($tile[&quot;x&quot;] &gt;&gt; 4, $tile[&quot;z&quot;] &gt;&gt; 4);</span>
<a name="l00963"></a>00963 <span class="comment"></span>
<a name="l00964"></a>00964 <span class="comment">                $nbt = new Compound(false, []);</span>
<a name="l00965"></a>00965 <span class="comment">                foreach($tile as $index =&gt; $data){</span>
<a name="l00966"></a>00966 <span class="comment">                    switch($index){</span>
<a name="l00967"></a>00967 <span class="comment">                        case &quot;Items&quot;:</span>
<a name="l00968"></a>00968 <span class="comment">                            $tag = new Enum(&quot;Items&quot;, []);</span>
<a name="l00969"></a>00969 <span class="comment">                            $tag-&gt;setTagType(NBT::TAG_Compound);</span>
<a name="l00970"></a>00970 <span class="comment">                            foreach($data as $slot =&gt; $fields){</span>
<a name="l00971"></a>00971 <span class="comment">                                $tag[(int) $slot] = new Compound(false, array(</span>
<a name="l00972"></a>00972 <span class="comment">                                    &quot;Count&quot; =&gt; new Byte(&quot;Count&quot;, $fields[&quot;Count&quot;]),</span>
<a name="l00973"></a>00973 <span class="comment">                                    &quot;Slot&quot; =&gt; new Short(&quot;Slot&quot;, $fields[&quot;Slot&quot;]),</span>
<a name="l00974"></a>00974 <span class="comment">                                    &quot;Damage&quot; =&gt; new Short(&quot;Damage&quot;, $fields[&quot;Damage&quot;]),</span>
<a name="l00975"></a>00975 <span class="comment">                                    &quot;id&quot; =&gt; new String(&quot;id&quot;, $fields[&quot;id&quot;])</span>
<a name="l00976"></a>00976 <span class="comment">                                ));</span>
<a name="l00977"></a>00977 <span class="comment">                            }</span>
<a name="l00978"></a>00978 <span class="comment">                            $nbt[&quot;Items&quot;] = $tag;</span>
<a name="l00979"></a>00979 <span class="comment">                            break;</span>
<a name="l00980"></a>00980 <span class="comment"></span>
<a name="l00981"></a>00981 <span class="comment">                        case &quot;id&quot;:</span>
<a name="l00982"></a>00982 <span class="comment">                        case &quot;Text1&quot;:</span>
<a name="l00983"></a>00983 <span class="comment">                        case &quot;Text2&quot;:</span>
<a name="l00984"></a>00984 <span class="comment">                        case &quot;Text3&quot;:</span>
<a name="l00985"></a>00985 <span class="comment">                        case &quot;Text4&quot;:</span>
<a name="l00986"></a>00986 <span class="comment">                            $nbt[$index] = new String($index, $data);</span>
<a name="l00987"></a>00987 <span class="comment">                            break;</span>
<a name="l00988"></a>00988 <span class="comment"></span>
<a name="l00989"></a>00989 <span class="comment">                        case &quot;x&quot;:</span>
<a name="l00990"></a>00990 <span class="comment">                        case &quot;y&quot;:</span>
<a name="l00991"></a>00991 <span class="comment">                        case &quot;z&quot;:</span>
<a name="l00992"></a>00992 <span class="comment">                        case &quot;pairx&quot;:</span>
<a name="l00993"></a>00993 <span class="comment">                        case &quot;pairz&quot;:</span>
<a name="l00994"></a>00994 <span class="comment">                            $nbt[$index] = new Int($index, $data);</span>
<a name="l00995"></a>00995 <span class="comment">                            break;</span>
<a name="l00996"></a>00996 <span class="comment"></span>
<a name="l00997"></a>00997 <span class="comment">                        case &quot;BurnTime&quot;:</span>
<a name="l00998"></a>00998 <span class="comment">                        case &quot;CookTime&quot;:</span>
<a name="l00999"></a>00999 <span class="comment">                        case &quot;MaxTime&quot;:</span>
<a name="l01000"></a>01000 <span class="comment">                            $nbt[$index] = new Short($index, $data);</span>
<a name="l01001"></a>01001 <span class="comment">                            break;</span>
<a name="l01002"></a>01002 <span class="comment">                    }</span>
<a name="l01003"></a>01003 <span class="comment">                }</span>
<a name="l01004"></a>01004 <span class="comment">                switch($tile[&quot;id&quot;]){</span>
<a name="l01005"></a>01005 <span class="comment">                    case Tile::FURNACE:</span>
<a name="l01006"></a>01006 <span class="comment">                        new Furnace($level, $nbt);</span>
<a name="l01007"></a>01007 <span class="comment">                        break;</span>
<a name="l01008"></a>01008 <span class="comment">                    case Tile::CHEST:</span>
<a name="l01009"></a>01009 <span class="comment">                        new Chest($level, $nbt);</span>
<a name="l01010"></a>01010 <span class="comment">                        break;</span>
<a name="l01011"></a>01011 <span class="comment">                    case Tile::SIGN:</span>
<a name="l01012"></a>01012 <span class="comment">                        new Sign($level, $nbt);</span>
<a name="l01013"></a>01013 <span class="comment">                        break;</span>
<a name="l01014"></a>01014 <span class="comment">                }</span>
<a name="l01015"></a>01015 <span class="comment">            }</span>
<a name="l01016"></a>01016 <span class="comment">            unlink($path . &quot;tiles.yml&quot;);</span>
<a name="l01017"></a>01017 <span class="comment">            $level-&gt;save(true, true);</span>
<a name="l01018"></a>01018 <span class="comment">        }*/</span>
<a name="l01019"></a>01019 
<a name="l01020"></a>01020         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01021"></a>01021     }
<a name="l01022"></a>01022 
<a name="l01033"></a>01033     <span class="keyword">public</span> <span class="keyword">function</span> generateLevel($name, $seed = null, $generator = null, array $options = []){
<a name="l01034"></a>01034         <span class="keywordflow">if</span>(trim($name) === <span class="stringliteral">&quot;&quot;</span> or $this-&gt;isLevelGenerated($name)){
<a name="l01035"></a>01035             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01036"></a>01036         }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038         $seed = $seed === null ? Binary::readInt(Utils::getRandomBytes(4, <span class="keyword">false</span>)) : (int) $seed;
<a name="l01039"></a>01039 
<a name="l01040"></a>01040         <span class="keywordflow">if</span>($generator !== null and class_exists($generator) and is_subclass_of($generator, <span class="stringliteral">&quot;pocketmine\\level\\generator\\Generator&quot;</span>)){
<a name="l01041"></a>01041             $generator = <span class="keyword">new</span> $generator($options);
<a name="l01042"></a>01042         }<span class="keywordflow">else</span>{
<a name="l01043"></a>01043             <span class="keywordflow">if</span>(strtoupper($this-&gt;getLevelType()) == <span class="stringliteral">&quot;FLAT&quot;</span>){
<a name="l01044"></a>01044                 $generator = Generator::getGenerator(<span class="stringliteral">&quot;flat&quot;</span>);
<a name="l01045"></a>01045                 $options[<span class="stringliteral">&quot;preset&quot;</span>] = $this-&gt;getConfigString(<span class="stringliteral">&quot;generator-settings&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01046"></a>01046             }<span class="keywordflow">else</span>{
<a name="l01047"></a>01047                 $generator = Generator::getGenerator(<span class="stringliteral">&quot;normal&quot;</span>);
<a name="l01048"></a>01048             }
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050 
<a name="l01051"></a>01051         $provider = <span class="stringliteral">&quot;pocketmine\\level\\format\\anvil\\Anvil&quot;</span>;
<a name="l01052"></a>01052 
<a name="l01053"></a>01053         $path = $this-&gt;getDataPath() . <span class="stringliteral">&quot;worlds/&quot;</span> . $name . <span class="stringliteral">&quot;/&quot;</span>;
<a name="l01055"></a>01055         $provider::generate($path, $name, $seed, $generator, $options);
<a name="l01056"></a>01056 
<a name="l01057"></a>01057         $level = <span class="keyword">new</span> Level($this, $name, $path, $provider);
<a name="l01058"></a>01058         $this-&gt;levels[$level-&gt;getID()] = $level;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060         $this-&gt;getPluginManager()-&gt;callEvent(<span class="keyword">new</span> LevelInitEvent($level));
<a name="l01061"></a>01061 
<a name="l01062"></a>01062         $this-&gt;getPluginManager()-&gt;callEvent(<span class="keyword">new</span> LevelLoadEvent($level));
<a name="l01063"></a>01063 
<a name="l01064"></a>01064         <span class="keywordflow">for</span>($Z = 5; $Z &lt;= 11; ++$Z){
<a name="l01065"></a>01065             <span class="keywordflow">for</span>($X = 5; $X &lt;= 11; ++$X){
<a name="l01066"></a>01066                 $level-&gt;generateChunk($X, $Z);
<a name="l01067"></a>01067             }
<a name="l01068"></a>01068         }
<a name="l01069"></a>01069 
<a name="l01070"></a>01070         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01071"></a>01071     }
<a name="l01072"></a>01072 
<a name="l01078"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a69b304816e4908963dbecf833886a7c3">01078</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a69b304816e4908963dbecf833886a7c3">isLevelGenerated</a>($name){
<a name="l01079"></a>01079         <span class="keywordflow">if</span>(trim($name) === <span class="stringliteral">&quot;&quot;</span>){
<a name="l01080"></a>01080             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01081"></a>01081         }
<a name="l01082"></a>01082         $path = $this-&gt;getDataPath() . <span class="stringliteral">&quot;worlds/&quot;</span> . $name . <span class="stringliteral">&quot;/&quot;</span>;
<a name="l01083"></a>01083         <span class="keywordflow">if</span>(!($this-&gt;getLevelByName($name) instanceof Level)){
<a name="l01084"></a>01084 
<a name="l01085"></a>01085             <span class="keywordflow">if</span>(LevelProviderManager::getProvider($path) === null){
<a name="l01086"></a>01086                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01087"></a>01087             }
<a name="l01088"></a>01088             <span class="comment">/*if(file_exists($path)){</span>
<a name="l01089"></a>01089 <span class="comment">                $level = new LevelImport($path);</span>
<a name="l01090"></a>01090 <span class="comment">                if($level-&gt;import() === false){ //Try importing a world</span>
<a name="l01091"></a>01091 <span class="comment">                    return false;</span>
<a name="l01092"></a>01092 <span class="comment">                }</span>
<a name="l01093"></a>01093 <span class="comment">            }else{</span>
<a name="l01094"></a>01094 <span class="comment">                return false;</span>
<a name="l01095"></a>01095 <span class="comment">            }*/</span>
<a name="l01096"></a>01096         }
<a name="l01097"></a>01097 
<a name="l01098"></a>01098         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01099"></a>01099     }
<a name="l01100"></a>01100 
<a name="l01107"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#adda555a21068a3533daca72a7af81a3a">01107</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#adda555a21068a3533daca72a7af81a3a">getConfigString</a>($variable, $defaultValue = <span class="stringliteral">&quot;&quot;</span>){
<a name="l01108"></a>01108         $v = getopt(<span class="stringliteral">&quot;&quot;</span>, array(<span class="stringliteral">&quot;$variable::&quot;</span>));
<a name="l01109"></a>01109         <span class="keywordflow">if</span>(isset($v[$variable])){
<a name="l01110"></a>01110             <span class="keywordflow">return</span> (<span class="keywordtype">string</span>) $v[$variable];
<a name="l01111"></a>01111         }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113         <span class="keywordflow">return</span> $this-&gt;properties-&gt;exists($variable) ? $this-&gt;properties-&gt;get($variable) : $defaultValue;
<a name="l01114"></a>01114     }
<a name="l01115"></a>01115 
<a name="l01122"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac265f101529c1a415db5927c18c34726">01122</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac265f101529c1a415db5927c18c34726">getProperty</a>($variable, $defaultValue = null){
<a name="l01123"></a>01123         $vars = explode(<span class="stringliteral">&quot;.&quot;</span>, $variable);
<a name="l01124"></a>01124         $base = array_shift($vars);
<a name="l01125"></a>01125         <span class="keywordflow">if</span>($this-&gt;config-&gt;exists($base)){
<a name="l01126"></a>01126             $base = $this-&gt;config-&gt;get($base);
<a name="l01127"></a>01127         }<span class="keywordflow">else</span>{
<a name="l01128"></a>01128             <span class="keywordflow">return</span> $defaultValue;
<a name="l01129"></a>01129         }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131         <span class="keywordflow">while</span>(count($vars) &gt; 0){
<a name="l01132"></a>01132             $baseKey = array_shift($vars);
<a name="l01133"></a>01133             <span class="keywordflow">if</span>(is_array($base) and isset($base[$baseKey])){
<a name="l01134"></a>01134                 $base = $base[$baseKey];
<a name="l01135"></a>01135             }<span class="keywordflow">else</span>{
<a name="l01136"></a>01136                 <span class="keywordflow">return</span> $defaultValue;
<a name="l01137"></a>01137             }
<a name="l01138"></a>01138         }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140         <span class="keywordflow">return</span> $base;
<a name="l01141"></a>01141     }
<a name="l01142"></a>01142 
<a name="l01147"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a066ef60cf58c5bcd99e11d8915a0eada">01147</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a066ef60cf58c5bcd99e11d8915a0eada">setConfigString</a>($variable, $value){
<a name="l01148"></a>01148         $this-&gt;properties-&gt;set($variable, $value);
<a name="l01149"></a>01149     }
<a name="l01150"></a>01150 
<a name="l01157"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a18d2faa05c5d6fc74e1a20490f0920a9">01157</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a18d2faa05c5d6fc74e1a20490f0920a9">getConfigInt</a>($variable, $defaultValue = 0){
<a name="l01158"></a>01158         $v = getopt(<span class="stringliteral">&quot;&quot;</span>, array(<span class="stringliteral">&quot;$variable::&quot;</span>));
<a name="l01159"></a>01159         <span class="keywordflow">if</span>(isset($v[$variable])){
<a name="l01160"></a>01160             <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) $v[$variable];
<a name="l01161"></a>01161         }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163         <span class="keywordflow">return</span> $this-&gt;properties-&gt;exists($variable) ? (int) $this-&gt;properties-&gt;get($variable) : (int) $defaultValue;
<a name="l01164"></a>01164     }
<a name="l01165"></a>01165 
<a name="l01170"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abd71b5ad117b1ba5af5665abed2c3c49">01170</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#abd71b5ad117b1ba5af5665abed2c3c49">setConfigInt</a>($variable, $value){
<a name="l01171"></a>01171         $this-&gt;properties-&gt;set($variable, (<span class="keywordtype">int</span>) $value);
<a name="l01172"></a>01172     }
<a name="l01173"></a>01173 
<a name="l01180"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a02bc691da9dbf2429fc2ffa1729f9910">01180</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a02bc691da9dbf2429fc2ffa1729f9910">getConfigBoolean</a>($variable, $defaultValue = <span class="keyword">false</span>){
<a name="l01181"></a>01181         $v = getopt(<span class="stringliteral">&quot;&quot;</span>, array(<span class="stringliteral">&quot;$variable::&quot;</span>));
<a name="l01182"></a>01182         <span class="keywordflow">if</span>(isset($v[$variable])){
<a name="l01183"></a>01183             $value = $v[$variable];
<a name="l01184"></a>01184         }<span class="keywordflow">else</span>{
<a name="l01185"></a>01185             $value = $this-&gt;properties-&gt;exists($variable) ? $this-&gt;properties-&gt;get($variable) : $defaultValue;
<a name="l01186"></a>01186         }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188         <span class="keywordflow">if</span>(is_bool($value)){
<a name="l01189"></a>01189             <span class="keywordflow">return</span> $value;
<a name="l01190"></a>01190         }
<a name="l01191"></a>01191         <span class="keywordflow">switch</span>(strtolower($value)){
<a name="l01192"></a>01192             <span class="keywordflow">case</span> <span class="stringliteral">&quot;on&quot;</span>:
<a name="l01193"></a>01193             <span class="keywordflow">case</span> <span class="stringliteral">&quot;true&quot;</span>:
<a name="l01194"></a>01194             <span class="keywordflow">case</span> <span class="stringliteral">&quot;1&quot;</span>:
<a name="l01195"></a>01195             <span class="keywordflow">case</span> <span class="stringliteral">&quot;yes&quot;</span>:
<a name="l01196"></a>01196                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01197"></a>01197         }
<a name="l01198"></a>01198 
<a name="l01199"></a>01199         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01200"></a>01200     }
<a name="l01201"></a>01201 
<a name="l01206"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ad668cf5d808100a8c610b92eb4a0eaea">01206</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ad668cf5d808100a8c610b92eb4a0eaea">setConfigBool</a>($variable, $value){
<a name="l01207"></a>01207         $this-&gt;properties-&gt;set($variable, $value == <span class="keyword">true</span> ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);
<a name="l01208"></a>01208     }
<a name="l01209"></a>01209 
<a name="l01215"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6349a96662299bd31b23e2db65e877d3">01215</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a6349a96662299bd31b23e2db65e877d3">getPluginCommand</a>($name){
<a name="l01216"></a>01216         <span class="keywordflow">if</span>(($command = $this-&gt;commandMap-&gt;getCommand($name)) instanceof PluginIdentifiableCommand){
<a name="l01217"></a>01217             <span class="keywordflow">return</span> $command;
<a name="l01218"></a>01218         }<span class="keywordflow">else</span>{
<a name="l01219"></a>01219             <span class="keywordflow">return</span> null;
<a name="l01220"></a>01220         }
<a name="l01221"></a>01221     }
<a name="l01222"></a>01222 
<a name="l01226"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aef9a89a6ddfa4f24db1e6591943c8d36">01226</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aef9a89a6ddfa4f24db1e6591943c8d36">getNameBans</a>(){
<a name="l01227"></a>01227         <span class="keywordflow">return</span> $this-&gt;banByName;
<a name="l01228"></a>01228     }
<a name="l01229"></a>01229 
<a name="l01233"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a860eca57448382c37113d750e07f1a0d">01233</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a860eca57448382c37113d750e07f1a0d">getIPBans</a>(){
<a name="l01234"></a>01234         <span class="keywordflow">return</span> $this-&gt;banByIP;
<a name="l01235"></a>01235     }
<a name="l01236"></a>01236 
<a name="l01240"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af2e736d87e59fefd0665884e44249dc5">01240</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af2e736d87e59fefd0665884e44249dc5">addOp</a>($name){
<a name="l01241"></a>01241         $this-&gt;operators-&gt;set(strtolower($name), <span class="keyword">true</span>);
<a name="l01242"></a>01242 
<a name="l01243"></a>01243         <span class="keywordflow">if</span>(($player = $this-&gt;getPlayerExact($name)) instanceof <a class="code" href="../../df/d2c/classpocketmine_1_1_player.html">Player</a>){
<a name="l01244"></a>01244             $player-&gt;recalculatePermissions();
<a name="l01245"></a>01245         }
<a name="l01246"></a>01246         $this-&gt;operators-&gt;save();
<a name="l01247"></a>01247     }
<a name="l01248"></a>01248 
<a name="l01252"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a130fbe5b5da60c7b89062fd98a798830">01252</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a130fbe5b5da60c7b89062fd98a798830">removeOp</a>($name){
<a name="l01253"></a>01253         $this-&gt;operators-&gt;remove(strtolower($name));
<a name="l01254"></a>01254 
<a name="l01255"></a>01255         <span class="keywordflow">if</span>(($player = $this-&gt;getPlayerExact($name)) instanceof <a class="code" href="../../df/d2c/classpocketmine_1_1_player.html">Player</a>){
<a name="l01256"></a>01256             $player-&gt;recalculatePermissions();
<a name="l01257"></a>01257         }
<a name="l01258"></a>01258         $this-&gt;operators-&gt;save();
<a name="l01259"></a>01259     }
<a name="l01260"></a>01260 
<a name="l01264"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa49d4ae6654a2661dc8d3486d03a74ca">01264</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aa49d4ae6654a2661dc8d3486d03a74ca">addWhitelist</a>($name){
<a name="l01265"></a>01265         $this-&gt;whitelist-&gt;set(strtolower($name), <span class="keyword">true</span>);
<a name="l01266"></a>01266         $this-&gt;whitelist-&gt;save();
<a name="l01267"></a>01267     }
<a name="l01268"></a>01268 
<a name="l01272"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aeb881b8fae095764efeb0ececee8f60d">01272</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#aeb881b8fae095764efeb0ececee8f60d">removeWhitelist</a>($name){
<a name="l01273"></a>01273         $this-&gt;whitelist-&gt;remove(strtolower($name));
<a name="l01274"></a>01274         $this-&gt;whitelist-&gt;save();
<a name="l01275"></a>01275     }
<a name="l01276"></a>01276 
<a name="l01282"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a925730d6322733ed1d4b25f465e29861">01282</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a925730d6322733ed1d4b25f465e29861">isWhitelisted</a>($name){
<a name="l01283"></a>01283         <span class="keywordflow">return</span> !$this-&gt;hasWhitelist() or $this-&gt;operators-&gt;exists($name, <span class="keyword">true</span>) or $this-&gt;whitelist-&gt;exists($name, <span class="keyword">true</span>);
<a name="l01284"></a>01284     }
<a name="l01285"></a>01285 
<a name="l01291"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a19138d1076b6f6eaa10ab9b4a09296ea">01291</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a19138d1076b6f6eaa10ab9b4a09296ea">isOp</a>($name){
<a name="l01292"></a>01292         <span class="keywordflow">return</span> $this-&gt;operators-&gt;exists($name, <span class="keyword">true</span>);
<a name="l01293"></a>01293     }
<a name="l01294"></a>01294 
<a name="l01298"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a725ac49cf0ff1d37bb90457c1507874f">01298</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a725ac49cf0ff1d37bb90457c1507874f">getWhitelisted</a>(){
<a name="l01299"></a>01299         <span class="keywordflow">return</span> $this-&gt;whitelist;
<a name="l01300"></a>01300     }
<a name="l01301"></a>01301 
<a name="l01305"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a69fbc0762846eb5c23205f4342815a7e">01305</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a69fbc0762846eb5c23205f4342815a7e">getOPs</a>(){
<a name="l01306"></a>01306         <span class="keywordflow">return</span> $this-&gt;operators;
<a name="l01307"></a>01307     }
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     <span class="keyword">public</span> <span class="keyword">function</span> reloadWhitelist(){
<a name="l01310"></a>01310         $this-&gt;whitelist-&gt;reload();
<a name="l01311"></a>01311     }
<a name="l01312"></a>01312 
<a name="l01316"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a54adb1578aafddec9f34c1af3f660b45">01316</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a54adb1578aafddec9f34c1af3f660b45">getCommandAliases</a>(){
<a name="l01317"></a>01317         $section = $this-&gt;getProperty(<span class="stringliteral">&quot;aliases&quot;</span>);
<a name="l01318"></a>01318         $result = [];
<a name="l01319"></a>01319         <span class="keywordflow">if</span>(is_array($section)){
<a name="l01320"></a>01320             <span class="keywordflow">foreach</span>($section as $key =&gt; $value){
<a name="l01321"></a>01321                 $commands = [];
<a name="l01322"></a>01322                 <span class="keywordflow">if</span>(is_array($value)){
<a name="l01323"></a>01323                     $commands = $value;
<a name="l01324"></a>01324                 }<span class="keywordflow">else</span>{
<a name="l01325"></a>01325                     $commands[] = $value;
<a name="l01326"></a>01326                 }
<a name="l01327"></a>01327 
<a name="l01328"></a>01328                 $result[$key] = $commands;
<a name="l01329"></a>01329             }
<a name="l01330"></a>01330         }
<a name="l01331"></a>01331 
<a name="l01332"></a>01332         <span class="keywordflow">return</span> $result;
<a name="l01333"></a>01333     }
<a name="l01334"></a>01334 
<a name="l01338"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8d9b9873eb3c7efce048f10f803c2b2e">01338</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a8d9b9873eb3c7efce048f10f803c2b2e">getInstance</a>(){
<a name="l01339"></a>01339         <span class="keywordflow">return</span> self::$instance;
<a name="l01340"></a>01340     }
<a name="l01341"></a>01341 
<a name="l01349"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af97447fb9c82067aab4c6fd9e2dfea6c">01349</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#af97447fb9c82067aab4c6fd9e2dfea6c">__construct</a>(\SplClassLoader $autoloader, \<a class="code" href="../../d0/d55/class_threaded_logger.html">ThreadedLogger</a> $logger, $filePath, $dataPath, $pluginPath){
<a name="l01350"></a>01350         self::$instance = $this;
<a name="l01351"></a>01351 
<a name="l01352"></a>01352         $this-&gt;autoloader = $autoloader;
<a name="l01353"></a>01353         $this-&gt;logger = $logger;
<a name="l01354"></a>01354         $this-&gt;filePath = $filePath;
<a name="l01355"></a>01355         $this-&gt;dataPath = $dataPath;
<a name="l01356"></a>01356         $this-&gt;pluginPath = $pluginPath;
<a name="l01357"></a>01357         @mkdir($this-&gt;dataPath . <span class="stringliteral">&quot;worlds/&quot;</span>, 0777);
<a name="l01358"></a>01358         @mkdir($this-&gt;dataPath . <span class="stringliteral">&quot;players/&quot;</span>, 0777);
<a name="l01359"></a>01359         @mkdir($this-&gt;pluginPath, 0777);
<a name="l01360"></a>01360 
<a name="l01361"></a>01361         $this-&gt;entityMetadata = <span class="keyword">new</span> EntityMetadataStore();
<a name="l01362"></a>01362         $this-&gt;playerMetadata = <span class="keyword">new</span> PlayerMetadataStore();
<a name="l01363"></a>01363         $this-&gt;levelMetadata = <span class="keyword">new</span> LevelMetadataStore();
<a name="l01364"></a>01364 
<a name="l01365"></a>01365         $this-&gt;operators = new Config($this-&gt;dataPath . <span class="stringliteral">&quot;ops.txt&quot;</span>, Config::ENUM);
<a name="l01366"></a>01366         $this-&gt;whitelist = <span class="keyword">new</span> Config($this-&gt;dataPath . <span class="stringliteral">&quot;white-list.txt&quot;</span>, Config::ENUM);
<a name="l01367"></a>01367         <span class="keywordflow">if</span>(file_exists($this-&gt;dataPath . <span class="stringliteral">&quot;banned.txt&quot;</span>) and !file_exists($this-&gt;dataPath . <span class="stringliteral">&quot;banned-players.txt&quot;</span>)){
<a name="l01368"></a>01368             @rename($this-&gt;dataPath . <span class="stringliteral">&quot;banned.txt&quot;</span>, $this-&gt;dataPath . <span class="stringliteral">&quot;banned-players.txt&quot;</span>);
<a name="l01369"></a>01369         }
<a name="l01370"></a>01370         @touch($this-&gt;dataPath . <span class="stringliteral">&quot;banned-players.txt&quot;</span>);
<a name="l01371"></a>01371         $this-&gt;banByName = <span class="keyword">new</span> BanList($this-&gt;dataPath . <span class="stringliteral">&quot;banned-players.txt&quot;</span>);
<a name="l01372"></a>01372         $this-&gt;banByName-&gt;load();
<a name="l01373"></a>01373         @touch($this-&gt;dataPath . <span class="stringliteral">&quot;banned-ips.txt&quot;</span>);
<a name="l01374"></a>01374         $this-&gt;banByIP = <span class="keyword">new</span> BanList($this-&gt;dataPath . <span class="stringliteral">&quot;banned-ips.txt&quot;</span>);
<a name="l01375"></a>01375         $this-&gt;banByIP-&gt;load();
<a name="l01376"></a>01376 
<a name="l01377"></a>01377         $this-&gt;console = <span class="keyword">new</span> CommandReader();
<a name="l01378"></a>01378 
<a name="l01379"></a>01379         $version = <span class="keyword">new</span> VersionString($this-&gt;getPocketMineVersion());
<a name="l01380"></a>01380         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Starting Minecraft: PE server version &quot;</span> . TextFormat::AQUA . $this-&gt;getVersion());
<a name="l01381"></a>01381 
<a name="l01382"></a>01382         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Loading properties...&quot;</span>);
<a name="l01383"></a>01383         <span class="keywordflow">if</span>(!file_exists($this-&gt;dataPath . <span class="stringliteral">&quot;pocketmine.yml&quot;</span>)){
<a name="l01384"></a>01384             @file_put_contents($this-&gt;dataPath . <span class="stringliteral">&quot;pocketmine.yml&quot;</span>, file_get_contents($this-&gt;filePath . <span class="stringliteral">&quot;src/pocketmine/resources/pocketmine.yml&quot;</span>));
<a name="l01385"></a>01385         }
<a name="l01386"></a>01386         $this-&gt;config = <span class="keyword">new</span> Config($this-&gt;dataPath . <span class="stringliteral">&quot;pocketmine.yml&quot;</span>, Config::YAML, []);
<a name="l01387"></a>01387         $this-&gt;properties = <span class="keyword">new</span> Config($this-&gt;dataPath . <span class="stringliteral">&quot;server.properties&quot;</span>, Config::PROPERTIES, array(
<a name="l01388"></a>01388             <span class="stringliteral">&quot;motd&quot;</span> =&gt; <span class="stringliteral">&quot;Minecraft: PE Server&quot;</span>,
<a name="l01389"></a>01389             <span class="stringliteral">&quot;server-port&quot;</span> =&gt; 19132,
<a name="l01390"></a>01390             <span class="stringliteral">&quot;memory-limit&quot;</span> =&gt; <span class="stringliteral">&quot;256M&quot;</span>,
<a name="l01391"></a>01391             <span class="stringliteral">&quot;white-list&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01392"></a>01392             <span class="stringliteral">&quot;announce-player-achievements&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01393"></a>01393             <span class="stringliteral">&quot;spawn-protection&quot;</span> =&gt; 16,
<a name="l01394"></a>01394             <span class="stringliteral">&quot;view-distance&quot;</span> =&gt; 8,
<a name="l01395"></a>01395             <span class="stringliteral">&quot;max-players&quot;</span> =&gt; 20,
<a name="l01396"></a>01396             <span class="stringliteral">&quot;allow-flight&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01397"></a>01397             <span class="stringliteral">&quot;spawn-animals&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01398"></a>01398             <span class="stringliteral">&quot;spawn-mobs&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01399"></a>01399             <span class="stringliteral">&quot;gamemode&quot;</span> =&gt; 0,
<a name="l01400"></a>01400             <span class="stringliteral">&quot;force-gamemode&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01401"></a>01401             <span class="stringliteral">&quot;hardcore&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01402"></a>01402             <span class="stringliteral">&quot;pvp&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01403"></a>01403             <span class="stringliteral">&quot;difficulty&quot;</span> =&gt; 1,
<a name="l01404"></a>01404             <span class="stringliteral">&quot;generator-settings&quot;</span> =&gt; <span class="stringliteral">&quot;&quot;</span>,
<a name="l01405"></a>01405             <span class="stringliteral">&quot;level-name&quot;</span> =&gt; <span class="stringliteral">&quot;world&quot;</span>,
<a name="l01406"></a>01406             <span class="stringliteral">&quot;level-seed&quot;</span> =&gt; <span class="stringliteral">&quot;&quot;</span>,
<a name="l01407"></a>01407             <span class="stringliteral">&quot;level-type&quot;</span> =&gt; <span class="stringliteral">&quot;DEFAULT&quot;</span>,
<a name="l01408"></a>01408             <span class="stringliteral">&quot;enable-query&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01409"></a>01409             <span class="stringliteral">&quot;enable-rcon&quot;</span> =&gt; <span class="keyword">false</span>,
<a name="l01410"></a>01410             <span class="stringliteral">&quot;rcon.password&quot;</span> =&gt; substr(base64_encode(Utils::getRandomBytes(20, <span class="keyword">false</span>)), 3, 10),
<a name="l01411"></a>01411             <span class="stringliteral">&quot;auto-save&quot;</span> =&gt; <span class="keyword">true</span>,
<a name="l01412"></a>01412         ));
<a name="l01413"></a>01413 
<a name="l01414"></a>01414         ServerScheduler::$WORKERS = $this-&gt;getProperty(<span class="stringliteral">&quot;settings.async-workers&quot;</span>, ServerScheduler::$WORKERS);
<a name="l01415"></a>01415 
<a name="l01416"></a>01416         $this-&gt;scheduler = <span class="keyword">new</span> ServerScheduler();
<a name="l01417"></a>01417 
<a name="l01418"></a>01418         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;enable-rcon&quot;</span>, <span class="keyword">false</span>) === <span class="keyword">true</span>){
<a name="l01419"></a>01419             $this-&gt;rcon = <span class="keyword">new</span> RCON($this-&gt;getConfigString(<span class="stringliteral">&quot;rcon.password&quot;</span>, <span class="stringliteral">&quot;&quot;</span>), $this-&gt;getConfigInt(<span class="stringliteral">&quot;rcon.port&quot;</span>, $this-&gt;getPort()), ($ip = $this-&gt;getIp()) != <span class="stringliteral">&quot;&quot;</span> ? $ip : <span class="stringliteral">&quot;0.0.0.0&quot;</span>, $this-&gt;getConfigInt(<span class="stringliteral">&quot;rcon.threads&quot;</span>, 1), $this-&gt;getConfigInt(<span class="stringliteral">&quot;rcon.clients-per-thread&quot;</span>, 50));
<a name="l01420"></a>01420         }
<a name="l01421"></a>01421 
<a name="l01422"></a>01422         $this-&gt;maxPlayers = $this-&gt;getConfigInt(<span class="stringliteral">&quot;max-players&quot;</span>, 20);
<a name="l01423"></a>01423 
<a name="l01424"></a>01424         <span class="keywordflow">if</span>(($memory = str_replace(<span class="stringliteral">&quot;B&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, strtoupper($this-&gt;getConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>, <span class="stringliteral">&quot;128M&quot;</span>)))) !== <span class="keyword">false</span>){
<a name="l01425"></a>01425             $value = array(<span class="stringliteral">&quot;M&quot;</span> =&gt; 1, <span class="stringliteral">&quot;G&quot;</span> =&gt; 1024);
<a name="l01426"></a>01426             $real = ((int) substr($memory, 0, -1)) * $value[substr($memory, -1)];
<a name="l01427"></a>01427             <span class="keywordflow">if</span>($real &lt; 128){
<a name="l01428"></a>01428                 $this-&gt;logger-&gt;warning(<span class="stringliteral">&quot;PocketMine-MP may not work right with less than 128MB of RAM&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01429"></a>01429             }
<a name="l01430"></a>01430             @ini_set(<span class="stringliteral">&quot;memory_limit&quot;</span>, $memory);
<a name="l01431"></a>01431         }<span class="keywordflow">else</span>{
<a name="l01432"></a>01432             $this-&gt;setConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>, <span class="stringliteral">&quot;128M&quot;</span>);
<a name="l01433"></a>01433         }
<a name="l01434"></a>01434 
<a name="l01435"></a>01435         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;hardcore&quot;</span>, <span class="keyword">false</span>) === <span class="keyword">true</span> and $this-&gt;getDifficulty() &lt; 3){
<a name="l01436"></a>01436             $this-&gt;setConfigInt(<span class="stringliteral">&quot;difficulty&quot;</span>, 3);
<a name="l01437"></a>01437         }
<a name="l01438"></a>01438 
<a name="l01439"></a>01439         define(<span class="stringliteral">&quot;pocketmine\\DEBUG&quot;</span>, $this-&gt;getProperty(<span class="stringliteral">&quot;debug.level&quot;</span>, 1));
<a name="l01440"></a>01440         <span class="keywordflow">if</span>($this-&gt;logger instanceof MainLogger){
<a name="l01441"></a>01441             $this-&gt;logger-&gt;setLogDebug(\pocketmine\DEBUG &gt; 1);
<a name="l01442"></a>01442         }
<a name="l01443"></a>01443         define(<span class="stringliteral">&quot;ADVANCED_CACHE&quot;</span>, $this-&gt;getProperty(<span class="stringliteral">&quot;settings.advanced-cache&quot;</span>, <span class="keyword">false</span>));
<a name="l01444"></a>01444         <span class="keywordflow">if</span>(ADVANCED_CACHE == <span class="keyword">true</span>){
<a name="l01445"></a>01445             $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Advanced cache enabled&quot;</span>);
<a name="l01446"></a>01446         }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448         Level::$COMPRESSION_LEVEL = $this-&gt;getProperty(<span class="stringliteral">&quot;chunk-sending.compression-level&quot;</span>, 7);
<a name="l01449"></a>01449 
<a name="l01450"></a>01450         <span class="keywordflow">if</span>(defined(<span class="stringliteral">&quot;pocketmine\\DEBUG&quot;</span>) and \pocketmine\DEBUG &gt;= 0 and function_exists(<span class="stringliteral">&quot;cli_set_process_title&quot;</span>)){
<a name="l01451"></a>01451             @cli_set_process_title(<span class="stringliteral">&quot;PocketMine-MP &quot;</span> . $this-&gt;getPocketMineVersion());
<a name="l01452"></a>01452         }
<a name="l01453"></a>01453 
<a name="l01454"></a>01454         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Starting Minecraft PE server on &quot;</span> . ($this-&gt;getIp() === <span class="stringliteral">&quot;&quot;</span> ? <span class="stringliteral">&quot;*&quot;</span> : $this-&gt;getIp()) . <span class="stringliteral">&quot;:&quot;</span> . $this-&gt;getPort());
<a name="l01455"></a>01455         define(<span class="stringliteral">&quot;BOOTUP_RANDOM&quot;</span>, Utils::getRandomBytes(16));
<a name="l01456"></a>01456         $this-&gt;serverID = Binary::readLong(substr(Utils::getUniqueID(<span class="keyword">true</span>, $this-&gt;getIp() . $this-&gt;getPort()), 0, 8));
<a name="l01457"></a>01457 
<a name="l01458"></a>01458         $this-&gt;addInterface($this-&gt;mainInterface = <span class="keyword">new</span> RakLibInterface($this));
<a name="l01459"></a>01459 
<a name="l01460"></a>01460         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;This server is running PocketMine-MP version &quot;</span> . ($version-&gt;isDev() ? TextFormat::YELLOW : <span class="stringliteral">&quot;&quot;</span>) . $version-&gt;get(<span class="keyword">false</span>) . TextFormat::RESET . <span class="stringliteral">&quot; \&quot;&quot;</span> . $this-&gt;getCodename() . <span class="stringliteral">&quot;\&quot; (API &quot;</span> . $this-&gt;getApiVersion() . <span class="stringliteral">&quot;)&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01461"></a>01461         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;PocketMine-MP is distributed under the LGPL License&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01462"></a>01462 
<a name="l01463"></a>01463         $this-&gt;consoleSender = <span class="keyword">new</span> ConsoleCommandSender();
<a name="l01464"></a>01464         $this-&gt;commandMap = <span class="keyword">new</span> SimpleCommandMap($this);
<a name="l01465"></a>01465 
<a name="l01466"></a>01466         InventoryType::init();
<a name="l01467"></a>01467         Block::init();
<a name="l01468"></a>01468         Item::init();
<a name="l01469"></a>01469         $this-&gt;craftingManager = <span class="keyword">new</span> CraftingManager();
<a name="l01470"></a>01470 
<a name="l01471"></a>01471         $this-&gt;pluginManager = <span class="keyword">new</span> PluginManager($this, $this-&gt;commandMap);
<a name="l01472"></a>01472         $this-&gt;pluginManager-&gt;subscribeToPermission(Server::BROADCAST_CHANNEL_ADMINISTRATIVE, $this-&gt;consoleSender);
<a name="l01473"></a>01473         $this-&gt;pluginManager-&gt;registerInterface(<span class="stringliteral">&quot;pocketmine\\plugin\\PharPluginLoader&quot;</span>);
<a name="l01474"></a>01474         $this-&gt;pluginManager-&gt;loadPlugins($this-&gt;pluginPath);
<a name="l01475"></a>01475 
<a name="l01476"></a>01476         $this-&gt;updater = <span class="keyword">new</span> AutoUpdater($this, $this-&gt;getProperty(<span class="stringliteral">&quot;auto-updater.host&quot;</span>, <span class="stringliteral">&quot;www.pocketmine.net&quot;</span>));
<a name="l01477"></a>01477 
<a name="l01478"></a>01478         $this-&gt;enablePlugins(PluginLoadOrder::STARTUP);
<a name="l01479"></a>01479 
<a name="l01480"></a>01480         $this-&gt;generationManager = <span class="keyword">new</span> GenerationRequestManager($this);
<a name="l01481"></a>01481 
<a name="l01482"></a>01482         LevelProviderManager::addProvider($this, <span class="stringliteral">&quot;pocketmine\\level\\format\\anvil\\Anvil&quot;</span>);
<a name="l01483"></a>01483 
<a name="l01484"></a>01484 
<a name="l01485"></a>01485         Generator::addGenerator(<span class="stringliteral">&quot;pocketmine\\level\\generator\\Flat&quot;</span>, <span class="stringliteral">&quot;flat&quot;</span>);
<a name="l01486"></a>01486         Generator::addGenerator(<span class="stringliteral">&quot;pocketmine\\level\\generator\\Normal&quot;</span>, <span class="stringliteral">&quot;normal&quot;</span>);
<a name="l01487"></a>01487         Generator::addGenerator(<span class="stringliteral">&quot;pocketmine\\level\\generator\\Normal&quot;</span>, <span class="stringliteral">&quot;default&quot;</span>);
<a name="l01488"></a>01488 
<a name="l01489"></a>01489         <span class="keywordflow">if</span>($this-&gt;getDefaultLevel() === null){
<a name="l01490"></a>01490             $default = $this-&gt;getConfigString(<span class="stringliteral">&quot;level-name&quot;</span>, <span class="stringliteral">&quot;world&quot;</span>);
<a name="l01491"></a>01491             <span class="keywordflow">if</span>(trim($default) == <span class="stringliteral">&quot;&quot;</span>){
<a name="l01492"></a>01492                 trigger_error(<span class="stringliteral">&quot;level-name cannot be null, using default&quot;</span>, E_USER_WARNING);
<a name="l01493"></a>01493                 $default = <span class="stringliteral">&quot;world&quot;</span>;
<a name="l01494"></a>01494                 $this-&gt;setConfigString(<span class="stringliteral">&quot;level-name&quot;</span>, <span class="stringliteral">&quot;world&quot;</span>);
<a name="l01495"></a>01495             }
<a name="l01496"></a>01496             <span class="keywordflow">if</span>($this-&gt;loadLevel($default) === <span class="keyword">false</span>){
<a name="l01497"></a>01497                 $seed = $this-&gt;getConfigInt(<span class="stringliteral">&quot;level-seed&quot;</span>, time());
<a name="l01498"></a>01498                 $this-&gt;generateLevel($default, $seed === 0 ? time() : $seed);
<a name="l01499"></a>01499             }
<a name="l01500"></a>01500 
<a name="l01501"></a>01501             $this-&gt;setDefaultLevel($this-&gt;getLevelByName($default));
<a name="l01502"></a>01502         }
<a name="l01503"></a>01503 
<a name="l01504"></a>01504 
<a name="l01505"></a>01505         $this-&gt;properties-&gt;save();
<a name="l01506"></a>01506 
<a name="l01507"></a>01507         $this-&gt;scheduler-&gt;scheduleDelayedRepeatingTask(<span class="keyword">new</span> CallbackTask(<span class="stringliteral">&quot;pocketmine\\utils\\Cache::cleanup&quot;</span>), $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.cache-cleanup&quot;</span>, 900), $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.cache-cleanup&quot;</span>, 900));
<a name="l01508"></a>01508         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;auto-save&quot;</span>, <span class="keyword">true</span>) === <span class="keyword">true</span> and $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.autosave&quot;</span>, 6000) &gt; 0){
<a name="l01509"></a>01509             $this-&gt;scheduler-&gt;scheduleDelayedRepeatingTask(<span class="keyword">new</span> CallbackTask(array($this, <span class="stringliteral">&quot;doAutoSave&quot;</span>)), $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.autosave&quot;</span>, 6000), $this-&gt;getProperty(<span class="stringliteral">&quot;ticks-per.autosave&quot;</span>, 6000));
<a name="l01510"></a>01510         }
<a name="l01511"></a>01511 
<a name="l01512"></a>01512         <span class="keywordflow">if</span>($this-&gt;getProperty(<span class="stringliteral">&quot;chunk-gc.period-in-ticks&quot;</span>, 600) &gt; 0){
<a name="l01513"></a>01513             $this-&gt;scheduler-&gt;scheduleDelayedRepeatingTask(<span class="keyword">new</span> CallbackTask(array($this, <span class="stringliteral">&quot;doLevelGC&quot;</span>)), $this-&gt;getProperty(<span class="stringliteral">&quot;chunk-gc.period-in-ticks&quot;</span>, 600), $this-&gt;getProperty(<span class="stringliteral">&quot;chunk-gc.period-in-ticks&quot;</span>, 600));
<a name="l01514"></a>01514         }
<a name="l01515"></a>01515 
<a name="l01516"></a>01516         $this-&gt;enablePlugins(PluginLoadOrder::POSTWORLD);
<a name="l01517"></a>01517 
<a name="l01518"></a>01518     }
<a name="l01519"></a>01519 
<a name="l01525"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a42a1b94e72b0cb2072709c314ea0e78a">01525</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a42a1b94e72b0cb2072709c314ea0e78a">broadcastMessage</a>($message){
<a name="l01526"></a>01526         <span class="keywordflow">return</span> $this-&gt;broadcast($message, self::BROADCAST_CHANNEL_USERS);
<a name="l01527"></a>01527     }
<a name="l01528"></a>01528 
<a name="l01535"></a>01535     <span class="keyword">public</span> <span class="keyword">function</span> broadcast($message, $permissions){
<a name="l01537"></a>01537         $recipients = [];
<a name="l01538"></a>01538         <span class="keywordflow">foreach</span>(explode(<span class="stringliteral">&quot;;&quot;</span>, $permissions) as $permission){
<a name="l01539"></a>01539             <span class="keywordflow">foreach</span>($this-&gt;pluginManager-&gt;getPermissionSubscriptions($permission) as $permissible){
<a name="l01540"></a>01540                 <span class="keywordflow">if</span>($permissible instanceof CommandSender and $permissible-&gt;hasPermission($permission)){
<a name="l01541"></a>01541                     $recipients[spl_object_hash($permissible)] = $permissible; <span class="comment">// do not send messages directly, or some might be repeated</span>
<a name="l01542"></a>01542                 }
<a name="l01543"></a>01543             }
<a name="l01544"></a>01544         }
<a name="l01545"></a>01545 
<a name="l01546"></a>01546         <span class="keywordflow">foreach</span>($recipients as $recipient){
<a name="l01547"></a>01547             $recipient-&gt;sendMessage($message);
<a name="l01548"></a>01548         }
<a name="l01549"></a>01549         <span class="keywordflow">return</span> count($recipients);
<a name="l01550"></a>01550     }
<a name="l01551"></a>01551 
<a name="l01558"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2713a3d6f609a81b92d53a8a8af68b42">01558</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a2713a3d6f609a81b92d53a8a8af68b42">broadcastPacket</a>(array $players, DataPacket $packet){
<a name="l01559"></a>01559         <span class="keywordflow">foreach</span>($players as $player){
<a name="l01560"></a>01560             $player-&gt;dataPacket(clone $packet);
<a name="l01561"></a>01561         }
<a name="l01562"></a>01562     }
<a name="l01563"></a>01563 
<a name="l01564"></a>01564 
<a name="l01568"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a45d2d1a0000140935158e800b8ce8e51">01568</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a45d2d1a0000140935158e800b8ce8e51">enablePlugins</a>($type){
<a name="l01569"></a>01569         <span class="keywordflow">foreach</span>($this-&gt;pluginManager-&gt;getPlugins() as $plugin){
<a name="l01570"></a>01570             <span class="keywordflow">if</span>(!$plugin-&gt;isEnabled() and $plugin-&gt;getDescription()-&gt;getOrder() === $type){
<a name="l01571"></a>01571                 $this-&gt;loadPlugin($plugin);
<a name="l01572"></a>01572             }
<a name="l01573"></a>01573         }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575         <span class="keywordflow">if</span>($type === PluginLoadOrder::POSTWORLD){
<a name="l01576"></a>01576             $this-&gt;commandMap-&gt;registerServerAliases();
<a name="l01577"></a>01577             DefaultPermissions::registerCorePermissions();
<a name="l01578"></a>01578         }
<a name="l01579"></a>01579     }
<a name="l01580"></a>01580 
<a name="l01584"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ae3201921c5012ba0d6849106a0037675">01584</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ae3201921c5012ba0d6849106a0037675">loadPlugin</a>(Plugin $plugin){
<a name="l01585"></a>01585         $this-&gt;pluginManager-&gt;enablePlugin($plugin);
<a name="l01586"></a>01586     }
<a name="l01587"></a>01587 
<a name="l01588"></a>01588     <span class="keyword">public</span> <span class="keyword">function</span> disablePlugins(){
<a name="l01589"></a>01589         $this-&gt;pluginManager-&gt;disablePlugins();
<a name="l01590"></a>01590     }
<a name="l01591"></a>01591 
<a name="l01592"></a>01592     <span class="keyword">public</span> <span class="keyword">function</span> checkConsole(){
<a name="l01593"></a>01593         <span class="keywordflow">if</span>(($line = $this-&gt;console-&gt;getLine()) !== null){
<a name="l01594"></a>01594             $this-&gt;pluginManager-&gt;callEvent($ev = <span class="keyword">new</span> ServerCommandEvent($this-&gt;consoleSender, $line));
<a name="l01595"></a>01595             $this-&gt;dispatchCommand($this-&gt;consoleSender, $ev-&gt;getCommand());
<a name="l01596"></a>01596         }
<a name="l01597"></a>01597     }
<a name="l01598"></a>01598 
<a name="l01607"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5dcbe6191809a32aa98358e68c115197">01607</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5dcbe6191809a32aa98358e68c115197">dispatchCommand</a>(CommandSender $sender, $commandLine){
<a name="l01608"></a>01608         <span class="keywordflow">if</span>($this-&gt;commandMap-&gt;dispatch($sender, $commandLine)){
<a name="l01609"></a>01609             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01610"></a>01610         }
<a name="l01611"></a>01611 
<a name="l01612"></a>01612         <span class="keywordflow">if</span>($sender instanceof <a class="code" href="../../df/d2c/classpocketmine_1_1_player.html">Player</a>){
<a name="l01613"></a>01613             $sender-&gt;sendMessage(<span class="stringliteral">&quot;Unknown command. Type \&quot;/help\&quot; for help.&quot;</span>);
<a name="l01614"></a>01614         }<span class="keywordflow">else</span>{
<a name="l01615"></a>01615             $sender-&gt;sendMessage(<span class="stringliteral">&quot;Unknown command. Type \&quot;help\&quot; for help.&quot;</span>);
<a name="l01616"></a>01616         }
<a name="l01617"></a>01617 
<a name="l01618"></a>01618         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01619"></a>01619     }
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     <span class="keyword">public</span> <span class="keyword">function</span> reload(){
<a name="l01622"></a>01622         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Saving levels...&quot;</span>);
<a name="l01623"></a>01623 
<a name="l01624"></a>01624         <span class="keywordflow">foreach</span>($this-&gt;levels as $level){
<a name="l01625"></a>01625             $level-&gt;save();
<a name="l01626"></a>01626         }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628         $this-&gt;pluginManager-&gt;disablePlugins();
<a name="l01629"></a>01629         $this-&gt;pluginManager-&gt;clearPlugins();
<a name="l01630"></a>01630         $this-&gt;commandMap-&gt;clearCommands();
<a name="l01631"></a>01631 
<a name="l01632"></a>01632         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Reloading properties...&quot;</span>);
<a name="l01633"></a>01633         $this-&gt;properties-&gt;reload();
<a name="l01634"></a>01634         $this-&gt;maxPlayers = $this-&gt;getConfigInt(<span class="stringliteral">&quot;max-players&quot;</span>, 20);
<a name="l01635"></a>01635 
<a name="l01636"></a>01636         <span class="keywordflow">if</span>(($memory = str_replace(<span class="stringliteral">&quot;B&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, strtoupper($this-&gt;getConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>, <span class="stringliteral">&quot;256M&quot;</span>)))) !== <span class="keyword">false</span>){
<a name="l01637"></a>01637             $value = array(<span class="stringliteral">&quot;M&quot;</span> =&gt; 1, <span class="stringliteral">&quot;G&quot;</span> =&gt; 1024);
<a name="l01638"></a>01638             $real = ((int) substr($memory, 0, -1)) * $value[substr($memory, -1)];
<a name="l01639"></a>01639             <span class="keywordflow">if</span>($real &lt; 256){
<a name="l01640"></a>01640                 $this-&gt;logger-&gt;warning(<span class="stringliteral">&quot;PocketMine-MP may not work right with less than 256MB of RAM&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01641"></a>01641             }
<a name="l01642"></a>01642             @ini_set(<span class="stringliteral">&quot;memory_limit&quot;</span>, $memory);
<a name="l01643"></a>01643         }<span class="keywordflow">else</span>{
<a name="l01644"></a>01644             $this-&gt;setConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>, <span class="stringliteral">&quot;128M&quot;</span>);
<a name="l01645"></a>01645         }
<a name="l01646"></a>01646 
<a name="l01647"></a>01647         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;hardcore&quot;</span>, <span class="keyword">false</span>) === <span class="keyword">true</span> and $this-&gt;getDifficulty() &lt; 3){
<a name="l01648"></a>01648             $this-&gt;setConfigInt(<span class="stringliteral">&quot;difficulty&quot;</span>, 3);
<a name="l01649"></a>01649         }
<a name="l01650"></a>01650 
<a name="l01651"></a>01651         $this-&gt;banByIP-&gt;load();
<a name="l01652"></a>01652         $this-&gt;banByName-&gt;load();
<a name="l01653"></a>01653         $this-&gt;reloadWhitelist();
<a name="l01654"></a>01654         $this-&gt;operators-&gt;reload();
<a name="l01655"></a>01655 
<a name="l01656"></a>01656 
<a name="l01657"></a>01657         $this-&gt;pluginManager-&gt;registerInterface(<span class="stringliteral">&quot;pocketmine\\plugin\\PharPluginLoader&quot;</span>);
<a name="l01658"></a>01658         $this-&gt;pluginManager-&gt;loadPlugins($this-&gt;pluginPath);
<a name="l01659"></a>01659         $this-&gt;enablePlugins(PluginLoadOrder::STARTUP);
<a name="l01660"></a>01660         $this-&gt;enablePlugins(PluginLoadOrder::POSTWORLD);
<a name="l01661"></a>01661     }
<a name="l01662"></a>01662 
<a name="l01666"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5ea673149c3d2e0fbc7146d72d128563">01666</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a5ea673149c3d2e0fbc7146d72d128563">shutdown</a>(){
<a name="l01667"></a>01667         $this-&gt;isRunning = <span class="keyword">false</span>;
<a name="l01668"></a>01668     }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670     <span class="keyword">public</span> <span class="keyword">function</span> forceShutdown(){
<a name="l01671"></a>01671         $this-&gt;shutdown();
<a name="l01672"></a>01672         <span class="keywordflow">if</span>($this-&gt;rcon instanceof RCON){
<a name="l01673"></a>01673             $this-&gt;rcon-&gt;stop();
<a name="l01674"></a>01674         }
<a name="l01675"></a>01675 
<a name="l01676"></a>01676         <span class="keywordflow">if</span>($this-&gt;getProperty(<span class="stringliteral">&quot;settings.upnp-forwarding&quot;</span>, <span class="keyword">false</span>) === <span class="keyword">true</span>){
<a name="l01677"></a>01677             $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;[UPnP] Removing port forward...&quot;</span>);
<a name="l01678"></a>01678             UPnP::RemovePortForward($this-&gt;getPort());
<a name="l01679"></a>01679         }
<a name="l01680"></a>01680 
<a name="l01681"></a>01681         $this-&gt;pluginManager-&gt;disablePlugins();
<a name="l01682"></a>01682 
<a name="l01683"></a>01683         <span class="keywordflow">foreach</span>($this-&gt;players as $player){
<a name="l01684"></a>01684             $player-&gt;close(TextFormat::YELLOW . $player-&gt;getName() . <span class="stringliteral">&quot; has left the game&quot;</span>, $this-&gt;getProperty(<span class="stringliteral">&quot;settings.shutdown-message&quot;</span>, <span class="stringliteral">&quot;Server closed&quot;</span>));
<a name="l01685"></a>01685         }
<a name="l01686"></a>01686 
<a name="l01687"></a>01687         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l01688"></a>01688             $this-&gt;unloadLevel($level, <span class="keyword">true</span>);
<a name="l01689"></a>01689         }
<a name="l01690"></a>01690         $this-&gt;generationManager-&gt;shutdown();
<a name="l01691"></a>01691 
<a name="l01692"></a>01692         HandlerList::unregisterAll();
<a name="l01693"></a>01693         $this-&gt;scheduler-&gt;cancelAllTasks();
<a name="l01694"></a>01694         $this-&gt;scheduler-&gt;mainThreadHeartbeat(PHP_INT_MAX);
<a name="l01695"></a>01695 
<a name="l01696"></a>01696         $this-&gt;properties-&gt;save();
<a name="l01697"></a>01697 
<a name="l01698"></a>01698         $this-&gt;console-&gt;kill();
<a name="l01699"></a>01699         <span class="keywordflow">foreach</span>($this-&gt;interfaces as $interface){
<a name="l01700"></a>01700             $interface-&gt;shutdown();
<a name="l01701"></a>01701         }
<a name="l01702"></a>01702     }
<a name="l01703"></a>01703 
<a name="l01707"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac6822634150519db3dce79e3b590e79a">01707</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#ac6822634150519db3dce79e3b590e79a">start</a>(){
<a name="l01708"></a>01708 
<a name="l01709"></a>01709         <span class="keywordflow">if</span>($this-&gt;getConfigBoolean(<span class="stringliteral">&quot;enable-query&quot;</span>, <span class="keyword">true</span>) === <span class="keyword">true</span>){
<a name="l01710"></a>01710             $this-&gt;queryHandler = <span class="keyword">new</span> QueryHandler();
<a name="l01711"></a>01711 
<a name="l01712"></a>01712         }
<a name="l01713"></a>01713 
<a name="l01714"></a>01714 
<a name="l01715"></a>01715         <span class="keywordflow">if</span>($this-&gt;getProperty(<span class="stringliteral">&quot;settings.send-usage&quot;</span>, <span class="keyword">true</span>) !== <span class="keyword">false</span>){
<a name="l01716"></a>01716             $this-&gt;scheduler-&gt;scheduleDelayedRepeatingTask(<span class="keyword">new</span> CallbackTask(array($this, <span class="stringliteral">&quot;sendUsage&quot;</span>)), 6000, 6000);
<a name="l01717"></a>01717             $this-&gt;sendUsage();
<a name="l01718"></a>01718         }
<a name="l01719"></a>01719 
<a name="l01720"></a>01720 
<a name="l01721"></a>01721         <span class="keywordflow">if</span>($this-&gt;getProperty(<span class="stringliteral">&quot;settings.upnp-forwarding&quot;</span>, <span class="keyword">false</span>) == <span class="keyword">true</span>){
<a name="l01722"></a>01722             $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;[UPnP] Trying to port forward...&quot;</span>);
<a name="l01723"></a>01723             UPnP::PortForward($this-&gt;getPort());
<a name="l01724"></a>01724         }
<a name="l01725"></a>01725 
<a name="l01726"></a>01726         $this-&gt;tickCounter = 0;
<a name="l01727"></a>01727 
<a name="l01728"></a>01728         <span class="comment">//register_shutdown_function(array($this, &quot;dumpError&quot;));</span>
<a name="l01729"></a>01729         register_shutdown_function(array($this, <span class="stringliteral">&quot;forceShutdown&quot;</span>));
<a name="l01730"></a>01730         <span class="keywordflow">if</span>(function_exists(<span class="stringliteral">&quot;pcntl_signal&quot;</span>)){
<a name="l01731"></a>01731             pcntl_signal(SIGTERM, array($this, <span class="stringliteral">&quot;shutdown&quot;</span>));
<a name="l01732"></a>01732             pcntl_signal(SIGINT, array($this, <span class="stringliteral">&quot;shutdown&quot;</span>));
<a name="l01733"></a>01733             pcntl_signal(SIGHUP, array($this, <span class="stringliteral">&quot;shutdown&quot;</span>));
<a name="l01734"></a>01734         }
<a name="l01735"></a>01735 
<a name="l01736"></a>01736         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Default game type: &quot;</span> . self::getGamemodeString($this-&gt;getGamemode())); <span class="comment">//TODO: string name</span>
<a name="l01737"></a>01737 
<a name="l01738"></a>01738         $this-&gt;logger-&gt;info(<span class="stringliteral">&quot;Done (&quot;</span> . round(microtime(<span class="keyword">true</span>) - \pocketmine\START_TIME, 3) . <span class="stringliteral">&#39;s)! For help, type &quot;help&quot; or &quot;?&quot;&#39;</span>);
<a name="l01739"></a>01739 
<a name="l01740"></a>01740         <span class="keywordflow">if</span>(Utils::getOS() === <span class="stringliteral">&quot;win&quot;</span>){ <span class="comment">//Workaround less usleep() waste</span>
<a name="l01741"></a>01741             $this-&gt;tickProcessorWindows();
<a name="l01742"></a>01742         }<span class="keywordflow">else</span>{
<a name="l01743"></a>01743             $this-&gt;tickProcessor();
<a name="l01744"></a>01744         }
<a name="l01745"></a>01745         $this-&gt;forceShutdown();
<a name="l01746"></a>01746     }
<a name="l01747"></a>01747 
<a name="l01748"></a>01748     <span class="keyword">private</span> <span class="keyword">function</span> tickProcessorWindows(){
<a name="l01749"></a>01749         $lastLoop = 0;
<a name="l01750"></a>01750         <span class="keywordflow">while</span>($this-&gt;isRunning){
<a name="l01751"></a>01751             <span class="keywordflow">foreach</span>($this-&gt;interfaces as $interface){
<a name="l01752"></a>01752                 <span class="keywordflow">if</span>($interface-&gt;process()){
<a name="l01753"></a>01753                     $lastLoop = 0;
<a name="l01754"></a>01754                 }
<a name="l01755"></a>01755             }
<a name="l01756"></a>01756             $this-&gt;generationManager-&gt;handlePackets();
<a name="l01757"></a>01757 
<a name="l01758"></a>01758             <span class="keywordflow">if</span>(($ticks = $this-&gt;tick()) !== <span class="keyword">true</span>){
<a name="l01759"></a>01759                 ++$lastLoop;
<a name="l01760"></a>01760                 <span class="keywordflow">if</span>($lastLoop &gt; 128){
<a name="l01761"></a>01761                     usleep(1000);
<a name="l01762"></a>01762                 }
<a name="l01763"></a>01763             }<span class="keywordflow">else</span>{
<a name="l01764"></a>01764                 $lastLoop = 0;
<a name="l01765"></a>01765             }
<a name="l01766"></a>01766         }
<a name="l01767"></a>01767     }
<a name="l01768"></a>01768 
<a name="l01769"></a>01769     <span class="keyword">public</span> <span class="keyword">function</span> checkTicks(){
<a name="l01770"></a>01770         <span class="keywordflow">if</span>($this-&gt;getTicksPerSecond() &lt; 12){
<a name="l01771"></a>01771             $this-&gt;logger-&gt;warning(<span class="stringliteral">&quot;Can&#39;t keep up! Is the server overloaded?&quot;</span>);
<a name="l01772"></a>01772         }
<a name="l01773"></a>01773     }
<a name="l01774"></a>01774 
<a name="l01775"></a>01775     <span class="keyword">public</span> <span class="keyword">function</span> checkMemory(){
<a name="l01776"></a>01776         <span class="comment">//TODO</span>
<a name="l01777"></a>01777         $info = $this-&gt;debugInfo();
<a name="l01778"></a>01778         $data = $info[<span class="stringliteral">&quot;memory_usage&quot;</span>] . <span class="stringliteral">&quot;,&quot;</span> . $info[<span class="stringliteral">&quot;players&quot;</span>] . <span class="stringliteral">&quot;,&quot;</span> . $info[<span class="stringliteral">&quot;entities&quot;</span>];
<a name="l01779"></a>01779         $i = count($this-&gt;memoryStats) - 1;
<a name="l01780"></a>01780         <span class="keywordflow">if</span>($i &lt; 0 or $this-&gt;memoryStats[$i] !== $data){
<a name="l01781"></a>01781             $this-&gt;memoryStats[] = $data;
<a name="l01782"></a>01782         }
<a name="l01783"></a>01783     }
<a name="l01784"></a>01784 
<a name="l01785"></a>01785     <span class="keyword">public</span> <span class="keyword">function</span> dumpError(){
<a name="l01786"></a>01786         <span class="comment">//TODO</span>
<a name="l01787"></a>01787         <span class="keywordflow">if</span>($this-&gt;stop === <span class="keyword">true</span>){
<a name="l01788"></a>01788             <span class="keywordflow">return</span>;
<a name="l01789"></a>01789         }
<a name="l01790"></a>01790         ini_set(<span class="stringliteral">&quot;memory_limit&quot;</span>, <span class="stringliteral">&quot;-1&quot;</span>); <span class="comment">//Fix error dump not dumped on memory problems</span>
<a name="l01791"></a>01791         $this-&gt;logger-&gt;emergency(<span class="stringliteral">&quot;An unrecoverable has occurred and the server has crashed. Creating an error dump&quot;</span>);
<a name="l01792"></a>01792         $dump = <span class="stringliteral">&quot;```\r\n# PocketMine-MP Error Dump &quot;</span> . date(<span class="stringliteral">&quot;D M j H:i:s T Y&quot;</span>) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01793"></a>01793         $er = error_get_last();
<a name="l01794"></a>01794         $errorConversion = array(
<a name="l01795"></a>01795             E_ERROR =&gt; <span class="stringliteral">&quot;E_ERROR&quot;</span>,
<a name="l01796"></a>01796             E_WARNING =&gt; <span class="stringliteral">&quot;E_WARNING&quot;</span>,
<a name="l01797"></a>01797             E_PARSE =&gt; <span class="stringliteral">&quot;E_PARSE&quot;</span>,
<a name="l01798"></a>01798             E_NOTICE =&gt; <span class="stringliteral">&quot;E_NOTICE&quot;</span>,
<a name="l01799"></a>01799             E_CORE_ERROR =&gt; <span class="stringliteral">&quot;E_CORE_ERROR&quot;</span>,
<a name="l01800"></a>01800             E_CORE_WARNING =&gt; <span class="stringliteral">&quot;E_CORE_WARNING&quot;</span>,
<a name="l01801"></a>01801             E_COMPILE_ERROR =&gt; <span class="stringliteral">&quot;E_COMPILE_ERROR&quot;</span>,
<a name="l01802"></a>01802             E_COMPILE_WARNING =&gt; <span class="stringliteral">&quot;E_COMPILE_WARNING&quot;</span>,
<a name="l01803"></a>01803             E_USER_ERROR =&gt; <span class="stringliteral">&quot;E_USER_ERROR&quot;</span>,
<a name="l01804"></a>01804             E_USER_WARNING =&gt; <span class="stringliteral">&quot;E_USER_WARNING&quot;</span>,
<a name="l01805"></a>01805             E_USER_NOTICE =&gt; <span class="stringliteral">&quot;E_USER_NOTICE&quot;</span>,
<a name="l01806"></a>01806             E_STRICT =&gt; <span class="stringliteral">&quot;E_STRICT&quot;</span>,
<a name="l01807"></a>01807             E_RECOVERABLE_ERROR =&gt; <span class="stringliteral">&quot;E_RECOVERABLE_ERROR&quot;</span>,
<a name="l01808"></a>01808             E_DEPRECATED =&gt; <span class="stringliteral">&quot;E_DEPRECATED&quot;</span>,
<a name="l01809"></a>01809             E_USER_DEPRECATED =&gt; <span class="stringliteral">&quot;E_USER_DEPRECATED&quot;</span>,
<a name="l01810"></a>01810         );
<a name="l01811"></a>01811         $er[<span class="stringliteral">&quot;type&quot;</span>] = isset($errorConversion[$er[<span class="stringliteral">&quot;type&quot;</span>]]) ? $errorConversion[$er[<span class="stringliteral">&quot;type&quot;</span>]] : $er[<span class="stringliteral">&quot;type&quot;</span>];
<a name="l01812"></a>01812         $dump .= <span class="stringliteral">&quot;Error: &quot;</span> . var_export($er, <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n\r\n&quot;</span>;
<a name="l01813"></a>01813         <span class="keywordflow">if</span>(stripos($er[<span class="stringliteral">&quot;file&quot;</span>], <span class="stringliteral">&quot;plugin&quot;</span>) !== <span class="keyword">false</span>){
<a name="l01814"></a>01814             $dump .= <span class="stringliteral">&quot;THIS ERROR WAS CAUSED BY A PLUGIN. REPORT IT TO THE PLUGIN DEVELOPER.\r\n&quot;</span>;
<a name="l01815"></a>01815         }
<a name="l01816"></a>01816 
<a name="l01817"></a>01817         $dump .= <span class="stringliteral">&quot;Code: \r\n&quot;</span>;
<a name="l01818"></a>01818         $file = @file($er[<span class="stringliteral">&quot;file&quot;</span>], FILE_IGNORE_NEW_LINES);
<a name="l01819"></a>01819         <span class="keywordflow">for</span>($l = max(0, $er[<span class="stringliteral">&quot;line&quot;</span>] - 10); $l &lt; $er[<span class="stringliteral">&quot;line&quot;</span>] + 10; ++$l){
<a name="l01820"></a>01820             $dump .= <span class="stringliteral">&quot;[&quot;</span> . ($l + 1) . <span class="stringliteral">&quot;] &quot;</span> . @$file[$l] . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01821"></a>01821         }
<a name="l01822"></a>01822         $dump .= <span class="stringliteral">&quot;\r\n\r\n&quot;</span>;
<a name="l01823"></a>01823         $dump .= <span class="stringliteral">&quot;Backtrace: \r\n&quot;</span>;
<a name="l01824"></a>01824         <span class="keywordflow">foreach</span>(getTrace() as $line){
<a name="l01825"></a>01825             $dump .= <span class="stringliteral">&quot;$line\r\n&quot;</span>;
<a name="l01826"></a>01826         }
<a name="l01827"></a>01827         $dump .= <span class="stringliteral">&quot;\r\n\r\n&quot;</span>;
<a name="l01828"></a>01828         $version = <span class="keyword">new</span> VersionString();
<a name="l01829"></a>01829         $dump .= <span class="stringliteral">&quot;PocketMine-MP version: &quot;</span> . $version-&gt;get(<span class="keyword">false</span>). <span class="stringliteral">&quot; #&quot;</span> . $version-&gt;getNumber() . <span class="stringliteral">&quot; [Protocol &quot;</span> . Info::CURRENT_PROTOCOL . <span class="stringliteral">&quot;; API &quot;</span> . API_VERSION . <span class="stringliteral">&quot;]\r\n&quot;</span>;
<a name="l01830"></a>01830         $dump .= <span class="stringliteral">&quot;Git commit: &quot;</span> . GIT_COMMIT . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01831"></a>01831         $dump .= <span class="stringliteral">&quot;uname -a: &quot;</span> . php_uname(<span class="stringliteral">&quot;a&quot;</span>) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01832"></a>01832         $dump .= <span class="stringliteral">&quot;PHP Version: &quot;</span> . phpversion() . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01833"></a>01833         $dump .= <span class="stringliteral">&quot;Zend version: &quot;</span> . zend_version() . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01834"></a>01834         $dump .= <span class="stringliteral">&quot;OS : &quot;</span> . PHP_OS . <span class="stringliteral">&quot;, &quot;</span> . Utils::getOS() . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01835"></a>01835         $dump .= <span class="stringliteral">&quot;Debug Info: &quot;</span> . var_export($this-&gt;debugInfo(<span class="keyword">false</span>), <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n\r\n\r\n&quot;</span>;
<a name="l01836"></a>01836         global $arguments;
<a name="l01837"></a>01837         $dump .= <span class="stringliteral">&quot;Parameters: &quot;</span> . var_export($arguments, <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n\r\n\r\n&quot;</span>;
<a name="l01838"></a>01838         $p = $this-&gt;api-&gt;getProperties();
<a name="l01839"></a>01839         <span class="keywordflow">if</span>($p[<span class="stringliteral">&quot;rcon.password&quot;</span>] != <span class="stringliteral">&quot;&quot;</span>){
<a name="l01840"></a>01840             $p[<span class="stringliteral">&quot;rcon.password&quot;</span>] = <span class="stringliteral">&quot;******&quot;</span>;
<a name="l01841"></a>01841         }
<a name="l01842"></a>01842         $dump .= <span class="stringliteral">&quot;server.properties: &quot;</span> . var_export($p, <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n\r\n\r\n&quot;</span>;
<a name="l01843"></a>01843         <span class="keywordflow">if</span>(class_exists(<span class="stringliteral">&quot;pocketmine\\plugin\\PluginManager&quot;</span>, <span class="keyword">false</span>)){
<a name="l01844"></a>01844             $dump .= <span class="stringliteral">&quot;Loaded plugins:\r\n&quot;</span>;
<a name="l01845"></a>01845             <span class="keywordflow">foreach</span>($this-&gt;getPluginManager()-&gt;getPlugins() as $p){
<a name="l01846"></a>01846                 $d = $p-&gt;getDescription();
<a name="l01847"></a>01847                 $dump .= $d-&gt;getName() . <span class="stringliteral">&quot; &quot;</span> . $d-&gt;getVersion() . <span class="stringliteral">&quot; by &quot;</span> . implode(<span class="stringliteral">&quot;, &quot;</span>, $d-&gt;getAuthors()) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01848"></a>01848             }
<a name="l01849"></a>01849             $dump .= <span class="stringliteral">&quot;\r\n\r\n&quot;</span>;
<a name="l01850"></a>01850         }
<a name="l01851"></a>01851 
<a name="l01852"></a>01852         $extensions = [];
<a name="l01853"></a>01853         <span class="keywordflow">foreach</span>(get_loaded_extensions() as $ext){
<a name="l01854"></a>01854             $extensions[$ext] = phpversion($ext);
<a name="l01855"></a>01855         }
<a name="l01856"></a>01856 
<a name="l01857"></a>01857         $dump .= <span class="stringliteral">&quot;Loaded Modules: &quot;</span> . var_export($extensions, <span class="keyword">true</span>) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01858"></a>01858         $this-&gt;checkMemory();
<a name="l01859"></a>01859         $dump .= <span class="stringliteral">&quot;Memory Usage Tracking: \r\n&quot;</span> . chunk_split(base64_encode(gzdeflate(implode(<span class="stringliteral">&quot;;&quot;</span>, $this-&gt;memoryStats), 9))) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01860"></a>01860         ob_start();
<a name="l01861"></a>01861         phpinfo();
<a name="l01862"></a>01862         $dump .= <span class="stringliteral">&quot;\r\nphpinfo(): \r\n&quot;</span> . chunk_split(base64_encode(gzdeflate(ob_get_contents(), 9))) . <span class="stringliteral">&quot;\r\n&quot;</span>;
<a name="l01863"></a>01863         ob_end_clean();
<a name="l01864"></a>01864         $dump .= <span class="stringliteral">&quot;\r\n```&quot;</span>;
<a name="l01865"></a>01865         $name = <span class="stringliteral">&quot;Error_Dump_&quot;</span> . date(<span class="stringliteral">&quot;D_M_j-H.i.s-T_Y&quot;</span>);
<a name="l01866"></a>01866         <span class="comment">//log($dump, $name, true, 0, true);</span>
<a name="l01867"></a>01867         $this-&gt;logger-&gt;emergency(<span class="stringliteral">&quot;Please submit the \&quot;{$name}.log\&quot; file to the Bug Reporting page. Give as much info as you can.&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, 0);
<a name="l01868"></a>01868     }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870     <span class="keyword">private</span> <span class="keyword">function</span> tickProcessor(){
<a name="l01871"></a>01871         $lastLoop = 0;
<a name="l01872"></a>01872         <span class="keywordflow">while</span>($this-&gt;isRunning){
<a name="l01873"></a>01873 
<a name="l01874"></a>01874             <span class="keywordflow">foreach</span>($this-&gt;interfaces as $interface){
<a name="l01875"></a>01875                 <span class="keywordflow">if</span>($interface-&gt;process()){
<a name="l01876"></a>01876                     $lastLoop = 0;
<a name="l01877"></a>01877                 }
<a name="l01878"></a>01878             }
<a name="l01879"></a>01879             $this-&gt;generationManager-&gt;handlePackets();
<a name="l01880"></a>01880 
<a name="l01881"></a>01881             <span class="keywordflow">if</span>(($ticks = $this-&gt;tick()) !== <span class="keyword">true</span>){
<a name="l01882"></a>01882                 ++$lastLoop;
<a name="l01883"></a>01883                 <span class="keywordflow">if</span>($lastLoop &gt; 16 and $lastLoop &lt; 128){
<a name="l01884"></a>01884                     usleep(200);
<a name="l01885"></a>01885                 }elseif($lastLoop &lt; 512){
<a name="l01886"></a>01886                     usleep(400);
<a name="l01887"></a>01887                 }<span class="keywordflow">else</span>{
<a name="l01888"></a>01888                     usleep(1000);
<a name="l01889"></a>01889                 }
<a name="l01890"></a>01890             }<span class="keywordflow">else</span>{
<a name="l01891"></a>01891                 $lastLoop = 0;
<a name="l01892"></a>01892             }
<a name="l01893"></a>01893         }
<a name="l01894"></a>01894     }
<a name="l01895"></a>01895 
<a name="l01896"></a>01896     <span class="keyword">public</span> <span class="keyword">function</span> addPlayer($identifier, Player $player){
<a name="l01897"></a>01897         $this-&gt;players[$identifier] = $player;
<a name="l01898"></a>01898     }
<a name="l01899"></a>01899 
<a name="l01900"></a>01900     <span class="keyword">private</span> <span class="keyword">function</span> checkTickUpdates($currentTick){
<a name="l01901"></a>01901         <span class="comment">//Update entities that need update</span>
<a name="l01902"></a>01902         <span class="keywordflow">if</span>(count(Entity::$needUpdate) &gt; 0){
<a name="l01903"></a>01903             <span class="keywordflow">foreach</span>(Entity::$needUpdate as $id =&gt; $entity){
<a name="l01904"></a>01904                 <span class="keywordflow">if</span>($entity-&gt;onUpdate() === <span class="keyword">false</span>){
<a name="l01905"></a>01905                     unset(Entity::$needUpdate[$id]);
<a name="l01906"></a>01906                 }
<a name="l01907"></a>01907             }
<a name="l01908"></a>01908         }
<a name="l01909"></a>01909 
<a name="l01910"></a>01910         <span class="comment">//Update tiles that need update</span>
<a name="l01911"></a>01911         <span class="keywordflow">if</span>(count(Tile::$needUpdate) &gt; 0){
<a name="l01912"></a>01912             <span class="keywordflow">foreach</span>(Tile::$needUpdate as $id =&gt; $tile){
<a name="l01913"></a>01913                 <span class="keywordflow">if</span>($tile-&gt;onUpdate() === <span class="keyword">false</span>){
<a name="l01914"></a>01914                     unset(Tile::$needUpdate[$id]);
<a name="l01915"></a>01915                 }
<a name="l01916"></a>01916             }
<a name="l01917"></a>01917         }
<a name="l01918"></a>01918 
<a name="l01919"></a>01919         <span class="comment">//TODO: Add level blocks</span>
<a name="l01920"></a>01920 
<a name="l01921"></a>01921         <span class="comment">//Do level ticks</span>
<a name="l01922"></a>01922         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l01923"></a>01923             $level-&gt;doTick($currentTick);
<a name="l01924"></a>01924         }
<a name="l01925"></a>01925     }
<a name="l01926"></a>01926 
<a name="l01927"></a>01927     <span class="keyword">public</span> <span class="keyword">function</span> doAutoSave(){
<a name="l01928"></a>01928 
<a name="l01929"></a>01929         <span class="comment">/*foreach($this-&gt;getOnlinePlayers() as $player){</span>
<a name="l01930"></a>01930 <span class="comment">            $player-&gt;save();</span>
<a name="l01931"></a>01931 <span class="comment">        }*/</span>
<a name="l01932"></a>01932 
<a name="l01933"></a>01933         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l01934"></a>01934             $level-&gt;save();
<a name="l01935"></a>01935         }
<a name="l01936"></a>01936     }
<a name="l01937"></a>01937 
<a name="l01938"></a>01938     <span class="keyword">public</span> <span class="keyword">function</span> doLevelGC(){
<a name="l01939"></a>01939         <span class="keywordflow">foreach</span>($this-&gt;getLevels() as $level){
<a name="l01940"></a>01940             $level-&gt;doChunkGarbageCollection();
<a name="l01941"></a>01941         }
<a name="l01942"></a>01942     }
<a name="l01943"></a>01943 
<a name="l01944"></a>01944     <span class="keyword">public</span> <span class="keyword">function</span> sendUsage(){
<a name="l01945"></a>01945         <span class="keywordflow">if</span>($this-&gt;lastSendUsage instanceof SendUsageTask){
<a name="l01946"></a>01946             <span class="keywordflow">if</span>(!$this-&gt;lastSendUsage-&gt;isFinished()){ <span class="comment">//do not call multiple times</span>
<a name="l01947"></a>01947                 <span class="keywordflow">return</span>;
<a name="l01948"></a>01948             }
<a name="l01949"></a>01949         }
<a name="l01950"></a>01950         $plist = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01951"></a>01951         <span class="keywordflow">foreach</span>($this-&gt;getPluginManager()-&gt;getPlugins() as $p){
<a name="l01952"></a>01952             $d = $p-&gt;getDescription();
<a name="l01953"></a>01953             $plist .= str_replace(array(<span class="stringliteral">&quot;;&quot;</span>, <span class="stringliteral">&quot;:&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, $d-&gt;getName()) . <span class="stringliteral">&quot;:&quot;</span> . str_replace(array(<span class="stringliteral">&quot;;&quot;</span>, <span class="stringliteral">&quot;:&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, $d-&gt;getVersion()) . <span class="stringliteral">&quot;;&quot;</span>;
<a name="l01954"></a>01954         }
<a name="l01955"></a>01955 
<a name="l01956"></a>01956         $version = <span class="keyword">new</span> VersionString();
<a name="l01957"></a>01957         $this-&gt;lastSendUsage = <span class="keyword">new</span> SendUsageTask(<span class="stringliteral">&quot;http://stats.pocketmine.net/usage.php&quot;</span>, array(
<a name="l01958"></a>01958             <span class="stringliteral">&quot;serverid&quot;</span> =&gt; Binary::readLong(substr(Utils::getUniqueID(<span class="keyword">true</span>, $this-&gt;getIp() . <span class="stringliteral">&quot;:&quot;</span> . $this-&gt;getPort()), 0, 8)),
<a name="l01959"></a>01959             <span class="stringliteral">&quot;port&quot;</span> =&gt; $this-&gt;getPort(),
<a name="l01960"></a>01960             <span class="stringliteral">&quot;os&quot;</span> =&gt; Utils::getOS(),
<a name="l01961"></a>01961             <span class="stringliteral">&quot;memory_total&quot;</span> =&gt; $this-&gt;getConfigString(<span class="stringliteral">&quot;memory-limit&quot;</span>),
<a name="l01962"></a>01962             <span class="stringliteral">&quot;memory_usage&quot;</span> =&gt; memory_get_usage(),
<a name="l01963"></a>01963             <span class="stringliteral">&quot;php_version&quot;</span> =&gt; \pocketmine\PHP_VERSION,
<a name="l01964"></a>01964             <span class="stringliteral">&quot;version&quot;</span> =&gt; $version-&gt;get(<span class="keyword">false</span>),
<a name="l01965"></a>01965             <span class="stringliteral">&quot;build&quot;</span> =&gt; $version-&gt;getBuild(),
<a name="l01966"></a>01966             <span class="stringliteral">&quot;mc_version&quot;</span> =&gt; \pocketmine\MINECRAFT_VERSION,
<a name="l01967"></a>01967             <span class="stringliteral">&quot;protocol&quot;</span> =&gt; network\protocol\Info::CURRENT_PROTOCOL,
<a name="l01968"></a>01968             <span class="stringliteral">&quot;online&quot;</span> =&gt; count($this-&gt;players),
<a name="l01969"></a>01969             <span class="stringliteral">&quot;max&quot;</span> =&gt; $this-&gt;getMaxPlayers(),
<a name="l01970"></a>01970             <span class="stringliteral">&quot;plugins&quot;</span> =&gt; $plist,
<a name="l01971"></a>01971         ));
<a name="l01972"></a>01972 
<a name="l01973"></a>01973         $this-&gt;scheduler-&gt;scheduleAsyncTask($this-&gt;lastSendUsage);
<a name="l01974"></a>01974     }
<a name="l01975"></a>01975 
<a name="l01976"></a>01976     <span class="keyword">public</span> <span class="keyword">function</span> titleTick(){
<a name="l01977"></a>01977         <span class="keywordflow">if</span>(defined(<span class="stringliteral">&quot;pocketmine\\DEBUG&quot;</span>) and \pocketmine\DEBUG &gt;= 0 and \pocketmine\ANSI === <span class="keyword">true</span>){
<a name="l01978"></a>01978             echo <span class="stringliteral">&quot;\x1b]0;PocketMine-MP &quot;</span> . $this-&gt;getPocketMineVersion() . <span class="stringliteral">&quot; | Online &quot;</span> . count($this-&gt;players) . <span class="stringliteral">&quot;/&quot;</span> . $this-&gt;getMaxPlayers() . <span class="stringliteral">&quot; | RAM &quot;</span> . round((memory_get_usage() / 1024) / 1024, 2) . <span class="stringliteral">&quot;/&quot;</span> . round((memory_get_usage(<span class="keyword">true</span>) / 1024) / 1024, 2) . <span class="stringliteral">&quot; MB | U -1 D -1 kB/s | TPS &quot;</span> . $this-&gt;getTicksPerSecond() . <span class="stringliteral">&quot;\x07&quot;</span>;
<a name="l01979"></a>01979         }
<a name="l01980"></a>01980     }
<a name="l01981"></a>01981 
<a name="l01982"></a>01982 
<a name="l01986"></a><a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a89769729bbcf4c255d97771318436e07">01986</a>     <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="../../d5/df7/classpocketmine_1_1_server.html#a89769729bbcf4c255d97771318436e07">tick</a>(){
<a name="l01987"></a>01987         <span class="keywordflow">if</span>($this-&gt;inTick === <span class="keyword">false</span>){
<a name="l01988"></a>01988             $tickTime = microtime(<span class="keyword">true</span>);
<a name="l01989"></a>01989             <span class="keywordflow">if</span>($tickTime &lt; $this-&gt;nextTick){
<a name="l01990"></a>01990                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01991"></a>01991             }
<a name="l01992"></a>01992 
<a name="l01993"></a>01993             $this-&gt;inTick = <span class="keyword">true</span>; <span class="comment">//Fix race conditions</span>
<a name="l01994"></a>01994             ++$this-&gt;tickCounter;
<a name="l01995"></a>01995 
<a name="l01996"></a>01996             $this-&gt;checkConsole();
<a name="l01997"></a>01997             $this-&gt;scheduler-&gt;mainThreadHeartbeat($this-&gt;tickCounter);
<a name="l01998"></a>01998             $this-&gt;checkTickUpdates($this-&gt;tickCounter);
<a name="l01999"></a>01999 
<a name="l02000"></a>02000             <span class="keywordflow">if</span>(($this-&gt;tickCounter &amp; 0b1111) === 0){
<a name="l02001"></a>02001                 $this-&gt;titleTick();
<a name="l02002"></a>02002                 <span class="keywordflow">if</span>(isset($this-&gt;queryHandler) and ($this-&gt;tickCounter &amp; 0b111111111) === 0){
<a name="l02003"></a>02003                     $this-&gt;queryHandler-&gt;regenerateInfo();
<a name="l02004"></a>02004                 }
<a name="l02005"></a>02005             }
<a name="l02006"></a>02006 
<a name="l02007"></a>02007             $this-&gt;tickMeasure = (($time = microtime(<span class="keyword">true</span>)) - $this-&gt;tickTime);
<a name="l02008"></a>02008             $this-&gt;tickTime = $time;
<a name="l02009"></a>02009             $this-&gt;nextTick = 0.05 * (0.05 / max(0.05, $this-&gt;tickMeasure)) + $time;
<a name="l02010"></a>02010             $this-&gt;inTick = <span class="keyword">false</span>;
<a name="l02011"></a>02011 
<a name="l02012"></a>02012             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02013"></a>02013         }
<a name="l02014"></a>02014 
<a name="l02015"></a>02015         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02016"></a>02016     }
<a name="l02017"></a>02017 
<a name="l02018"></a>02018 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>Server.php</b>      </li>

    <li class="footer">Generated on Sat Jul 5 2014 22:04:04 for PocketMine-MP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
